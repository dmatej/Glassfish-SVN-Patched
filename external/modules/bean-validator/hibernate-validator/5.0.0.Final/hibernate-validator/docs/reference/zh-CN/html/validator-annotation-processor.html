<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">第 9 章 Annotation Processor</title><link rel="stylesheet" href="css/hibernate.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="Hibernate Validator"/><link rel="up" href="index.html" title="Hibernate Validator"/><link rel="prev" href="validator-specifics.html" title="第 8 章 Hibernate Validator Specifics"/><link rel="next" href="validator-further-reading.html" title="第 10 章 进一步阅读"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="validator-specifics.html"><strong>上一页</strong></a></li><li class="next"><a accesskey="n" href="validator-further-reading.html"><strong>下一页</strong></a></li></ul><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-annotation-processor"/>第 9 章 Annotation Processor</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="validator-annotation-processor.html#validator-annotationprocessor-prerequisites">9.1. 前提条件</a></span></dt><dt><span class="section"><a href="validator-annotation-processor.html#validator-annotationprocessor-features">9.2. 特性</a></span></dt><dt><span class="section"><a href="validator-annotation-processor.html#validator-annotationprocessor-options">9.3. 配置项</a></span></dt><dt><span class="section"><a href="validator-annotation-processor.html#validator-annotationprocessor-usage">9.4. 使用标注处理器</a></span></dt><dd><dl><dt><span class="section"><a href="validator-annotation-processor.html#validator-annotationprocessor-commandline">9.4.1. 命令行编译</a></span></dt><dt><span class="section"><a href="validator-annotation-processor.html#validator-annotationprocessor-ide">9.4.2. IDE集成</a></span></dt></dl></dd><dt><span class="section"><a href="validator-annotation-processor.html#validator-annotationprocessor-known-issues">9.5. 已知问题</a></span></dt></dl></div><p>你碰到过下面这些让人抓狂的情况么:</p><div class="itemizedlist"><ul><li><p>specifying constraint annotations at unsupported data types (e.g. by annotating a String with @Past)</p></li><li><p>对一个JavaBean的setter方法进行标注(而不是getter)</p></li><li><p>对一个静态的变量或者方法进行约束条件标注(这样是不支持滴)</p></li></ul></div><p>这样的话, 你就应该看看Hibernate Validator 的约束处理器了. 它会被插入到编译过程中, 然后如果发现如果哪个约束标注用错了的话, 则汇报编译错误.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>You can find the Hibernate Validator Annotation Processor as part of the distribution bundle on <a class="ulink" href="http://sourceforge.net/projects/hibernate/files/hibernate-validator">Sourceforge</a> or in the JBoss Maven Repository (see <a class="xref" href="">???</a>) under the GAV org.hibernate:hibernate-validator-annotation-processor.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-annotationprocessor-prerequisites"/>9.1. 前提条件</h2></div></div></div><p>The Hibernate Validator Annotation Processor is based on the "Pluggable Annotation Processing API" as defined by <a class="ulink" href="http://jcp.org/en/jsr/detail?id=269">JSR 269</a> which is part of the Java Platform since Java 6.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-annotationprocessor-features"/>9.2. 特性</h2></div></div></div><p>As of Hibernate Validator 5.0.0.Final the Hibernate Validator Annotation Processor checks that:</p><div class="itemizedlist"><ul><li><p>应用了约束标注的属性的类型是否被该约束所支持</p></li><li><p>only non-static fields or methods are annotated with constraint annotations</p></li><li><p>only non-primitive fields or methods are annotated with @Valid</p></li><li><p>only such methods are annotated with constraint annotations which are valid JavaBeans getter methods (optionally, see below)</p></li><li><p>only such annotation types are annotated with constraint annotations which are constraint annotations themselves</p></li><li><p>definition of dynamic default group sequence with @GroupSequenceProvider is valid</p></li></ul></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-annotationprocessor-options"/>9.3. 配置项</h2></div></div></div><p>Hibernate Validator标注处理器的行为可以通过<a class="xref" href="validator-annotation-processor.html#table_processor_options" title="表 9.1. Hibernate Validator 标注处理器配置项">表 9.1 “Hibernate Validator 标注处理器配置项”</a>中列出的<a class="ulink" href="http://java.sun.com/javase/6/docs/technotes/tools/windows/javac.html#options">处理器配置项</a>加以控制.</p><div class="table"><a id="table_processor_options"/><p class="title"><b>表 9.1. Hibernate Validator 标注处理器配置项</b></p><div class="table-contents"><table summary="Hibernate Validator 标注处理器配置项" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center">配置项</th><th align="center">功能</th></tr></thead><tbody><tr><td><code class="varname">diagnosticKind</code></td><td>控制编译错误级别. 必须是枚举类型<code class="classname">javax.tools.Diagnostic.Kind</code>中的值(字符串形式), 例如<code class="classname">WARNING</code>. 如果是<code class="classname">ERROR</code>的话, 那么如果API检测到约束信息应用的错误的话, 会让编译过程终止, 默认是<code class="classname">ERROR</code>.</td></tr><tr><td><code class="varname">methodConstraintsSupported</code></td><td>Controls whether constraints are allowed at methods of any kind. Must be set to <code class="varname">true</code> when working with method level constraints as supported by Hibernate Validator. Can be set to <code class="varname">false</code> to allow constraints only at JavaBeans getter methods as defined by the Bean Validation API. Defaults to <code class="varname">true</code>.</td></tr><tr><td><code class="varname">verbose</code></td><td>Controls whether detailed processing information shall be displayed or not, useful for debugging purposes. Must be either <code class="varname">true</code> or <code class="varname">false</code>. Defaults to <code class="varname">false</code>.</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-annotationprocessor-usage"/>9.4. 使用标注处理器</h2></div></div></div><p>本小节详细介绍了如何把Hibernate Validator标注处理器与命令行编译(javac, Ant, Maven)以及IDE (Eclipse, IntelliJ IDEA, NetBeans)集成.</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-annotationprocessor-commandline"/>9.4.1. 命令行编译</h3></div></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="validator-annotationprocessor-javac"/>9.4.1.1. javac</h4></div></div></div><p>When compiling on the command line using <a class="ulink" href="http://java.sun.com/javase/6/docs/technotes/guides/javac/index.html">javac</a>, specify the JAR hibernate-validator-annotation-processor-5.0.0.Final.jar using the "processorpath" option as shown in the following listing. The processor will be detected automatically by the compiler and invoked during compilation.</p><div class="example"><a id="d0e3895"/><p class="title"><b>例 9.1. 在javac中使用标注处理器</b></p><div class="example-contents"><pre class="programlisting">javac src/main/java/org/hibernate/validator/ap/demo/Car.java \
   -cp /path/to/validation-api-1.1.0.CR3.jar \
   -processorpath /path/to/hibernate-validator-annotation-processor-5.0.0.Final.jar</pre></div></div><br class="example-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="validator-annotationprocessor-ant"/>9.4.1.2. Apache Ant</h4></div></div></div><p>和直接使用javac差不多, 可以在<a class="ulink" href="http://ant.apache.org/">Apache Ant</a>的<a class="ulink" href="http://ant.apache.org/manual/CoreTasks/javac.html">javac task</a>中添加上面例子中的参数:</p><div class="example"><a id="d0e3911"/><p class="title"><b>例 9.2. 在Ant中使用标注处理器</b></p><div class="example-contents"><pre class="programlisting">&lt;javac srcdir="src/main"
       destdir="build/classes"
       classpath="/path/to/validation-api-1.1.0.CR3.jar"&gt;
       &lt;compilerarg value="-processorpath" /&gt;
       &lt;compilerarg value="/path/to/hibernate-validator-annotation-processor-5.0.0.Final.jar"/&gt;
&lt;/javac&gt;</pre></div></div><br class="example-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3916"/>9.4.1.3. Maven</h4></div></div></div><p>对于和<a class="ulink" href="http://maven.apache.org/">Apache Maven</a>集成来说我们有很多选择, 通常, 我们可以把Hibenrate Validator标注处理器作为依赖添加到你的项目当中:</p><div class="example"><a id="d0e3924"/><p class="title"><b>例 9.3. 添加HV 标注处理器为依赖</b></p><div class="example-contents"><pre class="programlisting">...
&lt;dependency&gt;
    &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
    &lt;artifactId&gt;hibernate-validator-annotation-processor&lt;/artifactId&gt;
    &lt;version&gt;5.0.0.Final&lt;/version&gt;
    &lt;scope&gt;compile&lt;/scope&gt;
&lt;/dependency&gt;
...        </pre></div></div><br class="example-break"/><p>这样, 这个处理器就能够自动的被编译器所调用. 虽然基本上能工作,但是还是有一些缺点, 在某些情况下, 标注处理器的输出信息可能不能够被显示出来. (请参考<a class="ulink" href="http://jira.codehaus.org/browse/MCOMPILER-66">MCOMPILER-66</a>).</p><p>另外的一个选择是使用<a class="ulink" href="http://code.google.com/p/maven-annotation-plugin/">Maven Annotation Plugin</a>. 不过在此文档撰写的时候, 这个插件还没有被上传到任何一个广泛被使用的仓库中. 所以, 你需要自己把这个插件自己的仓库添加到你的settings.xml 或 pom.xml中:</p><div class="example"><a id="d0e3939"/><p class="title"><b>例 9.4. 添加Maven Annotation Plugin的仓库</b></p><div class="example-contents"><pre class="programlisting">...
&lt;pluginRepositories&gt;
    &lt;pluginRepository&gt;
        &lt;id&gt;maven-annotation-plugin-repo&lt;/id&gt;
        &lt;url&gt;http://maven-annotation-plugin.googlecode.com/svn/trunk/mavenrepo&lt;/url&gt;
    &lt;/pluginRepository&gt;
&lt;/pluginRepositories&gt;
...                      </pre></div></div><br class="example-break"/><p>现在, 禁用compiler插件所调用的标准的标注处理过程, 然后再通过定义一个execution来配置annotation plugin的运行, 还需要把Hibernate Validator标注处理器作为该插件的依赖添加进去(这样, 此标注处理器就不会被当成你的项目的依赖而出现在类路径中了):</p><div class="example"><a id="d0e3946"/><p class="title"><b>例 9.5. 配置Maven Annotation Plugin</b></p><div class="example-contents"><pre class="programlisting">...
&lt;plugin&gt;
    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
        &lt;source&gt;1.6&lt;/source&gt;
        &lt;target&gt;1.6&lt;/target&gt;
        &lt;compilerArgument&gt;-proc:none&lt;/compilerArgument&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
&lt;plugin&gt;
    &lt;groupId&gt;org.bsc.maven&lt;/groupId&gt;
    &lt;artifactId&gt;maven-processor-plugin&lt;/artifactId&gt;
    &lt;version&gt;1.3.4&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;process&lt;/id&gt;
            &lt;goals&gt;
                &lt;goal&gt;process&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;phase&gt;process-sources&lt;/phase&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
            &lt;artifactId&gt;hibernate-validator-annotation-processor&lt;/artifactId&gt;
            &lt;version&gt;5.0.0.Final&lt;/version&gt;
            &lt;scope&gt;compile&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/plugin&gt;
...
                    </pre></div></div><br class="example-break"/></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-annotationprocessor-ide"/>9.4.2. IDE集成</h3></div></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3954"/>9.4.2.1. Eclipse</h4></div></div></div><p>请参考以下步骤来在<a class="ulink" href="http://www.eclipse.org/">Eclipse</a>中使用标注处理器:</p><div class="itemizedlist"><ul><li><p>右键点击你的项目, 然后选择"属性"</p></li><li><p>在"Java Compiler"页面确认"编译级别"设置的是"1.6". 否则的话是无法使用标注处理器的.</p></li><li><p>到"Java Compiler"下面的"Annotation Processing" 页面, 然后选择"启用标注处理"(译注: 我的电脑是英文版的, 所以真的不知道中文版的eclipse上, 这些翻译成了什么:(</p></li><li><p>Go to "Java Compiler - Annotation Processing - Factory Path" and add the JAR hibernate-validator-annotation-processor-5.0.0.Final.jar</p></li><li><p>确认工作空间重新编译</p></li></ul></div><p>现在你应该能够看到所有的标注错误都在编辑窗口中显示出了错误标记,也都显示在了"问题"视图:</p><div class="mediaobject" align="center"><img src="annotation_processor_eclipse.png" align="middle"/></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="validator-annotationprocessor-idea"/>9.4.2.2. IntelliJ IDEA</h4></div></div></div><p>请参考以下步骤来在<a class="ulink" href="http://www.jetbrains.com/idea/">IntelliJ IDEA</a> (9.0及以上):中使用标注处理器:</p><div class="itemizedlist"><ul><li><p>选择 "File", 然后 "Settings",</p></li><li><p>展开"Compiler"节点, 然后点击"Annotation Processors"</p></li><li><p>Choose "Enable annotation processing" and enter the following as "Processor path": /path/to/hibernate-validator-annotation-processor-5.0.0.Final.jar</p></li><li><p>添加处理器的全路径名称<code class="classname">org.hibernate.validator.ap.ConstraintValidationProcessor</code>到"Annotation Processors"列表</p></li><li><p>如果需要的话, 添加你的模块到"Processed Modules"列表</p></li></ul></div><p>重新编译你的项目, 然后应该能看到关于约束标注的错误信息了:</p><div class="mediaobject" align="center"><img src="annotation_processor_intellij.png" align="middle"/></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="validator-annotationprocessor-netbeans"/>9.4.2.3. NetBeans</h4></div></div></div><p>从6.9这个版本开始, <a class="ulink" href="http://www.netbeans.org/">NetBeans</a>也支持标注处理了. 可以通过下面的步骤来启用它:</p><div class="itemizedlist"><ul><li><p>右键点击你的项目, 然后选择"属性"</p></li><li><p>Go to "Libraries", tab "Processor", and add the JAR hibernate-validator-annotation-processor-5.0.0.Final.jar</p></li><li><p>到"Build - Compiling"页面选中"Enable Annotation Processing" 和 "Enable Annotation Processing in Editor", 并且指定标注处理器的全路径名称<code class="classname">org.hibernate.validator.ap.ConstraintValidationProcessor</code>.</p></li></ul></div><p>所有的约束标注问题应该都会在编辑器里面直接被标记出来了:</p><div class="mediaobject" align="center"><img src="annotation_processor_netbeans.png" align="middle"/></div></div></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-annotationprocessor-known-issues"/>9.5. 已知问题</h2></div></div></div><p>以下是截止到2010年五月我们发现(但尚未解决)的问题:</p><div class="itemizedlist"><ul><li><p><a class="ulink" href="http://opensource.atlassian.com/projects/hibernate/browse/HV-308">HV-308</a>: Additional validators registered for a constraint <a class="ulink" href="http://docs.jboss.org/hibernate/stable/validator/reference/en/html_single/#d0e1957">using XML</a> are not evaluated by the annotation processor.</p></li><li><p>有时候, 在eclipse里面自定义的约束条件不能够被<a class="ulink" href="http://opensource.atlassian.com/projects/hibernate/browse/HV-293">正确的检查</a>. 清理这个项目可能会有帮助. 这可能是因为Eclipse中对 JSR 269 API的实现有问题, 但是还需要进一步的研究.</p></li><li><p>When using the processor within Eclipse, the check of dynamic default group sequence definitions doesn't work. After further investigation, it seems to be an issue with the Eclipse JSR 269 API implementation.</p></li></ul></div></div></div><HR xmlns=""/><a xmlns="" href=""><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">版权 © 2009 - 2013 Red Hat, Inc. &amp; Gunnar Morling</p></a><ul class="docnav"><li class="previous"><a accesskey="p" href="validator-specifics.html"><strong>上一页</strong>第 8 章 Hibernate Validator Specifics</a></li><li class="up"><a accesskey="u" href="#"><strong>上一级</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>起始页</strong></a></li><li class="next"><a accesskey="n" href="validator-further-reading.html"><strong>下一页</strong>第 10 章 进一步阅读</a></li></ul></body></html>