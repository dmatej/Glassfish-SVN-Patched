<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Hibernate Validator</title><link rel="stylesheet" href="css/hibernate-single.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/></head><body><div class="book" lang="zh-CN"><div class="titlepage"><div><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e2"/>Hibernate Validator</h1></div><div><h2 class="subtitle">JSR 303 的参考实现</h2></div><div><h2 class="subtitle">使用指南</h2></div><div><div xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="authorgroup"><div class="authors">由 <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Hardy</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Ferentschik</span>和<span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Gunnar</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Morling</span></div><div class="editors"/><div class="others">and thanks to <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Shaozhuang</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Liu</span></div></div></div><div><p class="releaseinfo">5.0.0.Final</p></div><div><p class="copyright">版权 © 2009 - 2013 Red Hat, Inc. &amp; Gunnar Morling</p></div><div><p class="pubdate">2013-04-11</p></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#preface">序言</a></span></dt><dt><span class="chapter"><a href="#validator-gettingstarted">1. 开始入门</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-gettingstarted-createproject">1.1. Project set up</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-gettingstarted-logging">1.1.1. Logging</a></span></dt><dt><span class="section"><a href="#validator-gettingstarted-uel">1.1.2. Unified EL</a></span></dt><dt><span class="section"><a href="#validator-gettingstarted-cdi">1.1.3. CDI</a></span></dt></dl></dd><dt><span class="section"><a href="#validator-gettingstarted-createmodel">1.2. 添加约束</a></span></dt><dt><span class="section"><a href="#d0e196">1.3. 校验约束</a></span></dt><dt><span class="section"><a href="#validator-gettingstarted-whatsnext">1.4. 更进一步</a></span></dt></dl></dd><dt><span class="chapter"><a href="#validator-usingvalidator">2. Validation step by step</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-usingvalidator-annotate">2.1. 定义约束</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e300">2.1.1. 字段级(field level) 约束</a></span></dt><dt><span class="section"><a href="#d0e322">2.1.2. 属性级别约束</a></span></dt><dt><span class="section"><a href="#d0e353">2.1.3. 类级别约束</a></span></dt><dt><span class="section"><a href="#d0e382">2.1.4. 约束继承</a></span></dt><dt><span class="section"><a href="#d0e431">2.1.5. 对象图</a></span></dt></dl></dd><dt><span class="section"><a href="#validator-usingvalidator-validate">2.2. 校验约束</a></span></dt><dd><dl><dt><span class="section"><a href="#section-obtaining-validator">2.2.1. 获取一个Validator的实例</a></span></dt><dt><span class="section"><a href="#d0e580">2.2.2. Validator中的方法</a></span></dt><dt><span class="section"><a href="#d0e669">2.2.3. ConstraintViolation 中的方法</a></span></dt><dt><span class="section"><a href="#section-message-interpolation">2.2.4. 验证失败提示信息解析</a></span></dt></dl></dd><dt><span class="section"><a href="#validator-usingvalidator-validationgroups">2.3. 校验组</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e982">2.3.1. 校验组序列</a></span></dt><dt><span class="section"><a href="#section-default-group-class">2.3.2. 对一个类重定义其默认校验组</a></span></dt></dl></dd><dt><span class="section"><a href="#validator-defineconstraints-builtin">2.4. 内置的约束条件</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-defineconstraints-spec">2.4.1. Bean Validation constraints</a></span></dt><dt><span class="section"><a href="#validator-defineconstraints-hv-constraints">2.4.2. Additional constraints</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#validator-customconstraints">3. 创建自己的约束规则</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-customconstraints-simple">3.1. 创建一个简单的约束条件</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-customconstraints-constraintannotation">3.1.1. 约束标注</a></span></dt><dt><span class="section"><a href="#validator-customconstraints-validator">3.1.2. 约束校验器</a></span></dt><dt><span class="section"><a href="#validator-customconstraints-errormessage">3.1.3. 校验错误信息</a></span></dt><dt><span class="section"><a href="#validator-customconstraints-using">3.1.4. 应用约束条件</a></span></dt></dl></dd><dt><span class="section"><a href="#validator-customconstraints-compound">3.2. 约束条件组合</a></span></dt></dl></dd><dt><span class="chapter"><a href="#validator-xmlconfiguration">4. XML configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2207">4.1. validation.xml</a></span></dt><dt><span class="section"><a href="#d0e2294">4.2. 映射约束</a></span></dt></dl></dd><dt><span class="chapter"><a href="#validator-bootstrapping">5. Bootstrapping</a></span></dt><dd><dl><dt><span class="section"><a href="#section-validator-instance">5.1. Configuration 和 ValidatorFactory</a></span></dt><dt><span class="section"><a href="#section-validation-provider-resolver">5.2. ValidationProviderResolver</a></span></dt><dt><span class="section"><a href="#section-message-interpolator">5.3. MessageInterpolator</a></span></dt><dd><dl><dt><span class="section"><a href="#section-resource-bundle-locator">5.3.1. ResourceBundleLocator</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2650">5.4. TraversableResolver</a></span></dt><dt><span class="section"><a href="#d0e2696">5.5. ConstraintValidatorFactory</a></span></dt></dl></dd><dt><span class="chapter"><a href="#validator-metadata-api">6. Metadata API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2751">6.1. BeanDescriptor</a></span></dt><dt><span class="section"><a href="#section-property-descriptor">6.2. PropertyDescriptor</a></span></dt><dt><span class="section"><a href="#d0e2825">6.3. ElementDescriptor</a></span></dt><dt><span class="section"><a href="#section-constraint-descriptor">6.4. ConstraintDescriptor</a></span></dt></dl></dd><dt><span class="chapter"><a href="#validator-integration">7. 与其他框架集成</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-osgi">7.1. OSGi</a></span></dt><dt><span class="section"><a href="#validator-checkconstraints-db">7.2. 与数据库集成校验</a></span></dt><dt><span class="section"><a href="#validator-checkconstraints-orm">7.3. ORM集成</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-checkconstraints-orm-hibernateevent">7.3.1. 基于Hibernate事件模型的校验</a></span></dt><dt><span class="section"><a href="#d0e3095">7.3.2. JPA</a></span></dt></dl></dd><dt><span class="section"><a href="#section-presentation-layer">7.4. 展示层校验</a></span></dt></dl></dd><dt><span class="chapter"><a href="#validator-specifics">8. Hibernate Validator Specifics</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3184">8.1. Public API</a></span></dt><dt><span class="section"><a href="#d0e3330">8.2. Fail fast mode</a></span></dt><dt><span class="section"><a href="#validator-customoptions-methodvalidation">8.3. Method validation</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3403">8.3.1. Defining method-level constraints</a></span></dt><dt><span class="section"><a href="#d0e3478">8.3.2. Evaluating method-level constraints</a></span></dt><dt><span class="section"><a href="#d0e3568">8.3.3. Retrieving method-level constraint meta data</a></span></dt></dl></dd><dt><span class="section"><a href="#programmaticapi">8.4. Programmatic constraint definition</a></span></dt><dt><span class="section"><a href="#d0e3700">8.5. Boolean composition for constraint composition</a></span></dt></dl></dd><dt><span class="chapter"><a href="#validator-annotation-processor">9. Annotation Processor</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-annotationprocessor-prerequisites">9.1. 前提条件</a></span></dt><dt><span class="section"><a href="#validator-annotationprocessor-features">9.2. 特性</a></span></dt><dt><span class="section"><a href="#validator-annotationprocessor-options">9.3. 配置项</a></span></dt><dt><span class="section"><a href="#validator-annotationprocessor-usage">9.4. 使用标注处理器</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-annotationprocessor-commandline">9.4.1. 命令行编译</a></span></dt><dt><span class="section"><a href="#validator-annotationprocessor-ide">9.4.2. IDE集成</a></span></dt></dl></dd><dt><span class="section"><a href="#validator-annotationprocessor-known-issues">9.5. 已知问题</a></span></dt></dl></dd><dt><span class="chapter"><a href="#validator-further-reading">10. 进一步阅读</a></span></dt></dl></div><div class="preface" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="preface"/>序言</h2></div></div></div><p>数据校验是任何一个应用程序都会用到的功能,无论是显示层还是持久层. 通常,相同的校验逻辑会分散在各个层中, 这样,不仅浪费了时间还会导致错误的发生(译注: 重复代码). 为了避免重复, 开发人员经常会把这些校验逻辑直接写在领域模型里面, 但是这样又把领域模型代码和校验代码混杂在了一起, 而这些校验逻辑更应该是描述领域模型的元数据.</p><div class="mediaobject"><img src="application-layers.png"/></div><p>JSR 303 - Bean Validation - 为实体验证定义了元数据模型和API. 默认的元数据模型是通过Annotations来描述的,但是也可以使用XML来重载或者扩展. Bean Validation API 并不局限于应用程序的某一层或者哪种编程模型, 例如,如图所示, Bean Validation 可以被用在任何一层, 或者是像类似Swing的富客户端程序中.</p><div class="mediaobject"><img src="application-layers2.png"/></div><p>Hibernate Validator is the reference implementation of this JSR. The implementation itself as well as the Bean Validation API and TCK are all provided and distributed under the <a class="ulink" href="http://www.apache.org/licenses/LICENSE-2.0">Apache Software License 2.0</a>.</p></div><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-gettingstarted"/>第 1 章 开始入门</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#validator-gettingstarted-createproject">1.1. Project set up</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-gettingstarted-logging">1.1.1. Logging</a></span></dt><dt><span class="section"><a href="#validator-gettingstarted-uel">1.1.2. Unified EL</a></span></dt><dt><span class="section"><a href="#validator-gettingstarted-cdi">1.1.3. CDI</a></span></dt></dl></dd><dt><span class="section"><a href="#validator-gettingstarted-createmodel">1.2. 添加约束</a></span></dt><dt><span class="section"><a href="#d0e196">1.3. 校验约束</a></span></dt><dt><span class="section"><a href="#validator-gettingstarted-whatsnext">1.4. 更进一步</a></span></dt></dl></div><p>本章将会告诉你如何使用Hibernate Validator, 在开始之前,你需要准备好下面的环境:</p><div class="itemizedlist"><ul><li><p>A JDK &gt;= 6</p></li><li><p><a class="ulink" href="http://maven.apache.org/">Apache Maven</a></p></li><li><p>网络连接 ( Maven需要通过互联网下载所需的类库)</p></li></ul></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-gettingstarted-createproject"/>1.1. Project set up</h2></div></div></div><p>In order to use Hibernate Validator within a Maven project, simply add the following dependency to your <code class="filename">pom.xml</code>:</p><div class="example"><a id="d0e89"/><p class="title"><b>例 1.1. Hibernate Validator Maven dependency</b></p><div class="example-contents"><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
    &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;
    &lt;version&gt;5.0.0.Final&lt;/version&gt;
&lt;/dependency&gt;</pre></div></div><p><br class="example-break"/></p><p>This transitively pulls in the dependency to the Bean Validation API (<code class="literal">javax.validation:validation-api:1.1.0.CR3</code>).</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-gettingstarted-logging"/>1.1.1. Logging</h3></div></div></div><p>For the purposes of logging, Hibernate Validator uses the JBoss Logging API. This is an abstraction layer which supports several known logging solutions (e.g. log4j or the logging framework provided by the JDK) as implementation. Just add your preferred logging library as dependency to your project and all log requests from Hibernate Validator will automatically be delegated to that logging provider.</p><p>If there are several logging implementations part of the classpath, you can explicitely specify a provider using the system property <code class="varname">org.jboss.logging.provider</code>. Supported values currently are <code class="varname">jboss</code>, <code class="varname">jdk</code>, <code class="varname">log4j</code> and <code class="varname">slf4j</code>.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-gettingstarted-uel"/>1.1.2. Unified EL</h3></div></div></div><p>Hibernate Validator requires an implementation of the Unified Expression Language (<a class="ulink" href="jcp.org/en/jsr/detail?id=341">JSR 341</a>) for evaluating dynamic expressions in constraint violation messages (see <a class="xref" href="#section-message-interpolation" title="2.2.4. 验证失败提示信息解析">第 2.2.4 节 “验证失败提示信息解析”</a>). When your application runs in a Java EE container such as JBoss AS, an EL implementation is already provided by the container. In a Java SE environment, however, you have to add an implementation as dependency to your POM file. For instance you can add the following two dependencies to use the JSR 341 <a class="ulink" href="http://uel.java.net/">reference implementation</a>:</p><div class="example"><a id="d0e134"/><p class="title"><b>例 1.2. Maven dependencies for Unified EL reference implementation</b></p><div class="example-contents"><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;javax.el&lt;/groupId&gt;
    &lt;artifactId&gt;javax.el-api&lt;/artifactId&gt;
    &lt;version&gt;2.2.4&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.glassfish.web&lt;/groupId&gt;
    &lt;artifactId&gt;javax.el&lt;/artifactId&gt;
    &lt;version&gt;2.2.4&lt;/version&gt;
&lt;/dependency&gt;</pre></div></div><br class="example-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-gettingstarted-cdi"/>1.1.3. CDI</h3></div></div></div><p>Bean Validation defines integration points with CDI (Contexts and Dependency Injection for Java<sup>TM</sup> EE, <a class="ulink" href="http://jcp.org/en/jsr/detail?id=346">JSR 346</a>). If your application runs in an environment which does not provide this integration out of the box, you may use the Hibernate Validator CDI portable extension by adding the following Maven dependency to your POM:</p><div class="example"><a id="d0e150"/><p class="title"><b>例 1.3. Hibernate Validator CDI portable extension Maven dependency</b></p><div class="example-contents"><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
    &lt;artifactId&gt;hibernate-validator-cdi&lt;/artifactId&gt;
    &lt;version&gt;5.0.0.Final&lt;/version&gt;
&lt;/dependency&gt;</pre></div></div><br class="example-break"/><p>Note that adding this dependency is usually not required for applications running on a Java EE application server. You can learn more about the integration of Bean Validation and CDI in section TODO.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-gettingstarted-createmodel"/>1.2. 添加约束</h2></div></div></div><p>Lets dive directly into an example to see how to apply constraints.</p><div class="example"><a id="example-class-car"/><p class="title"><b>例 1.4. 带约束性标注(annotated with constraints)的Car 类</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">validator</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">referenceguide</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">chapter01</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">Min</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">NotNull</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">Size</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Size</span><span class="java_separator">(</span><span class="java_plain">min&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">,</span><span class="java_plain">&nbsp;max&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">14</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licensePlate</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Min</span><span class="java_separator">(</span><span class="java_literal">2</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">manufacturer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">licensePlate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">seatCount&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getters&nbsp;and&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p><code class="classname">@NotNull</code>, <code class="classname">@Size</code> and <code class="classname">@Min</code>就是上面所属的约束性标注( constraint annotations), 我们就是使用它们来声明约束, 例如在<code class="classname">Car</code>的字段中我们可以看到:</p><div class="itemizedlist"><ul><li><p><span class="property">manufacturer</span>永远不能为null</p></li><li><p><span class="property">licensePlate</span>永远不能为null,并且它的值字符串的长度要在2到14之间</p></li><li><p><span class="property">seatCount</span>的值要不能小于2</p></li></ul></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="d0e196"/>1.3. 校验约束</h2></div></div></div><p>To perform a validation of these constraints, we use a <code class="classname">Validator</code> instance. Let's have a look at a unit test for <code class="classname">Car</code>:</p><div class="example"><a id="d0e207"/><p class="title"><b>例 1.5. 在CarTest中使用校验</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">validator</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">referenceguide</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">chapter01</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">util</span><span class="java_separator">.</span><span class="java_type">Set</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ConstraintViolation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Validation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Validator</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ValidatorFactory</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">junit</span><span class="java_separator">.</span><span class="java_type">BeforeClass</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">junit</span><span class="java_separator">.</span><span class="java_type">Test</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">junit</span><span class="java_separator">.</span><span class="java_type">Assert</span><span class="java_separator">.</span><span class="java_plain">assertEquals</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CarTest</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">BeforeClass</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setUp</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ValidatorFactory</span><span class="java_plain">&nbsp;factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Validation</span><span class="java_separator">.</span><span class="java_plain">buildDefaultValidatorFactory</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getValidator</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Test</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;manufacturerIsNull</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;DD-AB-123&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">4</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ConstraintViolation</span><span class="java_operator">&lt;</span><span class="java_type">Car</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;may&nbsp;not&nbsp;be&nbsp;null&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">iterator</span><span class="java_separator">().</span><span class="java_plain">next</span><span class="java_separator">().</span><span class="java_plain">getMessage</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Test</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;licensePlateTooShort</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Morris&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;D&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">4</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ConstraintViolation</span><span class="java_operator">&lt;</span><span class="java_type">Car</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;size&nbsp;must&nbsp;be&nbsp;between&nbsp;2&nbsp;and&nbsp;14&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">iterator</span><span class="java_separator">().</span><span class="java_plain">next</span><span class="java_separator">().</span><span class="java_plain">getMessage</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Test</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;seatCountTooLow</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Morris&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;DD-AB-123&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ConstraintViolation</span><span class="java_operator">&lt;</span><span class="java_type">Car</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;must&nbsp;be&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;2&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">iterator</span><span class="java_separator">().</span><span class="java_plain">next</span><span class="java_separator">().</span><span class="java_plain">getMessage</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Test</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;carIsValid</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Morris&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;DD-AB-123&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ConstraintViolation</span><span class="java_operator">&lt;</span><span class="java_type">Car</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>在<code class="methodname">setUp()</code>方法中,我们通过<code class="classname">ValidatorFactory</code>得到了一个<code class="classname">Validator</code>的实例. <code class="classname">Validator</code>是线程安全的,并且可以重复使用, 所以我们把它保存成一个类变量. 现在我们可以在test方法中使用这个validator的实例来校验不同的car实例了.</p><p><code class="methodname">validate()</code>方法会返回一个set的<code class="classname">ConstraintViolation</code>的实例的集合, 我们可以通过遍历它来查看有哪些验证错误. 前面三个测试用例显示了一些预期的校验约束:</p><div class="itemizedlist"><ul><li><p>在<code class="methodname">manufacturerIsNull()</code>中可以看到manufacturer违反了<code class="classname">@NotNull</code>约束</p></li><li><p><code class="methodname">licensePlateTooShort()</code>中的licensePlate违反了<code class="classname">@Size</code>约束</p></li><li><p>而<code class="methodname">seatCountTooLow()</code>中则导致seatCount违反了<code class="classname">@Min</code>约束</p></li></ul></div><p> 如果一个对象没有校验出问题的话,那么<code class="methodname">validate()</code> 会返回一个空的set对象.</p><p>注意,我们只使用了Bean Validation API中的package <span class="package">javax.validation</span>中的类, 并没有直接调用参考实现中的任何类,所以, 没有任何问题如果切换到其他的实现.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-gettingstarted-whatsnext"/>1.4. 更进一步</h2></div></div></div><p>That concludes our 5 minute tour through the world of Hibernate Validator. Continue exploring the code examples or look at further examples referenced in <a class="xref" href="#validator-further-reading" title="第 10 章 进一步阅读">第 10 章 <i>进一步阅读</i></a>. To deepen your understanding of Hibernate Validator just continue reading <a class="xref" href="#validator-usingvalidator" title="第 2 章 Validation step by step">第 2 章 <i>Validation step by step</i></a>. In case your application has specific validation requirements have a look at <a class="xref" href="#validator-customconstraints" title="第 3 章 创建自己的约束规则">第 3 章 <i>创建自己的约束规则</i></a>.</p></div></div><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-usingvalidator"/>第 2 章 Validation step by step</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#validator-usingvalidator-annotate">2.1. 定义约束</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e300">2.1.1. 字段级(field level) 约束</a></span></dt><dt><span class="section"><a href="#d0e322">2.1.2. 属性级别约束</a></span></dt><dt><span class="section"><a href="#d0e353">2.1.3. 类级别约束</a></span></dt><dt><span class="section"><a href="#d0e382">2.1.4. 约束继承</a></span></dt><dt><span class="section"><a href="#d0e431">2.1.5. 对象图</a></span></dt></dl></dd><dt><span class="section"><a href="#validator-usingvalidator-validate">2.2. 校验约束</a></span></dt><dd><dl><dt><span class="section"><a href="#section-obtaining-validator">2.2.1. 获取一个Validator的实例</a></span></dt><dt><span class="section"><a href="#d0e580">2.2.2. Validator中的方法</a></span></dt><dt><span class="section"><a href="#d0e669">2.2.3. ConstraintViolation 中的方法</a></span></dt><dt><span class="section"><a href="#section-message-interpolation">2.2.4. 验证失败提示信息解析</a></span></dt></dl></dd><dt><span class="section"><a href="#validator-usingvalidator-validationgroups">2.3. 校验组</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e982">2.3.1. 校验组序列</a></span></dt><dt><span class="section"><a href="#section-default-group-class">2.3.2. 对一个类重定义其默认校验组</a></span></dt></dl></dd><dt><span class="section"><a href="#validator-defineconstraints-builtin">2.4. 内置的约束条件</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-defineconstraints-spec">2.4.1. Bean Validation constraints</a></span></dt><dt><span class="section"><a href="#validator-defineconstraints-hv-constraints">2.4.2. Additional constraints</a></span></dt></dl></dd></dl></div><p>在本章中,我们会详细的介绍如何使用Hibernate Validator 来对一个给定的实体模型进行验证. 还会介绍Bean Validation规范提供了哪些默认的约束条件和Hibernate Validator提供了哪些额外的. 让我们先从如何给一个实体添加约束开始.</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-usingvalidator-annotate"/>2.1. 定义约束</h2></div></div></div><p>Bean Validation 的约束是通过Java 注解(annotations)来标注的. 在本节中,我们会介绍如何使用这些注解(annotations)来标注一个实体模型.  并且,我们会区分三种不通的注解(annotations) 类型.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>不是所有的约束都能够被用在所有的类结构上. 事实上, 没有任何定义在Bean Validation规范中的约束可以被用在class上. 约束定义中的<code class="classname">java.lang.annotation.Target</code>属性定义了这个约束能够被使用在哪个层次结构上. 详细信息请参考<a class="xref" href="#validator-customconstraints" title="第 3 章 创建自己的约束规则">第 3 章 <i>创建自己的约束规则</i></a>.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="d0e300"/>2.1.1. 字段级(field level) 约束</h3></div></div></div><p>约束条件能够被标注在类的字段上面, 请参考示例<a class="xref" href="#example-field-level" title="例 2.1. 字段级(field level) 约束">例 2.1 “字段级(field level) 约束”</a></p><div class="example"><a id="example-field-level"/><p class="title"><b>例 2.1. 字段级(field level) 约束</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">NotNull</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AssertTrue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isRegistered</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isRegistered</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">super</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">manufacturer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">isRegistered&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;isRegistered</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>当约束被定义在字段上的时候, 这个字段的值是通过字段访问策略来获取并验证的. 也就是说Bean Validation的实现者会直接访问这个实例变量而不会调用属性的访问器(getter) 即使这个方法存在.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>这个字段的访问级别( private, protected 或者 public) 对此没有影响.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>静态字段或者属性是不会被校验的.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>When validating byte code enhanced objects property level constraints should be used, because the byte code enhancing library won't be able to determine a field access via reflection.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="d0e322"/>2.1.2. 属性级别约束</h3></div></div></div><p>如果你的模型遵循<a class="ulink" href="http://java.sun.com/javase/technologies/desktop/javabeans/index.jsp">JavaBeans</a>规范的话, 你还可以把约束标注在属性上. <a class="xref" href="#example-property-level" title="例 2.2. 属性级约束">例 2.2 “属性级约束”</a>和<a class="xref" href="#example-field-level" title="例 2.1. 字段级(field level) 约束">例 2.1 “字段级(field level) 约束”</a>的唯一不同就是它的约束是定义在属性级别上的.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>如果要定义约束在属性级别上的话,那么只能定义在访问器(getter)上面,不能定义在修改器(setter)上.</p></div><div class="example"><a id="example-property-level"/><p class="title"><b>例 2.2. 属性级约束</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">AssertTrue</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">NotNull</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isRegistered</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isRegistered</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">super</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">manufacturer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">isRegistered&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;isRegistered</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getManufacturer</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setManufacturer</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">manufacturer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AssertTrue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isRegistered</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;isRegistered</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setRegistered</span><span class="java_separator">(</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isRegistered</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">isRegistered&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;isRegistered</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>When using property level constraints property access strategy is used to access the value to be validated. This means the bean validation provider accesses the state via the property accessor method. One advantage of annotating properties instead of fields is that the constraints become part of the constrained type's API that way and users are aware of the existing constraints without having to examine the type's implementation.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>It is recommended to stick either to field <span class="emphasis"><em>or</em></span> property annotations within one class. It is not recommended to annotate a field <span class="emphasis"><em>and</em></span> the accompanying getter method as this would cause the field to be validated twice.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="d0e353"/>2.1.3. 类级别约束</h3></div></div></div><p>Last but not least, a constraint can also be placed on class level. When a constraint annotation is placed on this level the class instance itself passed to the <code class="classname">ConstraintValidator</code>. Class level constraints are useful if it is necessary to inspect more than a single property of the class to validate it or if a correlation between different state variables has to be evaluated. In <a class="xref" href="#example-class-level" title="例 2.3. 类级别约束">例 2.3 “类级别约束”</a> we add the property <span class="property">passengers</span> to the class <code class="classname">Car</code>. We also add the constraint <code class="classname">PassengerCount</code> on the class level. We will later see how we can actually create this custom constraint (see <a class="xref" href="#validator-customconstraints" title="第 3 章 创建自己的约束规则">第 3 章 <i>创建自己的约束规则</i></a>). For now it is enough to know that <code class="classname">PassengerCount</code> will ensure that there cannot be more passengers in a car than there are seats.</p><div class="example"><a id="example-class-level"/><p class="title"><b>例 2.3. 类级别约束</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">Min</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">NotNull</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">Size</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">PassengerCount</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Size</span><span class="java_separator">(</span><span class="java_plain">min&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">,</span><span class="java_plain">&nbsp;max&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">14</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licensePlate</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Min</span><span class="java_separator">(</span><span class="java_literal">2</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;passengers</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">manufacturer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">licensePlate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">seatCount&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getters&nbsp;and&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="d0e382"/>2.1.4. 约束继承</h3></div></div></div><p>如果要验证的对象继承于某个父类或者实现了某个接口,那么定义在父类或者接口中的约束会在验证这个对象的时候被自动加载,如同这些约束定义在这个对象所在的类中一样. 让我们来看看下面的示例:</p><div class="example"><a id="d0e387"/><p class="title"><b>例 2.4. 约束继承</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">NotNull</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">RentalCar</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;rentalStation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">RentalCar</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;rentalStation</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">super</span><span class="java_separator">(</span><span class="java_plain">manufacturer</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">rentalStation&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rentalStation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getRentalStation</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;rentalStation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setRentalStation</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;rentalStation</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">rentalStation&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rentalStation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>我们有了一个新的<code class="classname">RentalCar</code>类继承自前面我们已经见到的<code class="classname">Car</code>, 这个子类中增加了一个<span class="property">rentalStation</span>属性. 如果校验一个<code class="classname">RentalCar</code>的实例对象, 那么不仅会验证属性<span class="property">rentalStation</span>上的 <code class="classname">@NotNull</code>约束是否合法,还会校验父类中的<span class="property">manufacturer</span>属性.</p><p>如果类<code class="classname">Car</code>是一个接口类型的话也是一样的效果.</p><p>如果类<code class="classname">RentalCar</code> 重写了父类<code class="classname">Car</code>的<code class="methodname">getManufacturer()</code>方法, 那么定义在父类的这个方法上的约束和子类这个方法上定义的约束都会被校验.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="d0e431"/>2.1.5. 对象图</h3></div></div></div><p>Bean Validation API不仅能够用来校验单个的实例对象,还能够用来校验完整的对象图.要使用这个功能,只需要在一个有关联关系的字段或者属性上标注<code class="classname">@Valid</code>. 这样,如果一个对象被校验,那么它的所有的标注了<code class="classname">@Valid</code>的关联对象都会被校验. 请看<a class="xref" href="#example-car-with-driver" title="例 2.6. Adding a driver to the car">例 2.6 “Adding a driver to the car”</a>.</p><div class="example"><a id="d0e444"/><p class="title"><b>例 2.5. Class Person</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">NotNull</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">super</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setName</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div class="example"><a id="example-car-with-driver"/><p class="title"><b>例 2.6. Adding a driver to the car</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Valid</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">NotNull</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Valid</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;driver</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_type">Person</span><span class="java_plain">&nbsp;driver</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">driver&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;driver</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getters&nbsp;and&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>如果校验<code class="classname">Car</code>的实例对象的话,因为它的<span class="property">driver</span>属性标注了<code class="classname">@Valid</code>, 那么关联的<code class="classname">Person</code>也会被校验. 所以,如果对象<code class="classname">Person</code>的<span class="property">name</span>属性如果是<code class="code">null</code>的话,那么校验会失败.</p><p>关联校验也适用于集合类型的字段, 也就是说,任何下列的类型:</p><div class="itemizedlist"><ul><li><p>数组</p></li><li><p>实现了<code class="classname">java.lang.Iterable</code>接口( 例如<code class="classname">Collection</code>, <code class="classname">List</code> 和 <code class="classname">Set</code>)</p></li><li><p>实现了<code class="classname">java.util.Map</code>接口</p></li></ul></div><p>如果标注了<code class="classname">@Valid</code>, 那么当主对象被校验的时候,这些集合对象中的元素都会被校验.</p><div class="example"><a id="d0e509"/><p class="title"><b>例 2.7. Car with a list of passengers</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">util</span><span class="java_separator">.</span><span class="java_type">ArrayList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">util</span><span class="java_separator">.</span><span class="java_type">List</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Valid</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">NotNull</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Valid</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;passengers&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;passengers</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">passengers&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;passengers</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getters&nbsp;and&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>当校验一个<code class="classname">Car</code>的实例的时候,如果<span class="property">passengers</span> list中包含的任何一个<code class="classname">Person</code>对象没有名字的话,都会导致校验失败(a <code class="classname">ConstraintValidation</code> will be created).</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>对象图校验的时候是会被忽略<code class="classname">null</code>值的.</p></div></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-usingvalidator-validate"/>2.2. 校验约束</h2></div></div></div><p><code class="classname">Validator</code> 是Bean Validation中最主要的接口, 我们会在<a class="xref" href="#section-validator-instance" title="5.1. Configuration 和 ValidatorFactory">第 5.1 节 “Configuration 和 ValidatorFactory”</a>中详细介绍如何获取一个<code class="classname">Validator</code>的实例, 现在先让我们来看看如何使用<code class="classname">Validator</code>接口中的各个方法. </p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="section-obtaining-validator"/>2.2.1. 获取一个<code class="classname">Validator</code>的实例</h3></div></div></div><p>对一个实体对象验证之前首先需要有个<code class="classname">Validator</code>对象, 而这个对象是需要通过<code class="classname">Validation</code> 类和 <code class="classname">ValidatorFactory</code>来创建的. 最简单的方法是调用<code class="methodname">Validation.buildDefaultValidatorFactory()</code> 这个静态方法. </p><div class="example"><a id="d0e569"/><p class="title"><b>例 2.8. Validation.buildDefaultValidatorFactory()</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">ValidatorFactory</span><!-- <br/> --><span class="java_plain">&nbsp;factory&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Validation</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">buildDefaultValidatorFactory</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getValidator</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p><a class="xref" href="#validator-bootstrapping" title="第 5 章 Bootstrapping">第 5 章 <i>Bootstrapping</i></a>介绍了其他的获取Validator实例的方法. 现在我们的目标是学习如何使用<code class="classname">Validator</code> 来校验实体对象.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="d0e580"/>2.2.2. Validator中的方法</h3></div></div></div><p><code class="classname">Validator</code>中有三个方法能够被用来校验整个实体对象或者实体对象中的属性.</p><p>这三个方法都会返回一个<code class="classname">Set&lt;ConstraintViolation&gt;</code>对象, 如果整个验证过程没有发现问题的话,那么这个set是空的, 否则, 每个违反约束的地方都会被包装成一个<code class="classname">ConstraintViolation</code>的实例然后添加到set当中. </p><p>All the validation methods have a var-args parameter which can be used to specify, which validation groups shall be considered when performing the validation. If the parameter is not specified the default validation group (<code class="classname">javax.validation.groups.Default</code>) will be used. We will go into more detail on the topic of validation groups in <a class="xref" href="#validator-usingvalidator-validationgroups" title="2.3. 校验组">第 2.3 节 “校验组”</a></p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="d0e601"/>2.2.2.1. <code class="methodname">validate</code></h4></div></div></div><p>使用<code class="methodname">validate()</code>方法对一个给定的实体对象中定义的所有约束条件进行校验 (<a class="xref" href="#example-validator-validate" title="例 2.9. Validator.validate() 使用方法">例 2.9 “Validator.validate() 使用方法”</a> ).</p><div class="example"><a id="example-validator-validate"/><p class="title"><b>例 2.9. <code class="methodname">Validator.validate()</code> 使用方法</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">ValidatorFactory</span><!-- <br/> --><span class="java_plain">&nbsp;factory&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Validation</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">buildDefaultValidatorFactory</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getValidator</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">Car</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_literal">null</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ConstraintViolation</span><span class="java_operator">&lt;</span><span class="java_type">Car</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">car</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">assertEquals</span><span class="java_separator">(</span><span class="java_literal">1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">assertEquals</span><span class="java_separator">(</span><span class="java_literal">&quot;may&nbsp;not&nbsp;be&nbsp;null&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">iterator</span><span class="java_separator">().</span><span class="java_plain">next</span><span class="java_separator">().</span><span class="java_plain">getMessage</span><span class="java_separator">());</span></pre></div></div><br class="example-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="d0e619"/>2.2.2.2. <code class="methodname">validateProperty</code></h4></div></div></div><p>通过<code class="methodname">validateProperty()</code>可以对一个给定实体对象的单个属性进行校验. 其中属性名称需要符合JavaBean规范中定义的属性名称.</p><div class="example"><a id="d0e628"/><p class="title"><b>例 2.10. <code class="methodname">Validator.validateProperty()</code>使用方法</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Validator</span><!-- <br/> --><span class="java_plain">&nbsp;validator&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Validation</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">buildDefaultValidatorFactory</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">getValidator</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">Car</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_literal">null</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ConstraintViolation</span><span class="java_operator">&lt;</span><span class="java_type">Car</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validateProperty</span><span class="java_separator">(</span><span class="java_plain">car</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;manufacturer&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">assertEquals</span><span class="java_separator">(</span><span class="java_literal">1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">assertEquals</span><span class="java_separator">(</span><span class="java_literal">&quot;may&nbsp;not&nbsp;be&nbsp;null&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">iterator</span><span class="java_separator">().</span><span class="java_plain">next</span><span class="java_separator">().</span><span class="java_plain">getMessage</span><span class="java_separator">());</span></pre></div></div><br class="example-break"/><p>例如, <code class="methodname">Validator.validateProperty</code>可以被用在把Bean Validation集成进JSF 2中的时候使用 (请参考 <a class="xref" href="#section-presentation-layer" title="7.4. 展示层校验">第 7.4 节 “展示层校验”</a>).</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="d0e642"/>2.2.2.3. <code class="methodname">validateValue</code></h4></div></div></div><p>通过<code class="methodname">validateValue() </code>方法,你能够校验如果把一个特定的值赋给一个类的某一个属性的话,是否会违反此类中定义的约束条件.</p><div class="example"><a id="d0e651"/><p class="title"><b>例 2.11. <code class="methodname">Validator.validateValue()</code> 使用方法</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Validator</span><!-- <br/> --><span class="java_plain">&nbsp;validator&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Validation</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">buildDefaultValidatorFactory</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">getValidator</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ConstraintViolation</span><span class="java_operator">&lt;</span><span class="java_type">Car</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validateValue</span><span class="java_separator">(</span><span class="java_type">Car</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;manufacturer&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">assertEquals</span><span class="java_separator">(</span><span class="java_literal">1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">assertEquals</span><span class="java_separator">(</span><span class="java_literal">&quot;may&nbsp;not&nbsp;be&nbsp;null&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">iterator</span><span class="java_separator">().</span><span class="java_plain">next</span><span class="java_separator">().</span><span class="java_plain">getMessage</span><span class="java_separator">());</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p><code class="methodname">validateProperty()</code> 和 <code class="methodname">validateValue()</code> 会忽略被验证属性上定义的<code class="classname">@Valid</code>.</p></div></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="d0e669"/>2.2.3. <code class="classname">ConstraintViolation</code> 中的方法</h3></div></div></div><p>现在是时候看看究竟<code class="classname">ConstraintViolation</code>是什么了. <code class="classname">ConstraintViolation</code>中包含了很多方法能够帮你快速定位究竟是什么导致了校验失败.<a class="xref" href="#table-constraint-violation" title="表 2.1. ConstraintViolation 中的方法">表 2.1 “ConstraintViolation 中的方法”</a> 列出了这些方法:</p><div class="table"><a id="table-constraint-violation"/><p class="title"><b>表 2.1. <code class="classname">ConstraintViolation</code> 中的方法</b></p><div class="table-contents"><table summary="ConstraintViolation 中的方法" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>方法名</th><th>作用</th><th>示例 (请参考<a class="xref" href="#example-validator-validate" title="例 2.9. Validator.validate() 使用方法">例 2.9 “Validator.validate() 使用方法”</a>)</th></tr></thead><tbody><tr><td><code class="methodname">getMessage()</code></td><td>获取(经过翻译的)校验错误信息</td><td>may not be null</td></tr><tr><td><code class="methodname">getMessageTemplate()</code></td><td>获取错误信息模版</td><td>{javax.validation.constraints.NotNull.message}</td></tr><tr><td><code class="methodname">getRootBean()</code></td><td>获取被校验的根实体对象</td><td>car</td></tr><tr><td><code class="methodname">getRootBeanClass()</code></td><td>获取被校验的根实体类.</td><td>Car.class</td></tr><tr><td><code class="methodname">getLeafBean()</code></td><td>如果约束是添加在一个bean(实体对象)上的,那么则返回这个bean的实例, 如果是约束是定义在一个属性上的, 则返回这个属性所属的bean的实例对象. </td><td>car</td></tr><tr><td><code class="methodname">getPropertyPath()</code></td><td>从被验证的根对象到被验证的属性的路径.</td><td> </td></tr><tr><td><code class="methodname">getInvalidValue()</code></td><td>倒是校验失败的值.</td><td>passengers</td></tr><tr><td><code class="methodname">getConstraintDescriptor()</code></td><td>导致校验失败的约束定义.</td><td> </td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="section-message-interpolation"/>2.2.4. 验证失败提示信息解析</h3></div></div></div><p>在<a class="xref" href="#validator-customconstraints" title="第 3 章 创建自己的约束规则">第 3 章 <i>创建自己的约束规则</i></a>中,我们会看到,每个约束定义中都包含有一个用于提示验证结果的消息模版, 并且在声明一个约束条件的时候,你可以通过这个约束中的<code class="methodname">message</code>属性来重写默认的消息模版, 可以参考<a class="xref" href="#example-driver" title="例 2.13. Driver">例 2.13 “Driver”</a>. 如果在校验的时候,这个约束条件没有通过,那么你配置的<code class="classname">MessageInterpolator</code>会被用来当成解析器来解析这个约束中定义的消息模版, 从而得到最终的验证失败提示信息. 这个解析器会尝试解析模版中的占位符( 大括号括起来的字符串 ). 其中, Hibernate Validator中默认的解析器 (<code class="classname">MessageInterpolator</code>) 会先在类路径下找名称为<code class="filename">ValidationMessages.properties</code>的<code class="classname">ResourceBundle</code>, 然后将占位符和这个文件中定义的resource进行匹配,如果匹配不成功的话,那么它会继续匹配Hibernate Validator自带的位于<code class="filename">/org/hibernate/validator/ValidationMessages.properties</code>的<code class="classname">ResourceBundle</code>, 依次类推,递归的匹配所有的占位符.</p><p>因为大括号{ 在这里是特殊字符,所以,你可以通过使用反斜线来对其进行转义, 例如:</p><div class="itemizedlist"><ul><li><p>\{ 被转义成 {</p></li><li><p>\} 被转义成 }</p></li><li><p>\\ 被转义成 \</p></li></ul></div><p>如果默认的消息解析器不能够满足你的需求,那么你也可以在创建<code class="classname">ValidatorFactory</code>的时候, 将其替换为一个你自定义的<code class="classname">MessageInterpolator</code>, 具体请参考 <a class="xref" href="#validator-bootstrapping" title="第 5 章 Bootstrapping">第 5 章 <i>Bootstrapping</i></a>.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-usingvalidator-validationgroups"/>2.3. 校验组</h2></div></div></div><p>校验组能够让你在验证的时候选择应用哪些约束条件. 这样在某些情况下( 例如向导 ) 就可以对每一步进行校验的时候, 选取对应这步的那些约束条件进行验证了. 校验组是通过可变参数传递给<code class="methodname">validate</code>, <code class="methodname">validateProperty</code> 和 <code class="methodname">validateValue</code>的. 让我们来看个例子, 这个实例扩展了上面的<code class="classname">Car</code>类,又为其添加了一个新的<code class="classname">Driver</code>. 首先, 类<code class="classname">Person</code> (<a class="xref" href="#example-person" title="例 2.12. Person">例 2.12 “Person”</a>) 的<span class="property">name</span>属性上定义了一个<code class="classname">@NotNull </code>的约束条件. 因为没有明确指定这个约束条件属于哪个组,所以它被归类到默认组 (<code class="classname">javax.validation.groups.Default</code>).</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>如果某个约束条件属于多个组,那么各个组在校验时候的顺序是不可预知的. 如果一个约束条件没有被指明属于哪个组,那么它就会被归类到默认组(<code class="classname">javax.validation.groups.Default</code>).</p></div><div class="example"><a id="example-person"/><p class="title"><b>例 2.12. Person</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters&nbsp;and&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>接下来, 我们让类<code class="classname">Driver</code> (<a class="xref" href="#example-driver" title="例 2.13. Driver">例 2.13 “Driver”</a>) 继承自类<code class="classname">Person</code>. 然后添加两个属性,分别是<span class="property">age</span> 和 <span class="property">hasDrivingLicense</span>. 对于一个司机来说, 要开车的话, 必须满足两个条件, 年满18周岁 (<code class="classname">@Min(18)</code>) 和你的有驾照(<code class="classname">@AssertTrue</code>). 这两个约束条件分别定义在那两个属性上, 并且把他们都归于<code class="classname">DriverChecks</code>组. 通过<a class="xref" href="#example-group-interfaces" title="例 2.14. Group interfaces">例 2.14 “Group interfaces”</a>, 你可以看到, "<code class="classname">DriverChecks</code>组" 就是一个简单的标记接口. 使用接口( 而不是字符串) 可以做到类型安全,并且接口比字符串更加对重构友好, 另外, 接口还意味着一个组可以继承别的组.</p><div class="example"><a id="example-driver"/><p class="title"><b>例 2.13. Driver</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Driver</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Min</span><span class="java_separator">(</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">18</span><span class="java_separator">,</span><span class="java_plain">&nbsp;message&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;You&nbsp;have&nbsp;to&nbsp;be&nbsp;18&nbsp;to&nbsp;drive&nbsp;a&nbsp;car&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;groups&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">DriverChecks</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;age</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AssertTrue</span><span class="java_separator">(</span><span class="java_plain">message&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;You&nbsp;first&nbsp;have&nbsp;to&nbsp;pass&nbsp;the&nbsp;driving&nbsp;test&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;groups&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">DriverChecks</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;hasDrivingLicense</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Driver</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">super</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;passedDrivingTest</span><span class="java_separator">(</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;b</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hasDrivingLicense&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;b</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getAge</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;age</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setAge</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_plain">&nbsp;age</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">age&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;age</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div class="example"><a id="example-group-interfaces"/><p class="title"><b>例 2.14. Group interfaces</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">DriverChecks</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">CarChecks</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>最后, 我们给<code class="classname">Car</code> class (<a class="xref" href="#example-car" title="例 2.15. Car">例 2.15 “Car”</a>) 添加一个<span class="property">passedVehicleInspection</span>的属性,来表示这个车是否通过了上路检查.</p><div class="example"><a id="example-car"/><p class="title"><b>例 2.15. Car</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Car</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Size</span><span class="java_separator">(</span><span class="java_plain">min&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">,</span><span class="java_plain">&nbsp;max&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">14</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licensePlate</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Min</span><span class="java_separator">(</span><span class="java_literal">2</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AssertTrue</span><span class="java_separator">(</span><span class="java_plain">message&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;The&nbsp;car&nbsp;has&nbsp;to&nbsp;pass&nbsp;the&nbsp;vehicle&nbsp;inspection&nbsp;first&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;groups&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">CarChecks</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;passedVehicleInspection</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Valid</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Driver</span><span class="java_plain">&nbsp;driver</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">manufacturer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">licensePlate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">seatCount&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>现在, 在我们的例子中有三个不同的校验组, <span class="property">Person.name</span>, <span class="property">Car.manufacturer</span>, <span class="property">Car.licensePlate</span> 和 <span class="property">Car.seatCount</span>都属于默认(<code class="classname">Default</code>) 组, <span class="property">Driver.age</span> 和 <span class="property">Driver.hasDrivingLicense</span> 从属于 <code class="classname">DriverChecks</code>组, 而<span class="property">Car.passedVehicleInspection</span> 在<code class="classname">CarChecks</code>组中. <a class="xref" href="#example-drive-away" title="例 2.16. Drive away">例 2.16 “Drive away”</a>演示了如何让<code class="methodname">Validator.validate</code>验证不同的组来得到不同的校验结果.</p><div class="example"><a id="example-drive-away"/><p class="title"><b>例 2.16. Drive away</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">GroupTest</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">BeforeClass</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setUp</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ValidatorFactory</span><span class="java_plain">&nbsp;factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Validation</span><span class="java_separator">.</span><span class="java_plain">buildDefaultValidatorFactory</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getValidator</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Test</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;driveAway</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;create&nbsp;a&nbsp;car&nbsp;and&nbsp;check&nbsp;that&nbsp;everything&nbsp;is&nbsp;ok&nbsp;with&nbsp;it</span><span class="java_separator">.</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Morris&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;DD-AB-123&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ConstraintViolation</span><span class="java_operator">&lt;</span><span class="java_type">Car</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;but&nbsp;has&nbsp;it&nbsp;passed&nbsp;the&nbsp;vehicle&nbsp;inspection</span><span class="java_operator">?</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;car</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CarChecks</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_literal">&quot;The&nbsp;car&nbsp;has&nbsp;to&nbsp;pass&nbsp;the&nbsp;vehicle&nbsp;inspection&nbsp;first&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">iterator</span><span class="java_separator">().</span><span class="java_plain">next</span><span class="java_separator">().</span><span class="java_plain">getMessage</span><span class="java_separator">());</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;let's&nbsp;go&nbsp;to&nbsp;the&nbsp;vehicle&nbsp;inspection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car</span><span class="java_separator">.</span><span class="java_plain">setPassedVehicleInspection</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">,</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_separator">).</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;now&nbsp;let's&nbsp;add&nbsp;a&nbsp;driver</span><span class="java_separator">.</span><span class="java_plain">&nbsp;</span><span class="java_type">He</span><span class="java_plain">&nbsp;is&nbsp;</span><span class="java_literal">18</span><span class="java_separator">,</span><span class="java_plain">&nbsp;but&nbsp;has&nbsp;not&nbsp;passed&nbsp;the&nbsp;driving&nbsp;test&nbsp;yet</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Driver</span><span class="java_plain">&nbsp;john&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Driver</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;John&nbsp;Doe&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;john</span><span class="java_separator">.</span><span class="java_plain">setAge</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">18</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car</span><span class="java_separator">.</span><span class="java_plain">setDriver</span><span class="java_separator">(</span><span class="java_plain">&nbsp;john&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;car</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">DriverChecks</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;You&nbsp;first&nbsp;have&nbsp;to&nbsp;pass&nbsp;the&nbsp;driving&nbsp;test&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">iterator</span><span class="java_separator">().</span><span class="java_plain">next</span><span class="java_separator">().</span><span class="java_plain">getMessage</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;ok</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">John</span><span class="java_plain">&nbsp;passes&nbsp;the&nbsp;test</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;john</span><span class="java_separator">.</span><span class="java_plain">passedDrivingTest</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">,</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;car</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">DriverChecks</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;just&nbsp;checking&nbsp;that&nbsp;everything&nbsp;is&nbsp;in&nbsp;order&nbsp;now</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">,</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;car</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Default</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CarChecks</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">DriverChecks</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>首先我们创建一辆汽车然后在没有明确指定使用哪个校验组的情况下校验它, 可以看到即使<span class="property">passedVehicleInspection</span>的默认值是<code class="constant">false</code>也不会校验出错误来. 因为定义在这个属性上的约束条件并不属于默认的校验组, 接下来,我们来校验<code class="classname">CarChecks</code>这个组, 这样就会发现car违反了约束条件, 必须让这个车先通过检测. 接下来,我们给这个车增加一个司机, 然后在基于<code class="classname">DriverChecks</code>来校验, 会发现因为这个司机因为还没有通过驾照考试, 所以又一次得到了校验错误, 如果我们设置<span class="property">passedDrivingTest</span>属性为<code class="constant">true</code>之后, <code class="classname">DriverChecks</code>组的校验就通过了.</p><p>最后, 让我们再来校验所有的组中定义的约束条件,可以看到所有的约束条件都通过了验证.</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="d0e982"/>2.3.1. 校验组序列</h3></div></div></div><p>By default, constraints are evaluated in no particular order, regardless of which groups they belong to. In some situations, however, it is useful to control the order constraints are evaluated. In our example from <a class="xref" href="#validator-usingvalidator-validationgroups" title="2.3. 校验组">第 2.3 节 “校验组”</a> we could for example require that first all default car constraints are passing before we check the road worthiness of the car. Finally before we drive away we check the actual driver constraints. In order to implement such an order one would define a new interface and annotate it with <code class="classname">@GroupSequence</code> defining the order in which the groups have to be validated.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>If at least one constraint fails in a sequenced group none of the constraints of the following groups in the sequence get validated.</p></div><div class="example"><a id="example-orderedChecks"/><p class="title"><b>例 2.17. 标注了@GroupSequence的接口</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">GroupSequence</span><!-- <br/> --><span class="java_separator">({</span><!-- <br/> --><span class="java_type">Default</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">CarChecks</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">DriverChecks</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">OrderedChecks</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>警告</h2><p>一个校验组序列中包含的校验组和这个校验组序列不能造成直接或者间接的循环引用. 包括校验组继承. 如果造成了循环引用的话, 会导致<code class="classname">GroupDefinitionException</code>异常.</p></div><p><a class="xref" href="#example-group-sequence" title="例 2.18. 校验组序列的用法">例 2.18 “校验组序列的用法”</a>展示了校验组序列的用法.</p><div class="example"><a id="example-group-sequence"/><p class="title"><b>例 2.18. 校验组序列的用法</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Test</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;testOrderedChecks</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Morris&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;DD-AB-123&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;car</span><span class="java_separator">.</span><span class="java_plain">setPassedVehicleInspection</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Driver</span><span class="java_plain">&nbsp;john&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Driver</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;John&nbsp;Doe&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;john</span><span class="java_separator">.</span><span class="java_plain">setAge</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">18</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;john</span><span class="java_separator">.</span><span class="java_plain">passedDrivingTest</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;car</span><span class="java_separator">.</span><span class="java_plain">setDriver</span><span class="java_separator">(</span><span class="java_plain">&nbsp;john&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">,</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;car</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">OrderedChecks</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="section-default-group-class"/>2.3.2. 对一个类重定义其默认校验组</h3></div></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1017"/>2.3.2.1. @GroupSequence</h4></div></div></div><p>The <code class="classname">@GroupSequence</code> annotation also fulfills a second purpose. It allows you to redefine what the <code class="constant">Default</code> group means for a given class. To redefine <code class="classname">Default</code> for a given class, add a <code class="classname">@GroupSequence</code> annotation to the class. The defined groups in the annotation express the sequence of groups that substitute <code class="classname">Default</code> for this class. <a class="xref" href="#example-rental-car" title="例 2.19. RentalCar with @GroupSequence">例 2.19 “RentalCar with @GroupSequence”</a> introduces a new class <code class="classname">RentalCar</code> with a redefined default group. With this definition you can evaluate the constraints belonging to <code class="classname">RentalChecks</code>, <code class="classname">CarChecks</code> and <code class="classname">RentalCar</code> by just requesting the <code class="classname">Default</code> group as seen in <a class="xref" href="#example-testCarIsRented" title="例 2.20. RentalCar with redefined default group">例 2.20 “RentalCar with redefined default group”</a>.</p><div class="example"><a id="example-rental-car"/><p class="title"><b>例 2.19. RentalCar with @GroupSequence</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">GroupSequence</span><!-- <br/> --><span class="java_separator">({</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">RentalChecks</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">CarChecks</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">RentalCar</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">RentalCar</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AssertFalse</span><span class="java_separator">(</span><span class="java_plain">message&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;The&nbsp;car&nbsp;is&nbsp;currently&nbsp;rented&nbsp;out&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;groups&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">RentalChecks</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;rented</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">RentalCar</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">super</span><span class="java_separator">(</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">,</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">,</span><span class="java_plain">&nbsp;seatCount&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isRented</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;rented</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setRented</span><span class="java_separator">(</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;rented</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">rented&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rented</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div class="example"><a id="example-testCarIsRented"/><p class="title"><b>例 2.20. RentalCar with redefined default group</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;Validating&nbsp;the&nbsp;default&nbsp;group&nbsp;leads&nbsp;to&nbsp;validation&nbsp;on&nbsp;the&nbsp;default&nbsp;group&nbsp;sequence&nbsp;of&nbsp;{</span><span class="java_javadoc_tag">@code</span><span class="java_javadoc_comment">&nbsp;RentalCar}.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*/</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Test</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;carIsRented</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">RentalCar</span><span class="java_plain">&nbsp;rentalCar&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">RentalCar</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Morris&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;DD-AB-123&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;rentalCar</span><span class="java_separator">.</span><span class="java_plain">setPassedVehicleInspection</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;rentalCar</span><span class="java_separator">.</span><span class="java_plain">setRented</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ConstraintViolation</span><span class="java_operator">&lt;</span><span class="java_type">RentalCar</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;rentalCar&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;Wrong&nbsp;message&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;The&nbsp;car&nbsp;is&nbsp;currently&nbsp;rented&nbsp;out&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">iterator</span><span class="java_separator">().</span><span class="java_plain">next</span><span class="java_separator">().</span><span class="java_plain">getMessage</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;rentalCar</span><span class="java_separator">.</span><span class="java_plain">setRented</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;rentalCar&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>Due to the fact that there cannot be a cyclic dependency in the group and group sequence definitions one cannot just add <code class="classname">Default</code> to the sequence redefining <code class="classname">Default</code> for a class. Instead the class itself has to be added!</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>The <code class="classname">Default</code> group sequence overriding is local to the class it is defined on and is not propagated to the associated objects. This means in particular that adding <code class="classname">DriverChecks</code> to the default group sequence of <code class="classname">RentalCar</code> would not have any effects. Only the group <code class="classname">Default</code> will be propagated to the driver association when validation a rental car instance.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1090"/>2.3.2.2. @GroupSequenceProvider</h4></div></div></div><p>The <code class="classname">@javax.validation.GroupSequence</code> annotation is a standardized Bean Validation annotation. As seen in the previous section it allows you to statically redefine the default group sequence for a class. Hibernate Validator also offers a custom, non standardized annotation - <code class="classname">org.hibernate.validator.group.GroupSequenceProvider </code>- which allows for dynamic redefinition of the default group sequence. Using the rental car scenario again, one could dynamically add the <code class="classname">CarChecks</code> as seen in <a class="xref" href="#example-rental-car-group-sequence-provider" title="例 2.21. RentalCar with @GroupSequenceProvider">例 2.21 “RentalCar with @GroupSequenceProvider”</a> and <a class="xref" href="#example-group-sequence-provider-implementation" title="例 . DefaultGroupSequenceProvider implementation">例  “DefaultGroupSequenceProvider implementation”</a>.</p><div class="example"><a id="example-rental-car-group-sequence-provider"/><p class="title"><b>例 2.21. RentalCar with @GroupSequenceProvider</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">GroupSequenceProvider</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">RentalCarGroupSequenceProvider</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">RentalCar</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AssertFalse</span><span class="java_separator">(</span><span class="java_plain">message&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;The&nbsp;car&nbsp;is&nbsp;currently&nbsp;rented&nbsp;out&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;groups&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">RentalChecks</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;rented</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">RentalCar</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">super</span><span class="java_separator">(</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">,</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">,</span><span class="java_plain">&nbsp;seatCount&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isRented</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;rented</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setRented</span><span class="java_separator">(</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;rented</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">rented&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rented</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div class="example"><a id="example-group-sequence-provider-implementation"/><p class="title"><b>例 . DefaultGroupSequenceProvider implementation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">RentalCarGroupSequenceProvider</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">DefaultGroupSequenceProvider</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">RentalCar</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;&gt;</span><span class="java_plain">&nbsp;getValidationGroups</span><span class="java_separator">(</span><span class="java_type">RentalCar</span><span class="java_plain">&nbsp;car</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;&gt;</span><span class="java_plain">&nbsp;defaultGroupSequence&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;&gt;</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defaultGroupSequence</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">RentalCar</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_operator">!=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_plain">&nbsp;</span><span class="java_operator">&amp;&amp;</span><span class="java_plain">&nbsp;</span><span class="java_operator">!</span><span class="java_plain">car</span><span class="java_separator">.</span><span class="java_plain">isRented</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defaultGroupSequence</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CarChecks</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;defaultGroupSequence</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-defineconstraints-builtin"/>2.4. 内置的约束条件</h2></div></div></div><p>Hibernate Validator comprises a basic set of commonly used constraints. These are foremost the constraints defined by the Bean Validation specification (see <a class="xref" href="#table-spec-constraints" title="表 2.2. Bean Validation constraints">表 2.2 “Bean Validation constraints”</a>). Additionally, Hibernate Validator provides useful custom constraints (see <a class="xref" href="#table-custom-constraints" title="表 2.3. Custom constraints">表 2.3 “Custom constraints”</a> and <a class="xref" href="#table-custom-country-constraints" title="表 2.4. Custom country specific constraints">表 2.4 “Custom country specific constraints”</a>).</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-defineconstraints-spec"/>2.4.1. Bean Validation constraints</h3></div></div></div><p><a class="xref" href="#table-spec-constraints" title="表 2.2. Bean Validation constraints">表 2.2 “Bean Validation constraints”</a> shows purpose and supported data types of all constraints specified in the Bean Validation API. All these constraints apply to the field/property level, there are no class-level constraints defined in the Bean Validation specification. If you are using the Hibernate object-relational mapper, some of the constraints are taken into account when creating the DDL for your model (see column "Hibernate metadata impact").</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>Hibernate Validator allows some constraints to be applied to more data types than required by the Bean Validation specification (e.g. @Max can be applied to <code class="classname">Strings</code>). Relying on this feature can impact portability of your application between Bean Validation providers.</p></div><div class="table"><a id="table-spec-constraints"/><p class="title"><b>表 2.2. Bean Validation constraints</b></p><div class="table-contents"><table summary="Bean Validation constraints" border="1"><colgroup><col align="left"/><col align="left"/><col align="left"/><col align="left"/></colgroup><thead><tr><th align="left">Annotation</th><th align="left">Supported data types</th><th align="left">作用</th><th align="left">Hibernate metadata impact</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">@AssertFalse</td><td align="left" valign="top"><code class="classname">Boolean</code>, <code class="classname">boolean</code></td><td align="left" valign="top">Checks that the annotated element is <code class="constant">false</code>.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@AssertTrue</td><td align="left" valign="top"><code class="classname">Boolean</code>, <code class="classname">boolean</code></td><td align="left" valign="top">Checks that the annotated element is <code class="constant">true</code>.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@DecimalMax</td><td align="left" valign="top"><code class="classname">BigDecimal</code>, <code class="classname">BigInteger</code>, <code class="classname">String</code>, <code class="classname">byte</code>, <code class="classname">short</code>, <code class="classname">int</code>, <code class="classname">long</code> and the respective wrappers of the primitive types. Additionally supported by HV: any sub-type of <code class="classname">Number</code> and <code class="classname">CharSequence</code>.</td><td align="left" valign="top">被标注的值必须不大于约束中指定的最大值. 这个约束的参数是一个通过<code class="classname">BigDecimal</code>定义的最大值的字符串表示.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@DecimalMin</td><td align="left" valign="top"><code class="classname">BigDecimal</code>, <code class="classname">BigInteger</code>, <code class="classname">String</code>, <code class="classname">byte</code>, <code class="classname">short</code>, <code class="classname">int</code>, <code class="classname">long</code> and the respective wrappers of the primitive types. Additionally supported by HV: any sub-type of <code class="classname">Number </code>and <code class="classname">CharSequence</code>.</td><td align="left" valign="top">被标注的值必须不小于约束中指定的最小值. 这个约束的参数是一个通过<code class="classname">BigDecimal</code>定义的最小值的字符串表示.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@Digits(integer=, fraction=)</td><td align="left" valign="top"><code class="classname">BigDecimal</code>, <code class="classname">BigInteger</code>, <code class="classname">String</code>, <code class="classname">byte</code>, <code class="classname">short</code>, <code class="classname">int</code>, <code class="classname">long</code> and the respective wrappers of the primitive types. Additionally supported by HV: any sub-type of <code class="classname">Number</code> and <code class="classname">CharSequence</code>.</td><td align="left" valign="top">Checks whether the annoted value is a number having up to <code class="literal">integer</code> digits and <code class="literal">fraction</code> fractional digits.</td><td align="left" valign="top">对应的数据库表字段会被设置精度(precision)和准度(scale).</td></tr><tr><td align="left" valign="top">@Future</td><td align="left" valign="top"><code class="classname">java.util.Date</code>, <code class="classname">java.util.Calendar</code>; Additionally supported by HV, if the <a class="ulink" href="http://joda-time.sourceforge.net/">Joda Time</a> date/time API is on the class path: any implementations of <code class="classname">ReadablePartial</code> and <code class="classname">ReadableInstant</code>.</td><td align="left" valign="top">检查给定的日期是否比现在晚.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@Max</td><td align="left" valign="top"><code class="classname">BigDecimal</code>, <code class="classname">BigInteger</code>, <code class="classname">byte</code>, <code class="classname">short</code>, <code class="classname">int</code>, <code class="classname">long</code> and the respective wrappers of the primitive types. Additionally supported by HV: any sub-type of<code class="classname">CharSequence</code> (the numeric value represented by the character sequence is evaluated), any sub-type of <code class="classname">Number</code>.</td><td align="left" valign="top">检查该值是否小于或等于约束条件中指定的最大值.</td><td align="left" valign="top">会给对应的数据库表字段添加一个check的约束条件.</td></tr><tr><td align="left" valign="top">@Min</td><td align="left" valign="top"><code class="classname">BigDecimal</code>, <code class="classname">BigInteger</code>, <code class="classname">byte</code>, <code class="classname">short</code>, <code class="classname">int</code>, <code class="classname">long</code> and the respective wrappers of the primitive types. Additionally supported by HV: any sub-type of <code class="classname">CharSequence</code> (the numeric value represented by the char sequence is evaluated), any sub-type of <code class="classname">Number</code>.</td><td align="left" valign="top">检查该值是否大于或等于约束条件中规定的最小值.</td><td align="left" valign="top">会给对应的数据库表字段添加一个check的约束条件.</td></tr><tr><td align="left" valign="top">@NotNull</td><td align="left" valign="top">Any type</td><td align="left" valign="top">Checks that the annotated value is not <code class="constant">null.</code></td><td align="left" valign="top">对应的表字段不允许为null.</td></tr><tr><td align="left" valign="top">@Null</td><td align="left" valign="top">Any type</td><td align="left" valign="top">Checks that the annotated value is <code class="constant">null.</code></td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@Past</td><td align="left" valign="top"><code class="classname">java.util.Date</code>, <code class="classname">java.util.Calendar</code>; Additionally supported by HV, if the <a class="ulink" href="http://joda-time.sourceforge.net/">Joda Time</a> date/time API is on the class path: any implementations of <code class="classname">ReadablePartial</code> and <code class="classname">ReadableInstant</code>.</td><td align="left" valign="top">检查标注对象中的值表示的日期比当前早.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@Pattern(regex=, flag=)</td><td align="left" valign="top"><code class="classname">String</code>. Additionally supported by HV: any sub-type of <code class="classname">CharSequence</code>.</td><td align="left" valign="top">检查该字符串是否能够在<em class="parameter"><code>match</code></em>指定的情况下被<em class="parameter"><code>regex</code></em>定义的正则表达式匹配.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@Size(min=, max=)</td><td align="left" valign="top"><code class="classname">String</code>, <code class="classname">Collection</code>, <code class="classname">Map</code> and <code class="classname">arrays</code>. Additionally supported by HV: any sub-type of <code class="classname">CharSequence</code>.</td><td align="left" valign="top">Checks if the annotated element's size is between min and max (inclusive).</td><td align="left" valign="top">对应的数据库表字段的长度会被设置成约束中定义的最大值.</td></tr><tr><td align="left" valign="top">@Valid</td><td align="left" valign="top">Any non-primitive type</td><td align="left" valign="top">递归的对关联对象进行校验, 如果关联对象是个集合或者数组, 那么对其中的元素进行递归校验,如果是一个map,则对其中的值部分进行校验.</td><td align="left" valign="top">没有</td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>On top of the parameters indicated in <a class="xref" href="#table-spec-constraints" title="表 2.2. Bean Validation constraints">表 2.2 “Bean Validation constraints”</a> each constraint supports the parameters <em class="parameter"><code>message</code></em>, <em class="parameter"><code>groups</code></em> and <em class="parameter"><code>payload</code></em>. This is a requirement of the Bean Validation specification.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-defineconstraints-hv-constraints"/>2.4.2. Additional constraints</h3></div></div></div><p>In addition to the constraints defined by the Bean Validation API Hibernate Validator provides several useful custom constraints which are listed in <a class="xref" href="#table-custom-constraints" title="表 2.3. Custom constraints">表 2.3 “Custom constraints”</a>. With one exception also these constraints apply to the field/property level, only @ScriptAssert is a class-level constraint.</p><div class="table"><a id="table-custom-constraints"/><p class="title"><b>表 2.3. Custom constraints</b></p><div class="table-contents"><table summary="Custom constraints" border="1"><colgroup><col align="left"/><col align="left"/><col align="left"/><col align="left"/></colgroup><thead><tr><th align="left">Annotation</th><th align="left">Supported data types</th><th align="left">作用</th><th align="left">Hibernate metadata impact</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">@CreditCardNumber</td><td align="left" valign="top"><code class="classname">CharSequence</code></td><td align="left" valign="top">Checks that the annotated character sequence passes the Luhn checksum test. Note, this validation aims to check for user mistakes, not credit card validity! See also <a class="ulink" href="http://www.merriampark.com/anatomycc.htm">Anatomy of Credit Card Numbers</a>.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@Email</td><td align="left" valign="top"><code class="classname">CharSequence</code></td><td align="left" valign="top">Checks whether the specified character sequence is a valid email address. The optional parameters <em class="parameter"><code>regexp</code></em> and <em class="parameter"><code>flags</code></em> allow to specify an additional regular expression (including regular expression flags) which the email must match.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@Length(min=, max=)</td><td align="left" valign="top"><code class="classname">CharSequence</code></td><td align="left" valign="top">Validates that the annotated character sequence is between <em class="parameter"><code>min</code></em> and <em class="parameter"><code>max</code></em> included.</td><td align="left" valign="top">对应的数据库表字段的长度会被设置成约束中定义的最大值.</td></tr><tr><td align="left" valign="top">@ModCheck(modType=, multiplier=, startIndex=, endIndex=, checkDigitPosition=, ignoreNonDigitCharacters=)</td><td align="left" valign="top"><code class="classname">CharSequence</code></td><td align="left" valign="top">Checks that the digits within the annotated character sequence pass the mod 10 or mod 11 checksum algorithm. <code class="constant">modType</code> is used to select the modulo type and the <code class="constant">multiplier</code> determines the algorithm specific multiplier (see also <a class="ulink" href="http://en.wikipedia.org/wiki/Luhn_algorithm">Luhn algorithm</a>). <code class="constant">startIndex</code> and <code class="constant">endIndex</code> allow to only run the modulo algorithm on the specified sub-string. <code class="constant">checkDigitPosition</code> allows to use an arbitrary digit within the character sequence to be the check digit. If not specified it is assumed that the check digit is part of the specified range. Last but not least, <code class="constant">ignoreNonDigitCharacters</code> allows to ignore non digit characters.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@NotBlank</td><td align="left" valign="top"><code class="classname">CharSequence</code></td><td align="left" valign="top">Checks that the annotated character sequence is not null and the trimmed length is greater than 0. The difference to @NotEmpty is that this constraint can only be applied on strings and that trailing whitespaces are ignored.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@NotEmpty</td><td align="left" valign="top"><code class="classname">CharSequence</code>, <code class="classname">Collection</code>, <code class="classname">Map</code> and arrays</td><td align="left" valign="top">Checks whether the annotated element is not <code class="constant">null</code> nor empty.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@Range(min=, max=)</td><td align="left" valign="top"><code class="classname">BigDecimal</code>, <code class="classname">BigInteger</code>, <code class="classname">CharSequence</code>, <code class="classname">byte</code>, <code class="classname">short</code>, <code class="classname">int</code>, <code class="classname">long</code> and the respective wrappers of the primitive types</td><td align="left" valign="top">Checks whether the annotated value lies between (inclusive) the specified minimum and maximum.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@SafeHtml(whitelistType=, additionalTags=)</td><td align="left" valign="top"><code class="classname">CharSequence</code></td><td align="left" valign="top">Checks whether the annotated value contains potentially malicious fragments such as <code class="code">&lt;script/&gt;</code>. In order to use this constraint, the <a class="ulink" href="http://jsoup.org/">jsoup</a> library must be part of the class path. With the <em class="parameter"><code>whitelistType</code></em> attribute predefined whitelist types can be chosen. You can also specify additional html tags for the whitelist with the <em class="parameter"><code>additionalTags</code></em> attribute.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@ScriptAssert(lang=, script=, alias=)</td><td align="left" valign="top">Any type</td><td align="left" valign="top">Checks whether the given script can successfully be evaluated against the annotated element. In order to use this constraint, an implementation of the Java Scripting API as defined by JSR 223 ("Scripting for the Java<sup>TM</sup> Platform") must part of the class path. The expressions to be evaluated can be written in any scripting or expression language, for which a JSR 223 compatible engine can be found in the class path.</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@URL(protocol=, host=, port=, regexp=, flags=)</td><td align="left" valign="top"><code class="classname">CharSequence</code></td><td align="left" valign="top">Checks if the annotated character sequence is a valid URL according to RFC2396. If any of the optional parameters <em class="parameter"><code>protocol</code></em>, <em class="parameter"><code>host</code></em> or <em class="parameter"><code>port</code></em> are specified, the corresponding URL fragments must match the specified values. The optional parameters <em class="parameter"><code>regexp</code></em> and <em class="parameter"><code>flags</code></em> allow to specify an additional regular expression (including regular expression flags) which the URL must match.</td><td align="left" valign="top">没有</td></tr></tbody></table></div></div><br class="table-break"/><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1727"/>2.4.2.1. Country specific constraints</h4></div></div></div><p>Hibernate Validator offers also some country specific constraints, e.g. for the validation of social security numbers. </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>If you have to implement a country specific constraint, consider making it a contribution to Hibernate Validator!</p></div><div class="table"><a id="table-custom-country-constraints"/><p class="title"><b>表 2.4. Custom country specific constraints</b></p><div class="table-contents"><table summary="Custom country specific constraints" border="1"><colgroup><col align="left"/><col align="left"/><col align="left"/><col align="left"/><col align="left"/></colgroup><thead><tr><th align="left">Annotation</th><th align="left">Supported data types</th><th align="left">作用</th><th align="left">Country</th><th align="left">Hibernate metadata impact</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">@CNPJ</td><td align="left" valign="top"><code class="classname">CharSequence</code></td><td align="left" valign="top">Checks that the annotated character sequence represents a Brazilian corporate tax payer registry number (Cadastro de Pessoa Juríeddica)</td><td align="left" valign="top">Brazil</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@CPF</td><td align="left" valign="top"><code class="classname">CharSequence</code></td><td align="left" valign="top">Checks that the annotated character sequence represents a Brazilian individual taxpayer registry number (Cadastro de Pessoa Fídsica).</td><td align="left" valign="top">Brazil</td><td align="left" valign="top">没有</td></tr><tr><td align="left" valign="top">@TituloEleitoral</td><td align="left" valign="top"><code class="classname">CharSequence</code></td><td align="left" valign="top">Checks that the annotated character sequence represents a Brazilian voter ID card number (<a class="ulink" href="http://ghiorzi.org/cgcancpf.htm">Título Eleitoral</a>).</td><td align="left" valign="top">Brazil</td><td align="left" valign="top">没有</td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>In some cases neither the Bean Validation constraints nor the custom constraints provided by Hibernate Validator will fulfill your requirements. In this case you can easily write your own constraint. We will discuss this in <a class="xref" href="#validator-customconstraints" title="第 3 章 创建自己的约束规则">第 3 章 <i>创建自己的约束规则</i></a>.</p></div></div></div></div></div><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-customconstraints"/>第 3 章 创建自己的约束规则</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#validator-customconstraints-simple">3.1. 创建一个简单的约束条件</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-customconstraints-constraintannotation">3.1.1. 约束标注</a></span></dt><dt><span class="section"><a href="#validator-customconstraints-validator">3.1.2. 约束校验器</a></span></dt><dt><span class="section"><a href="#validator-customconstraints-errormessage">3.1.3. 校验错误信息</a></span></dt><dt><span class="section"><a href="#validator-customconstraints-using">3.1.4. 应用约束条件</a></span></dt></dl></dd><dt><span class="section"><a href="#validator-customconstraints-compound">3.2. 约束条件组合</a></span></dt></dl></div><p>尽管Bean Validation API定义了一大堆标准的约束条件, 但是肯定还是有这些约束不能满足我们需求的时候, 在这种情况下, 你可以根据你的特定的校验需求来创建自己的约束条件.</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-customconstraints-simple"/>3.1. 创建一个简单的约束条件</h2></div></div></div><p>按照以下三个步骤来创建一个自定义的约束条件</p><div class="itemizedlist"><ul><li><p>创建约束标注</p></li><li><p>实现一个验证器</p></li><li><p>定义默认的验证错误信息</p></li></ul></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-customconstraints-constraintannotation"/>3.1.1. 约束标注</h3></div></div></div><p>让我们来创建一个新的用来判断一个给定字符串是否全是大写或者小写字符的约束标注. 我们将稍后把它用在<a class="xref" href="#validator-gettingstarted" title="第 1 章 开始入门">第 1 章 <i>开始入门</i></a>中的类<code class="classname">Car</code>的<span class="property">licensePlate</span>字段上来确保这个字段的内容一直都是大写字母.</p><p>首先,我们需要一种方法来表示这两种模式( 译注: 大写或小写), 我们可以使用<code class="classname">String</code>常量, 但是在Java 5中, 枚举类型是个更好的选择:</p><div class="example"><a id="d0e1840"/><p class="title"><b>例 3.1. 枚举类型<code class="classname">CaseMode</code>, 来表示大写或小写模式.</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;enum&nbsp;</span><span class="java_type">CaseMode</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;UPPER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;LOWER</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>现在我们可以来定义真正的约束标注了. 如果你以前没有创建过标注(annotation)的话,那么这个可能看起来有点吓人, 可是其实没有那么难的 :)</p><div class="example"><a id="example-defining-custom-constraint"/><p class="title"><b>例 3.2. 定义一个CheckCase的约束标注</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_operator">*</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">RetentionPolicy</span><span class="java_separator">.</span><span class="java_operator">*</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Documented</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Retention</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Target</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Constraint</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Payload</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ANNOTATION_TYPE&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Constraint</span><span class="java_separator">(</span><span class="java_plain">validatedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">CheckCaseValidator</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Documented</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">CheckCase</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;message</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{com.mycompany.constraints.checkcase}&quot;</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;groups</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Payload</span><span class="java_operator">&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;payload</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{};</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CaseMode</span><span class="java_plain">&nbsp;value</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>一个标注(annotation) 是通过<code class="code">@interface</code>关键字来定义的. 这个标注中的属性是声明成类似方法的样式的. 根据Bean Validation API 规范的要求</p><div class="itemizedlist"><ul><li><p><span class="property">message</span>属性, 这个属性被用来定义默认得消息模版, 当这个约束条件被验证失败的时候,通过此属性来输出错误信息.</p></li><li><p><span class="property">groups</span> 属性, 用于指定这个约束条件属于哪(些)个校验组(请参考<a class="xref" href="#validator-usingvalidator-validationgroups" title="2.3. 校验组">第 2.3 节 “校验组”</a>). 这个的默认值必须是<code class="classname">Class&lt;?&gt;</code>类型到空到数组.</p></li><li><p><code class="classname">payload</code> 属性, Bean Validation API 的使用者可以通过此属性来给约束条件指定严重级别. 这个属性并不被API自身所使用. </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>通过payload属性来指定默认错误严重级别的示例</p><pre class="programlisting">public class Severity {
    public static class Info extends Payload {};
    public static class Error extends Payload {};
}

public class ContactDetails {
    @NotNull(message="Name is mandatory", payload=Severity.Error.class)
    private String name;

    @NotNull(message="Phone number not specified, but not mandatory", payload=Severity.Info.class)
    private String phoneNumber;

    // ...
}</pre><p>这样, 在校验完一个<code class="classname">ContactDetails</code> 的示例之后, 你就可以通过调用<code class="methodname">ConstraintViolation.getConstraintDescriptor().getPayload()</code>来得到之前指定到错误级别了,并且可以根据这个信息来决定接下来到行为.</p></div></li></ul></div><p>除了这三个强制性要求的属性(<span class="property">message</span>, <span class="property">groups</span> 和 <span class="property">payload</span>) 之外, 我们还添加了一个属性用来指定所要求到字符串模式. 此属性的名称<span class="property">value</span>在annotation的定义中比较特殊, 如果只有这个属性被赋值了的话, 那么, 在使用此annotation到时候可以忽略此属性名称, 即<code class="code">@CheckCase(CaseMode.UPPER)</code>.</p><p>另外, 我们还给这个annotation标注了一些(所谓的) 元标注( 译注: 或"元模型信息"?, "meta annotatioins"): </p><div class="itemizedlist"><ul><li><p><code class="code">@Target({ METHOD, FIELD, ANNOTATION_TYPE })</code>: 表示@CheckCase 可以被用在方法, 字段或者annotation声明上.</p></li><li><p><code class="code">@Retention(RUNTIME)</code>: 表示这个标注信息是在运行期通过反射被读取的.</p></li><li><p><code class="code">@Constraint(validatedBy = CheckCaseValidator.class)</code>: 指明使用那个校验器(类) 去校验使用了此标注的元素.</p></li><li><p><code class="code">@Documented</code>: 表示在对使用了<code class="code">@CheckCase</code>的类进行javadoc操作到时候, 这个标注会被添加到javadoc当中.</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>Hibernate Validator provides support for the validation of method parameters using constraint annotations (see <a class="xref" href="#validator-customoptions-methodvalidation" title="8.3. Method validation">第 8.3 节 “Method validation”</a>).</p><p>In order to use a custom constraint for parameter validation the <code class="classname">ElementType.PARAMETER</code> must be specified within the <code class="classname">@Target</code> annotation. This is already the case for all constraints defined by the Bean Validation API and also the custom constraints provided by Hibernate Validator.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-customconstraints-validator"/>3.1.2. 约束校验器</h3></div></div></div><p>Next, we need to implement a constraint validator, that's able to validate elements with a <code class="classname">@CheckCase</code> annotation. To do so, we implement the interface <code class="classname">ConstraintValidator</code> as shown below:</p><div class="example"><a id="example-constraint-validator"/><p class="title"><b>例 3.3. 约束条件<code class="classname">CheckCase</code>的验证器</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ConstraintValidator</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ConstraintValidatorContext</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CheckCaseValidator</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">ConstraintValidator</span><span class="java_operator">&lt;</span><span class="java_type">CheckCase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">CaseMode</span><span class="java_plain">&nbsp;caseMode</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;initialize</span><span class="java_separator">(</span><span class="java_type">CheckCase</span><span class="java_plain">&nbsp;constraintAnnotation</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">caseMode&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;constraintAnnotation</span><span class="java_separator">.</span><span class="java_plain">value</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isValid</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;object</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ConstraintValidatorContext</span><span class="java_plain">&nbsp;constraintContext</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">object&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">caseMode&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_type">CaseMode</span><span class="java_separator">.</span><span class="java_plain">UPPER</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;object</span><span class="java_separator">.</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">object</span><span class="java_separator">.</span><span class="java_plain">toUpperCase</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;object</span><span class="java_separator">.</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">object</span><span class="java_separator">.</span><span class="java_plain">toLowerCase</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p><code class="classname">ConstraintValidator</code>定义了两个泛型参数, 第一个是这个校验器所服务到标注类型(在我们的例子中即<code class="classname">CheckCase</code>), 第二个这个校验器所支持到被校验元素到类型 (即<code class="classname">String</code>).</p><p>如果一个约束标注支持多种类型到被校验元素的话, 那么需要为每个所支持的类型定义一个<code class="classname">ConstraintValidator</code>,并且注册到约束标注中.</p><p>这个验证器的实现就很平常了, <code class="methodname">initialize()</code> 方法传进来一个所要验证的标注类型的实例, 在本例中, 我们通过此实例来获取其value属性的值,并将其保存为<code class="classname">CaseMode</code>类型的成员变量供下一步使用.</p><p><code class="methodname">isValid()</code>是实现真正的校验逻辑的地方, 判断一个给定的<code class="classname">String</code>对于<code class="classname">@CheckCase</code>这个约束条件来说是否是合法的, 同时这还要取决于在<code class="classname">initialize()</code>中获得的大小写模式. 根据Bean Validation中所推荐的做法, 我们认为<code class="code">null</code>是合法的值. 如果<code class="code">null</code>对于这个元素来说是不合法的话,那么它应该使用<code class="code">@NotNull</code>来标注.</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2014"/>3.1.2.1. ConstraintValidatorContext</h4></div></div></div><p><a class="xref" href="#example-constraint-validator" title="例 3.3. 约束条件CheckCase的验证器">例 3.3 “约束条件CheckCase的验证器”</a> 中的<code class="methodname">isValid</code>使用了约束条件中定义的错误消息模板, 然后返回一个<code class="constant">true</code> 或者 <code class="constant">false</code>. 通过使用传入的<code class="classname">ConstraintValidatorContext</code>对象, 我们还可以给约束条件中定义的错误信息模板来添加额外的信息或者完全创建一个新的错误信息模板. </p><div class="example"><a id="example-constraint-validator-context"/><p class="title"><b>例 3.4. 使用ConstraintValidatorContext来自定义错误信息</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ConstraintValidator</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ConstraintValidatorContext</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CheckCaseValidator</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">ConstraintValidator</span><span class="java_operator">&lt;</span><span class="java_type">CheckCase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">CaseMode</span><span class="java_plain">&nbsp;caseMode</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;initialize</span><span class="java_separator">(</span><span class="java_type">CheckCase</span><span class="java_plain">&nbsp;constraintAnnotation</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">caseMode&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;constraintAnnotation</span><span class="java_separator">.</span><span class="java_plain">value</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isValid</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;object</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ConstraintValidatorContext</span><span class="java_plain">&nbsp;constraintContext</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">object&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isValid</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">caseMode&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_type">CaseMode</span><span class="java_separator">.</span><span class="java_plain">UPPER</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isValid&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;object</span><span class="java_separator">.</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">object</span><span class="java_separator">.</span><span class="java_plain">toUpperCase</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isValid&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;object</span><span class="java_separator">.</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">object</span><span class="java_separator">.</span><span class="java_plain">toLowerCase</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_separator">(</span><span class="java_operator">!</span><span class="java_plain">isValid</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintContext</span><span class="java_separator">.</span><span class="java_plain">disableDefaultConstraintViolation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintContext</span><span class="java_separator">.</span><span class="java_plain">buildConstraintViolationWithTemplate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{com.mycompany.constraints.CheckCase.message}&quot;</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">).</span><span class="java_plain">addConstraintViolation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;result</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p><a class="xref" href="#example-constraint-validator-context" title="例 3.4. 使用ConstraintValidatorContext来自定义错误信息">例 3.4 “使用ConstraintValidatorContext来自定义错误信息”</a> 演示了如果创建一个新的错误信息模板来替换掉约束条件中定义的默认的. 在本例中, 实际上通过调用<code class="classname">ConstraintValidatorContext</code>达到了一个使用默认消息模板的效果. </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>在创建新的constraint violation的时候一定要记得调用<code class="methodname">addConstraintViolation</code>, 只有这样, 这个新的constraint violation才会被真正的创建.</p></div><p>In case you are implementing a <code class="classname">ConstraintValidator</code> a class level constraint it is also possible to adjust set the property path for the created constraint violations. This is important for the case where you validate multiple properties of the class or even traverse the object graph. A custom property path creation could look like <a class="xref" href="#example-custom-error" title="例 3.5. Adding new ConstraintViolation with custom property path">例 3.5 “Adding new ConstraintViolation with custom property path”</a>.</p><div class="example"><a id="example-custom-error"/><p class="title"><b>例 3.5. Adding new <code class="classname">ConstraintViolation</code> with custom property path</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">boolean</span><!-- <br/> --><span class="java_plain">&nbsp;isValid</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">Group</span><!-- <br/> --><span class="java_plain">&nbsp;group</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ConstraintValidatorContext</span><!-- <br/> --><span class="java_plain">&nbsp;constraintValidatorContext</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isValid&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_separator">(</span><span class="java_operator">!</span><span class="java_plain">isValid</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintValidatorContext</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildConstraintViolationWithTemplate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{my.custom.template}&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addNode</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;myProperty&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">addConstraintViolation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;isValid</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</pre></div></div><br class="example-break"/></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-customconstraints-errormessage"/>3.1.3. 校验错误信息</h3></div></div></div><p>最后, 我们还需要指定如果<code class="classname">@CheckCase</code>这个约束条件验证的时候,没有通过的话的校验错误信息. 我们可以添加下面的内容到我们项目自定义的<code class="filename">ValidationMessages.properties</code> (参考 <a class="xref" href="#section-message-interpolation" title="2.2.4. 验证失败提示信息解析">第 2.2.4 节 “验证失败提示信息解析”</a>)文件中.</p><div class="example"><a id="d0e2077"/><p class="title"><b>例 3.6. 为<code class="classname">CheckCase</code>约束定义一个错误信息</b></p><div class="example-contents"><pre class="programlisting">com.mycompany.constraints.CheckCase.message=Case mode must be {value}.</pre></div></div><br class="example-break"/><p>如果发现校验错误了的话, 你所使用的Bean Validation的实现会用我们定义在<code class="classname">@CheckCase</code>中message属性上的值作为键到这个文件中去查找对应的错误信息.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-customconstraints-using"/>3.1.4. 应用约束条件</h3></div></div></div><p>现在我们已经有了一个自定义的约束条件了, 我们可以把它用在<a class="xref" href="#validator-gettingstarted" title="第 1 章 开始入门">第 1 章 <i>开始入门</i></a>中的<code class="classname">Car</code>类上, 来校验此类的<span class="property">licensePlate</span>属性的值是否全都是大写字母.</p><div class="example"><a id="example-car-with-checkcase"/><p class="title"><b>例 3.7. 应用<code class="classname">CheckCase</code>约束条件</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">Min</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">NotNull</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">Size</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Size</span><span class="java_separator">(</span><span class="java_plain">min&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">,</span><span class="java_plain">&nbsp;max&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">14</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">CheckCase</span><span class="java_separator">(</span><span class="java_type">CaseMode</span><span class="java_separator">.</span><span class="java_plain">UPPER</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licensePlate</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Min</span><span class="java_separator">(</span><span class="java_literal">2</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">manufacturer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">licensePlate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">seatCount&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getters&nbsp;and&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>最后,让我们用一个简单的测试来检测<code class="classname">@CheckCase</code>约束已经被正确的校验了:</p><div class="example"><a id="d0e2116"/><p class="title"><b>例 3.8. 演示<code class="classname">CheckCase</code>的验证过程</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">junit</span><span class="java_separator">.</span><span class="java_type">Assert</span><span class="java_separator">.</span><span class="java_operator">*</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">util</span><span class="java_separator">.</span><span class="java_type">Set</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ConstraintViolation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Validation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Validator</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ValidatorFactory</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">junit</span><span class="java_separator">.</span><span class="java_type">BeforeClass</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">junit</span><span class="java_separator">.</span><span class="java_type">Test</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CarTest</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">BeforeClass</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setUp</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ValidatorFactory</span><span class="java_plain">&nbsp;factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Validation</span><span class="java_separator">.</span><span class="java_plain">buildDefaultValidatorFactory</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getValidator</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Test</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;testLicensePlateNotUpperCase</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_literal">&quot;Morris&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;dd-ab-123&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">4</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ConstraintViolation</span><span class="java_operator">&lt;</span><span class="java_type">Car</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">car</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_literal">1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;Case&nbsp;mode&nbsp;must&nbsp;be&nbsp;UPPER.&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">iterator</span><span class="java_separator">().</span><span class="java_plain">next</span><span class="java_separator">().</span><span class="java_plain">getMessage</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Test</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;carIsValid</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_literal">&quot;Morris&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;DD-AB-123&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">4</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ConstraintViolation</span><span class="java_operator">&lt;</span><span class="java_type">Car</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">car</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-customconstraints-compound"/>3.2. 约束条件组合</h2></div></div></div><p>在<a class="xref" href="#example-car-with-checkcase" title="例 3.7. 应用CheckCase约束条件">例 3.7 “应用CheckCase约束条件”</a>中我们可以看到, 类<code class="classname">Car</code>的<span class="property">licensePlate</span>属性上定义了三个约束条件. 在某些复杂的场景中, 可能还会有更多的约束条件被定义到同一个元素上面, 这可能会让代码看起来有些复杂, 另外, 如果在另外的类里面还有一个<span class="property">licensePlate</span>属性, 我们可能还要把这些约束条件再拷贝到这个属性上, 但是这样做又违反了 DRY 原则.</p><p>这个问题可以通过使用组合约束条件来解决. 接下来让我们来创建一个新的约束标注<code class="classname">@ValidLicensePlate</code>, 它组合了<code class="classname">@NotNull</code>, <code class="classname">@Size</code> 和 <code class="classname">@CheckCase</code>:</p><div class="example"><a id="d0e2154"/><p class="title"><b>例 3.9. 创建一个约束条件组合<code class="classname">ValidLicensePlate</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_operator">*</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">RetentionPolicy</span><span class="java_separator">.</span><span class="java_operator">*</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Documented</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Retention</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Target</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Constraint</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Payload</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">NotNull</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">Size</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Size</span><span class="java_separator">(</span><span class="java_plain">min&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">,</span><span class="java_plain">&nbsp;max&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">14</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">CheckCase</span><span class="java_separator">(</span><span class="java_type">CaseMode</span><span class="java_separator">.</span><span class="java_plain">UPPER</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ANNOTATION_TYPE&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Constraint</span><span class="java_separator">(</span><span class="java_plain">validatedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Documented</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">ValidLicensePlate</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;message</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{com.mycompany.constraints.validlicenseplate}&quot;</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;groups</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Payload</span><span class="java_operator">&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;payload</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{};</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>我们只需要把要组合的约束标注在这个新的类型上加以声明 (注: 这正是我们为什么把annotation types作为了<code class="classname">@CheckCase</code>的一个target). 因为这个组合不需要额外的校验器, 所以不需要声明validator属性.</p><p>现在, 在<span class="property">licensePlate</span>属性上使用这个新定义的"约束条件" (其实是个组合) 和之前在其上声明那三个约束条件是一样的效果了.</p><div class="example"><a id="d0e2171"/><p class="title"><b>例 3.10. 使用<code class="classname">ValidLicensePlate</code>组合约束</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ValidLicensePlate</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licensePlate</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>The set of <code class="classname">ConstraintViolations</code> retrieved when validating a <code class="classname">Car</code> instance will contain an entry for each violated composing constraint of the <code class="classname">@ValidLicensePlate</code> constraint. If you rather prefer a single <code class="classname">ConstraintViolation</code> in case any of the composing constraints is violated, the <code class="classname">@ReportAsSingleViolation</code> meta constraint can be used as follows:</p><div class="example"><a id="d0e2196"/><p class="title"><b>例 3.11. <code class="classname">@ReportAsSingleViolation</code>的用法</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">ReportAsSingleViolation</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">ValidLicensePlate</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;message</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{com.mycompany.constraints.validlicenseplate}&quot;</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;groups</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Payload</span><span class="java_operator">&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;payload</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{};</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div></div><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-xmlconfiguration"/>第 4 章 XML configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e2207">4.1. validation.xml</a></span></dt><dt><span class="section"><a href="#d0e2294">4.2. 映射约束</a></span></dt></dl></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2207"/>4.1. <code class="filename">validation.xml</code></h2></div></div></div><p>The key to enable XML configuration for Hibernate Validator is the file <code class="filename">META-INF/validation.xml</code>. If this file exists on the classpath its configuration will be applied when the <code class="classname">ValidationFactory</code> gets created. <a class="xref" href="#image-validation-configuration" title="例 4.1. validation-configuration-1.0.xsd">例 4.1 “validation-configuration-1.0.xsd”</a> shows a model view of the XML schema to which <code class="filename">validation.xml</code> has to adhere.</p><div class="example"><a id="image-validation-configuration"/><p class="title"><b>例 4.1. validation-configuration-1.0.xsd</b></p><div class="example-contents"><div class="mediaobject"><img src="validation-configuration-1.0.png"/></div></div></div><p><br class="example-break"/></p><p><a class="xref" href="#example-validation-xml" title="例 4.2. validation.xml">例 4.2 “validation.xml”</a> 列出了<code class="filename">validation.xml</code>中的一些常用的配置项.</p><div class="example"><a id="example-validation-xml"/><p class="title"><b>例 4.2. validation.xml</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">validation-config</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/xml/ns/javax/validation/configuration&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/xml/ns/javax/validation/configuration&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">default-provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.validator.HibernateValidator</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">default-provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">message-interpolator</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.validator.messageinterpolation.ResourceBundleMessageInterpolator</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">message-interpolator</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">traversable-resolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.validator.engine.resolver.DefaultTraversableResolver</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">traversable-resolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">constraint-validator-factory</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.validator.engine.ConstraintValidatorFactoryImpl</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">constraint-validator-factory</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">constraint-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">META-INF/validation/constraints-car.xml</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">constraint-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;prop1&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">value1</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;prop2&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">value2</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">validation-config</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>警告</h2><p>There must only be one file named <code class="filename">META-INF/validation.xml</code> on the classpath. If more than one is found an exception is thrown.</p></div><p>The node <span class="property">default-provider</span> allows to choose the Bean Validation provider. This is useful if there is more than one provider on the classpath. <span class="property">message-interpolator</span>, <span class="property">traversable-resolver</span> and <span class="property">constraint-validator-factory</span> allow to customize the used implementations for <code class="classname">javax.validation.MessageInterpolator</code>, <code class="classname">javax.validation.TraversableResolver</code> resp. <code class="classname">javax.validation.ConstraintValidatorFactory</code>.</p><p>All these settings are optional. <a class="xref" href="#example-validation-xml" title="例 4.2. validation.xml">例 4.2 “validation.xml”</a> shows the defaults used within Hibernate Validator. The same configuration options are also available programmatically through <code class="classname">javax.validation.Configuration</code>. In fact XML configuration will be overridden by values explicitly specified via the API. It is even possible to ignore the XML configuration completely via <code class="methodname">Configuration.ignoreXmlConfiguration()</code>. See also <a class="xref" href="#validator-bootstrapping" title="第 5 章 Bootstrapping">第 5 章 <i>Bootstrapping</i></a>.</p><p>Via the <span class="property">constraint-mapping</span> element you can list an arbitrary number of additional XML files containing the actual constraint configuration. Mapping file names must be specified using their fully-qualified name on the classpath. Details on writing mapping files can be found in the next section.</p><p>Last but not least, you can specify provider specific properties via the <span class="property">property</span> nodes.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2294"/>4.2. 映射约束</h2></div></div></div><p>Expressing constraints in XML is possible via files adhering to the schema seen in <a class="xref" href="#image-mapping-configuration" title="例 4.3. validation-mapping-1.0.xsd">例 4.3 “validation-mapping-1.0.xsd”</a>. Note that these mapping files are only processed if listed via <span class="property">constraint-mapping</span> in your <code class="filename">validation.xml</code>.</p><div class="example"><a id="image-mapping-configuration"/><p class="title"><b>例 4.3. validation-mapping-1.0.xsd</b></p><div class="example-contents"><div class="mediaobject"><img src="validation-mapping-1.0.png"/></div></div></div><br class="example-break"/><p><a class="xref" href="#example-constraints-car" title="例 4.4. constraints-car.xml">例 4.4 “constraints-car.xml”</a> shows how our classes <code class="classname">Car</code> and <code class="classname">RentalCar</code> from <a class="xref" href="#example-car" title="例 2.15. Car">例 2.15 “Car”</a> resp. <a class="xref" href="#example-rental-car" title="例 2.19. RentalCar with @GroupSequence">例 2.19 “RentalCar with @GroupSequence”</a> could be mapped in XML.</p><div class="example"><a id="example-constraints-car"/><p class="title"><b>例 4.4. constraints-car.xml</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">constraint-mappings</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/xml/ns/javax/validation/mapping&nbsp;validation-mapping-1.0.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://jboss.org/xml/ns/javax/validation/mapping&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">default-package</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.validator.quickstart</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">default-package</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">bean</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Car&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ignore-annotations</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;manufacturer&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">annotation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.validation.constraints.NotNull&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;licensePlate&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">annotation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.validation.constraints.NotNull&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;seatCount&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">annotation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.validation.constraints.Min&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">element</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;value&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">2</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">element</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;driver&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">valid</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">getter</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;passedVehicleInspection&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ignore-annotations</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">annotation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.validation.constraints.AssertTrue&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">The&nbsp;car&nbsp;has&nbsp;to&nbsp;pass&nbsp;the&nbsp;vehicle&nbsp;inspection&nbsp;first</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">message</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groups</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">CarChecks</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groups</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">element</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;max&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">10</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">element</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">getter</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">bean</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">bean</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;RentalCar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ignore-annotations</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ignore-annotations</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">group-sequence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">RentalCar</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">CarChecks</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">group-sequence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">bean</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">constraint-definition</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">annotation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mycompany.CheckCase&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">validated-by</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">include-existing-validators</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.mycompany.CheckCaseValidator</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">validated-by</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">constraint-definition</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">constraint-mappings</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>The XML configuration is closely mirroring the programmatic API. For this reason it should suffice to just add some comments. <span class="property">default-package</span> is used for all fields where a class name is expected. If the specified class is not fully qualified the configured default package will be used. Every mapping file can then have several <span class="property">bean</span> nodes, each describing the constraints on the entity with the specified class name.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>警告</h2><p>A given entity can only be configured once across all configuration files. If the same class is configured more than once an exception is thrown.</p></div><p>Setting <span class="property">ignore-annotations</span> to <code class="constant">true</code> means that constraint annotations placed on the configured bean are ignored. The default for this value is <code class="constant">true</code>. ignore-annotations is also available for the nodes <span class="property">class</span>, <span class="property">fields</span> and <span class="property">getter</span>. If not explicitly specified on these levels the configured <span class="property">bean</span> value applies. Otherwise do the nodes <span class="property">class</span>, <span class="property">fields</span> and <span class="property">getter</span> determine on which level the constraints are placed (see <a class="xref" href="#validator-usingvalidator-annotate" title="2.1. 定义约束">第 2.1 节 “定义约束”</a>). The <span class="property">constraint</span> node is then used to add a constraint on the corresponding level. Each constraint definition must define the class via the <span class="property">annotation</span> attribute. The constraint attributes required by the Bean Validation specification (<span class="property">message</span>, <span class="property">groups</span> and <span class="property">payload</span>) have dedicated nodes. All other constraint specific attributes are configured using the <span class="property">element</span> node.</p><p><span class="property">class</span>节点同样支持通过<span class="property">group-sequence</span>节点来对一个类的默认校验组进行重定义(请参考 <a class="xref" href="#section-default-group-class" title="2.3.2. 对一个类重定义其默认校验组">第 2.3.2 节 “对一个类重定义其默认校验组”</a>) .</p><p>Last but not least, the list of <code class="classname">ConstraintValidator</code>s associated to a given constraint can be altered via the <span class="property">constraint-definition</span> node. The <span class="property">annotation</span> attribute represents the constraint annotation being altered. The <span class="property">validated-by</span> elements represent the (ordered) list of <code class="classname">ConstraintValidator</code> implementations associated to the constraint. If <span class="property">include-existing-validator</span> is set to <code class="constant">false</code>, validators defined on the constraint annotation are ignored. If set to <code class="constant">true</code>, the list of constraint validators described in XML is concatenated to the list of validators specified on the annotation.</p></div></div><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-bootstrapping"/>第 5 章 Bootstrapping</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#section-validator-instance">5.1. Configuration 和 ValidatorFactory</a></span></dt><dt><span class="section"><a href="#section-validation-provider-resolver">5.2. ValidationProviderResolver</a></span></dt><dt><span class="section"><a href="#section-message-interpolator">5.3. MessageInterpolator</a></span></dt><dd><dl><dt><span class="section"><a href="#section-resource-bundle-locator">5.3.1. ResourceBundleLocator</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2650">5.4. TraversableResolver</a></span></dt><dt><span class="section"><a href="#d0e2696">5.5. ConstraintValidatorFactory</a></span></dt></dl></div><p>在<a class="xref" href="#section-validator-instance" title="5.1. Configuration 和 ValidatorFactory">第 5.1 节 “Configuration 和 ValidatorFactory”</a>中我们说道过, 最简单的创建一个<code class="classname">Validator</code>实例的方法是通过<code class="methodname">Validation.buildDefaultValidatorFactory</code>. 在本章中我们会继续介绍<code class="classname">javax.validation.Validation</code>中的其他方法, 以及如何通过这些方法在Bean Validation初始化的时候对其进行配置的.</p><p>The different bootstrapping options allow, amongst other things, to bootstrap any Bean Validation implementation on the classpath. Generally, an available provider is discovered by the <a class="ulink" href="http://docs.oracle.com/javase/6/docs/technotes/guides/jar/jar.html#Service%20Provider">Java Service Provider</a> mechanism. A Bean Validation implementation includes the file <code class="filename">javax.validation.spi.ValidationProvider</code> in <code class="filename">META-INF/services</code>. This file contains the fully qualified classname of the <code class="classname">ValidationProvider</code> of the implementation. In the case of Hibernate Validator this is <code class="classname">org.hibernate.validator.HibernateValidator</code>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>如果当前类路径下存在多个Bean Validation的实现, 那么<code class="methodname">Validation.buildDefaultValidatorFactory()</code>并不能保证具体那个实现会被使用. 如果想指定某一个的话, 请使用<code class="methodname">Validation.byProvider()</code>.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="section-validator-instance"/>5.1. <code class="classname">Configuration</code> 和 <code class="classname">ValidatorFactory</code></h2></div></div></div><p>Validation类提供了三种方法来创建一个Validator的实例, <a class="xref" href="#example-build-default-validator-factory" title="例 5.1. Validation.buildDefaultValidatorFactory()">例 5.1 “Validation.buildDefaultValidatorFactory()”</a>中显示的是最简单的方法.</p><div class="example"><a id="example-build-default-validator-factory"/><p class="title"><b>例 5.1. Validation.buildDefaultValidatorFactory()</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">ValidatorFactory</span><!-- <br/> --><span class="java_plain">&nbsp;factory&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Validation</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">buildDefaultValidatorFactory</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getValidator</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>你也可以通过<code class="methodname">Validation.byDefaultProvider()</code>现获取一个Configuration对象, 这样可以对要创建的Validator进行配置.</p><div class="example"><a id="d0e2494"/><p class="title"><b>例 5.2. Validation.byDefaultProvider()</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_operator">&lt;?&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;config&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Validation</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">byDefaultProvider</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">configure</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">config</span><span class="java_separator">.</span><span class="java_plain">messageInterpolator</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">MyMessageInterpolator</span><span class="java_separator">())</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">traversableResolver</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">MyTraversableResolver</span><span class="java_separator">())</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">constraintValidatorFactory</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">MyConstraintValidatorFactory</span><span class="java_separator">());</span>
</span>
<!--  --><br/><span class="java_type">ValidatorFactory</span><span class="java_plain">&nbsp;factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;config</span><span class="java_separator">.</span><span class="java_plain">buildValidatorFactory</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getValidator</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p><code class="classname">MessageInterpolator</code>, <code class="classname">TraversableResolver</code> 和 <code class="classname">ConstraintValidatorFactory</code>会在后面详细介绍.</p><p>最后, 你可以指定使用哪个Bean Validation的实现. 如果类路径下存在多个Bean Validation的实现的话,这样就很有必要了. 例如, 如果你想使用Hibernate Validator来作为内部实现来创建<code class="classname">Validator</code>的话:</p><div class="example"><a id="d0e2514"/><p class="title"><b>例 5.3. Validation.byProvider( HibernateValidator.class )</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">HibernateValidatorConfiguration</span><!-- <br/> --><span class="java_plain">&nbsp;config&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Validation</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">byProvider</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">HibernateValidator</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">).</span><!-- <br/> --><span class="java_plain">configure</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">config</span><span class="java_separator">.</span><span class="java_plain">messageInterpolator</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">MyMessageInterpolator</span><span class="java_separator">())</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">traversableResolver</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">MyTraversableResolver</span><span class="java_separator">())</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">constraintValidatorFactory</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">MyConstraintValidatorFactory</span><span class="java_separator">());</span>
</span>
<!--  --><br/><span class="java_type">ValidatorFactory</span><span class="java_plain">&nbsp;factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;config</span><span class="java_separator">.</span><span class="java_plain">buildValidatorFactory</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getValidator</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>创建出来的<code class="classname">Validator</code>实例是线程安全的, 所以你可以把它缓存起来.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="section-validation-provider-resolver"/>5.2. <code class="classname">ValidationProviderResolver</code></h2></div></div></div><p>如果 Java Service Provider机制在你的环境中不能够正常工作, 或者你有特别的classloader设置的话, 你也可以提供一个自定义的<code class="classname">ValidationProviderResolver</code>.<a class="xref" href="#example-provider-resolver" title="例 5.4. 使用自定义的ValidationProviderResolver">例 5.4 “使用自定义的ValidationProviderResolver”</a>显示了如何在OSGi环境中插入自定义的provider resolver.</p><div class="example"><a id="example-provider-resolver"/><p class="title"><b>例 5.4. 使用自定义的ValidationProviderResolver</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_operator">&lt;?&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;config&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Validation</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">byDefaultProvider</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">providerResolver</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">OSGiServiceDiscoverer</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">configure</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">ValidatorFactory</span><span class="java_plain">&nbsp;factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;config</span><span class="java_separator">.</span><span class="java_plain">buildValidatorFactory</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getValidator</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>在这种情况下, 你的<code class="classname">OSGiServiceDiscoverer</code>类需要实现<code class="classname">ValidationProviderResolver</code>接口:</p><div class="example"><a id="d0e2550"/><p class="title"><b>例 5.5. ValidationProviderResolver接口</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ValidationProviderResolver</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;a&nbsp;list&nbsp;of&nbsp;ValidationProviders&nbsp;available&nbsp;in&nbsp;the&nbsp;runtime&nbsp;environment.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@return</span><span class="java_javadoc_comment">&nbsp;list&nbsp;of&nbsp;validation&nbsp;providers.&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">ValidationProvider</span><span class="java_operator">&lt;?&gt;&gt;</span><span class="java_plain">&nbsp;getValidationProviders</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span>
</pre></div></div><br class="example-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="section-message-interpolator"/>5.3. <code class="classname">MessageInterpolator</code></h2></div></div></div><p><a class="xref" href="#section-message-interpolation" title="2.2.4. 验证失败提示信息解析">第 2.2.4 节 “验证失败提示信息解析”</a> already discussed the default message interpolation algorithm. If you have special requirements for your message interpolation you can provide a custom interpolator using <code class="methodname">Configuration.messageInterpolator()</code>. This message interpolator will be shared by all validators generated by the <code class="classname">ValidatorFactory</code> created from this <code class="classname">Configuration</code>. <a class="xref" href="#example-message-interpolator" title="例 5.6. 自定义的MessageInterpolator">例 5.6 “自定义的MessageInterpolator”</a> shows an interpolator (available in Hibernate Validator) which can interpolate the value being validated in the constraint message. To refer to this value in the constraint message you can use: </p><div class="itemizedlist"><ul><li><p>${validatedValue}: this will call <code class="methodname">String.valueOf </code>on the validated value.</p></li><li><p>${validatedValue:&lt;format&gt;}: provide your own format string which will be passed to <code class="code">String.format</code> together with the validated value. Refer to the javadoc of <code class="code">String.format</code> for more information about the format options.</p></li></ul></div><div class="example"><a id="example-message-interpolator"/><p class="title"><b>例 5.6. 自定义的MessageInterpolator</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_operator">&lt;?&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;configuration&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Validation</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">byDefaultProvider</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">configure</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">ValidatorFactory</span><span class="java_plain">&nbsp;factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;configuration</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">messageInterpolator</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ValueFormatterMessageInterpolator</span><span class="java_separator">(</span><span class="java_plain">configuration</span><span class="java_separator">.</span><span class="java_plain">getDefaultMessageInterpolator</span><span class="java_separator">()))</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildValidatorFactory</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getValidator</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>It is recommended that <code class="classname">MessageInterpolator</code> implementations delegate final interpolation to the Bean Validation default <code class="classname">MessageInterpolator</code> to ensure standard Bean Validation interpolation rules are followed. The default implementation is accessible through <code class="methodname">Configuration.getDefaultMessageInterpolator()</code>.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="section-resource-bundle-locator"/>5.3.1. ResourceBundleLocator</h3></div></div></div><p>一个普遍的需求是你可能需要为错误消息解析指定你自己的resource bundles. <code class="classname">ResourceBundleMessageInterpolator</code>是Hibernate Validator中默认的<code class="classname">MessageInterpolator</code>的实现, 它默认情况下是通过<code class="methodname">ResourceBundle.getBundle</code>来获取resource bundle的. 不过, <code class="classname">ResourceBundleMessageInterpolator</code>也支持你指定一个自定义的<code class="classname">ResourceBundleLocator</code>实现来提供你自己的resource bundle. <a class="xref" href="#example-resource-bundle-locator" title="例 5.7. 自定义的ResourceBundleLocator">例 5.7 “自定义的ResourceBundleLocator”</a>提供了一个示例. 在这个例子中, 先通过<code class="methodname"> HibernateValidatorConfiguration.getDefaultResourceBundleLocator</code>获取默认的<code class="classname">ResourceBundleLocator</code>实现, 然后再用你自定义的实现把默认的包装起来, 代理模式.</p><div class="example"><a id="example-resource-bundle-locator"/><p class="title"><b>例 5.7. 自定义的ResourceBundleLocator</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">HibernateValidatorConfiguration</span><!-- <br/> --><span class="java_plain">&nbsp;configure&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Validation</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">byProvider</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">HibernateValidator</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">).</span><!-- <br/> --><span class="java_plain">configure</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">ResourceBundleLocator</span><span class="java_plain">&nbsp;defaultResourceBundleLocator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;configure</span><span class="java_separator">.</span><span class="java_plain">getDefaultResourceBundleLocator</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_type">ResourceBundleLocator</span><span class="java_plain">&nbsp;myResourceBundleLocator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">MyCustomResourceBundleLocator</span><span class="java_separator">(</span><span class="java_plain">defaultResourceBundleLocator</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">configure</span><span class="java_separator">.</span><span class="java_plain">messageInterpolator</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceBundleMessageInterpolator</span><span class="java_separator">(</span><span class="java_plain">myResourceBundleLocator</span><span class="java_separator">));</span>
</pre></div></div><br class="example-break"/><p>Hibernate Validator提供了两个<code class="classname">ResourceBundleLocator</code>的实现 - <code class="classname">PlatformResourceBundleLocator</code> (默认) 和 <code class="classname">AggregateResourceBundleLocator</code>. 后者可以定义一系列的resource bundle, 然后它会读取这些文件, 并且把它们组合成一个. 更多信息请参考此类的javadoc 文档.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2650"/>5.4. <code class="classname">TraversableResolver</code></h2></div></div></div><p>到目前位置我们还没有讨论过<code class="classname">TraversableResolver</code>接口, 它的设计目的是在某些情况下, 我们可能不应该去获取一个属性的状态. 最典型的情况就是一个延迟加载的属性或者与JPA中涉及到关联关系的时候. 当验证这两种情况的属性的时候, 很可能会触发一次对数据库的查询.Bean Validation正是通过<code class="classname">TraversableResolver</code>接口来控制能否访问某一个属性的 (<a class="xref" href="#example-traversable-resolver" title="例 5.8. TraversableResolver接口">例 5.8 “TraversableResolver接口”</a>).</p><div class="example"><a id="example-traversable-resolver"/><p class="title"><b>例 5.8. TraversableResolver接口</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;Contract&nbsp;determining&nbsp;if&nbsp;a&nbsp;property&nbsp;can&nbsp;be&nbsp;accessed&nbsp;by&nbsp;the&nbsp;Bean&nbsp;Validation&nbsp;provider</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;This&nbsp;contract&nbsp;is&nbsp;called&nbsp;for&nbsp;each&nbsp;property&nbsp;that&nbsp;is&nbsp;being&nbsp;either&nbsp;validated&nbsp;or&nbsp;cascaded.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;A&nbsp;traversable&nbsp;resolver&nbsp;implementation&nbsp;must&nbsp;be&nbsp;thread-safe.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*/</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">TraversableResolver</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Determine&nbsp;if&nbsp;the&nbsp;Bean&nbsp;Validation&nbsp;provider&nbsp;is&nbsp;allowed&nbsp;to&nbsp;reach&nbsp;the&nbsp;property&nbsp;state</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@param</span><span class="java_javadoc_comment">&nbsp;traversableObject&nbsp;object&nbsp;hosting&nbsp;&lt;code&gt;traversableProperty&lt;/code&gt;&nbsp;or&nbsp;null&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;validateValue&nbsp;is&nbsp;called</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@param</span><span class="java_javadoc_comment">&nbsp;traversableProperty&nbsp;the&nbsp;traversable&nbsp;property.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@param</span><span class="java_javadoc_comment">&nbsp;rootBeanType&nbsp;type&nbsp;of&nbsp;the&nbsp;root&nbsp;object&nbsp;passed&nbsp;to&nbsp;the&nbsp;Validator.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@param</span><span class="java_javadoc_comment">&nbsp;pathToTraversableObject&nbsp;path&nbsp;from&nbsp;the&nbsp;root&nbsp;object&nbsp;to</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;code&gt;traversableObject&lt;/code&gt;</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(using&nbsp;the&nbsp;path&nbsp;specification&nbsp;defined&nbsp;by&nbsp;Bean&nbsp;Validator).</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@param</span><span class="java_javadoc_comment">&nbsp;elementType&nbsp;either&nbsp;&lt;code&gt;FIELD&lt;/code&gt;&nbsp;or&nbsp;&lt;code&gt;METHOD&lt;/code&gt;.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@return</span><span class="java_javadoc_comment">&nbsp;&lt;code&gt;true&lt;/code&gt;&nbsp;if&nbsp;the&nbsp;Bean&nbsp;Validation&nbsp;provider&nbsp;is&nbsp;allowed&nbsp;to</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reach&nbsp;the&nbsp;property&nbsp;state,&nbsp;&lt;code&gt;false&lt;/code&gt;&nbsp;otherwise.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isReachable</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;traversableObject</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Path</span><span class="java_separator">.</span><span class="java_type">Node</span><span class="java_plain">&nbsp;traversableProperty</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;rootBeanType</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Path</span><span class="java_plain">&nbsp;pathToTraversableObject</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ElementType</span><span class="java_plain">&nbsp;elementType</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Determine&nbsp;if&nbsp;the&nbsp;Bean&nbsp;Validation&nbsp;provider&nbsp;is&nbsp;allowed&nbsp;to&nbsp;cascade&nbsp;validation&nbsp;on</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;bean&nbsp;instance&nbsp;returned&nbsp;by&nbsp;the&nbsp;property&nbsp;value</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;marked&nbsp;as&nbsp;&lt;code&gt;</span><span class="java_javadoc_tag">@Valid</span><span class="java_javadoc_comment">&lt;/code&gt;.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Note&nbsp;that&nbsp;this&nbsp;method&nbsp;is&nbsp;called&nbsp;only&nbsp;if&nbsp;isReachable&nbsp;returns&nbsp;true&nbsp;for&nbsp;the&nbsp;same&nbsp;set&nbsp;of</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;arguments&nbsp;and&nbsp;if&nbsp;the&nbsp;property&nbsp;is&nbsp;marked&nbsp;as&nbsp;&lt;code&gt;</span><span class="java_javadoc_tag">@Valid</span><span class="java_javadoc_comment">&lt;/code&gt;</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@param</span><span class="java_javadoc_comment">&nbsp;traversableObject&nbsp;object&nbsp;hosting&nbsp;&lt;code&gt;traversableProperty&lt;/code&gt;&nbsp;or&nbsp;null</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;validateValue&nbsp;is&nbsp;called</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@param</span><span class="java_javadoc_comment">&nbsp;traversableProperty&nbsp;the&nbsp;traversable&nbsp;property.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@param</span><span class="java_javadoc_comment">&nbsp;rootBeanType&nbsp;type&nbsp;of&nbsp;the&nbsp;root&nbsp;object&nbsp;passed&nbsp;to&nbsp;the&nbsp;Validator.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@param</span><span class="java_javadoc_comment">&nbsp;pathToTraversableObject&nbsp;path&nbsp;from&nbsp;the&nbsp;root&nbsp;object&nbsp;to</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;code&gt;traversableObject&lt;/code&gt;</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(using&nbsp;the&nbsp;path&nbsp;specification&nbsp;defined&nbsp;by&nbsp;Bean&nbsp;Validator).</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@param</span><span class="java_javadoc_comment">&nbsp;elementType&nbsp;either&nbsp;&lt;code&gt;FIELD&lt;/code&gt;&nbsp;or&nbsp;&lt;code&gt;METHOD&lt;/code&gt;.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@return</span><span class="java_javadoc_comment">&nbsp;&lt;code&gt;true&lt;/code&gt;&nbsp;if&nbsp;the&nbsp;Bean&nbsp;Validation&nbsp;provider&nbsp;is&nbsp;allowed&nbsp;to</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cascade&nbsp;validation,&nbsp;&lt;code&gt;false&lt;/code&gt;&nbsp;otherwise.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isCascadable</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;traversableObject</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Path</span><span class="java_separator">.</span><span class="java_type">Node</span><span class="java_plain">&nbsp;traversableProperty</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;rootBeanType</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Path</span><span class="java_plain">&nbsp;pathToTraversableObject</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ElementType</span><span class="java_plain">&nbsp;elementType</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span>
</pre></div></div><br class="example-break"/><p>Hibernate Validator provides two <code class="classname">TraversableResolver</code>s out of the box which will be enabled automatically depending on your environment. The first is the <code class="classname">DefaultTraversableResolver</code> which will always return true for <code class="methodname">isReachable()</code> and <code class="methodname">isTraversable()</code>. The second is the <code class="classname">JPATraversableResolver</code> which gets enabled when Hibernate Validator gets used in combination with JPA 2. In case you have to provide your own resolver you can do so again using the <code class="classname">Configuration</code> object as seen in <a class="xref" href="#example-traversable-resolver-config" title="例 5.9. 自定义的TraversableResolver">例 5.9 “自定义的TraversableResolver”</a>.</p><div class="example"><a id="example-traversable-resolver-config"/><p class="title"><b>例 5.9. 自定义的TraversableResolver</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_operator">&lt;?&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;configuration&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Validation</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">byDefaultProvider</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">configure</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">ValidatorFactory</span><span class="java_plain">&nbsp;factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;configuration</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">traversableResolver</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">MyTraversableResolver</span><span class="java_separator">())</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildValidatorFactory</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getValidator</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2696"/>5.5. <code class="classname">ConstraintValidatorFactory</code></h2></div></div></div><p>最后, 还有个配置项得提一下, 那就是<code class="classname">ConstraintValidatorFactory</code>类. Hibernate Validator中默认的<code class="classname">ConstraintValidatorFactory</code>需要一个无参的构造方法来初始化<code class="classname">ConstraintValidator</code>的实例(参考<a class="xref" href="#section-constraint-validator">第 3.1.2 节 “约束校验器”</a>). 对于自定义的<code class="classname">ConstraintValidatorFactory</code>实现来说, 例如, 你可以让其支持对约束条件的依赖注入等功能. 配置使用这个自定义的<code class="classname">ConstraintValidatorFactory</code>的方法还是老样子(<a class="xref" href="#example-constraint-validator-factory" title="例 5.10. 自定义的ConstraintValidatorFactory">例 5.10 “自定义的ConstraintValidatorFactory”</a>).</p><div class="example"><a id="example-constraint-validator-factory"/><p class="title"><b>例 5.10. 自定义的ConstraintValidatorFactory</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_operator">&lt;?&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;configuration&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Validation</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">byDefaultProvider</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">configure</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">ValidatorFactory</span><span class="java_plain">&nbsp;factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;configuration</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">constraintValidatorFactory</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">IOCConstraintValidatorFactory</span><span class="java_separator">())</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildValidatorFactory</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getValidator</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>你需要实现此接口:</p><div class="example"><a id="d0e2728"/><p class="title"><b>例 5.11. ConstraintValidatorFactory接口</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ConstraintValidatorFactory</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@param</span><span class="java_javadoc_comment">&nbsp;key&nbsp;The&nbsp;class&nbsp;of&nbsp;the&nbsp;constraint&nbsp;validator&nbsp;to&nbsp;instantiate.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@return</span><span class="java_javadoc_comment">&nbsp;A&nbsp;constraint&nbsp;validator&nbsp;instance&nbsp;of&nbsp;the&nbsp;specified&nbsp;class.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">T&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">ConstraintValidator</span><span class="java_operator">&lt;?</span><span class="java_separator">,</span><span class="java_operator">?&gt;&gt;</span><span class="java_plain">&nbsp;T&nbsp;getInstance</span><span class="java_separator">(</span><span class="java_type">Class</span><span class="java_operator">&lt;</span><span class="java_plain">T</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;key</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span>
</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>警告</h2><p>如果一个约束条件的实现需要依赖<code class="classname">ConstraintValidatorFactory</code>的某个特定的行为(例如依赖注入或者没有无参的构造方法等) 都可能导致不可移植.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>ConstraintValidatorFactory不应该缓存其创建的实例, 因为每个实例都可能在其的初始化方法中被修改.</p></div></div></div><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-metadata-api"/>第 6 章 Metadata API</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e2751">6.1. BeanDescriptor</a></span></dt><dt><span class="section"><a href="#section-property-descriptor">6.2. PropertyDescriptor</a></span></dt><dt><span class="section"><a href="#d0e2825">6.3. ElementDescriptor</a></span></dt><dt><span class="section"><a href="#section-constraint-descriptor">6.4. ConstraintDescriptor</a></span></dt></dl></div><p>The Bean Validation specification provides not only a validation engine, but also a metadata repository for all defined constraints. The following paragraphs are discussing this API. All the introduced classes can be found in the <span class="package">javax.validation.metadata</span> package.</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2751"/>6.1. <code class="classname"><a id="section-bean-descriptor"/>BeanDescriptor</code></h2></div></div></div><p>The entry into the metadata API is via <code class="code">Validator.getConstraintsForClass</code> which returns an instance of the <a class="ulink" href="http://docs.jboss.org/hibernate/stable/beanvalidation/api/javax/validation/metadata/BeanDescriptor.html"><code class="classname">BeanDescriptor</code></a> interface. Using this bean descriptor you can determine whether the specified class hosts any constraints at all via <code class="code">beanDescriptor.isBeanConstrained</code>. </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>If a constraint declaration hosted by the requested class is invalid, a <code class="classname">ValidationException</code> is thrown.</p></div><p>You can then call <code class="code">beanDescriptor.getConstraintDescriptors</code> to get a set of <code class="classname">ConstraintDescriptor</code>s representing all class level constraints.</p><p>If you are interested in property level constraints, you can call <code class="code">beanDescriptor.getConstraintsForProperty</code> or <code class="code">beanDescriptor.getConstrainedProperties</code> to get a single resp. set of <code class="classname">PropertyDescriptor</code>s (see <a class="xref" href="#section-property-descriptor" title="6.2. PropertyDescriptor">第 6.2 节 “PropertyDescriptor”</a>). </p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="section-property-descriptor"/>6.2. <code class="classname">PropertyDescriptor</code></h2></div></div></div><p>The <a class="ulink" href="http://docs.jboss.org/hibernate/stable/beanvalidation/api/javax/validation/metadata/PropertyDescriptor.html"><code class="classname">PropertyDescriptor</code></a> interface extends the <code class="classname">ElementDescriptor</code> interface and represents constraints on properties of a class. The constraint can be declared on the attribute itself or on the getter of the attribute - provided Java Bean naming conventions are respected. A <code class="classname">PropertyDescriptor</code> adds <code class="code">isCascaded</code> (returning <code class="constant">true</code> if the property is marked with <code class="classname">@Valid</code>) and <code class="code">getPropertyName</code> to the <code class="classname">ElementDescriptor</code> functionality.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2825"/>6.3. <code class="classname">ElementDescriptor</code></h2></div></div></div><p>The <a class="ulink" href="http://docs.jboss.org/hibernate/stable/beanvalidation/api/javax/validation/metadata/ElementDescriptor.html"><code class="classname">ElementDiscriptor</code></a> interface is the common base class for <code class="classname">BeanDescriptor</code> and <code class="classname">PropertyDescriptor</code>. Next to the <code class="code">hasConstraints </code>and <code class="code">getConstraintDescriptors</code> methods it also offers access to the <code class="classname">ConstraintFinder</code> API which allows you to query the metadata API in a more fine grained way. For example you can restrict your search to constraints described on fields or on getters or a given set of groups. Given an <code class="classname">ElementDescriptor</code> instance you just call <code class="code">findConstraints</code> to retrieve a <code class="classname">ConstraintFinder</code> instance. </p><div class="example"><a id="example-constraint-finder"/><p class="title"><b>例 6.1. Usage of ConstraintFinder</b></p><div class="example-contents"><pre class="programlisting">Validator validator = Validation.buildDefaultValidatorFactory().getValidator();
BeanDescriptor beanDescriptor = validator.getConstraintsForClass(Person.class);
PropertyDescriptor propertyDescriptor = beanDescriptor.getConstraintsForProperty("name");
Set&lt;ConstraintDescriptor&lt;?&gt;&gt; constraints = propertyDescriptor.findConstraints()
                                           .declaredOn(ElementType.METHOD)
                                           .unorderedAndMatchingGroups(Default.class)
                                           .lookingAt(Scope.LOCAL_ELEMENT)
                                           .getConstraintDescriptors();</pre></div></div><br class="example-break"/><p><a class="xref" href="#example-constraint-finder" title="例 6.1. Usage of ConstraintFinder">例 6.1 “Usage of ConstraintFinder”</a> shows an example on how to use the <code class="classname">ConstraintFinder</code> API. Interesting are especially the restrictions <code class="code">unorderedAndMatchingGroups</code> and <code class="code">lookingAt(<a class="ulink" href="http://docs.jboss.org/hibernate/stable/beanvalidation/api/javax/validation/metadata/Scope.html">Scope.LOCAL_ELEMENT</a>)</code>. The former allows to only return <code class="classname">ConstraintDescriptors</code> matching a specified set of groups wheras the latter allows to distinguish between constraint directly specified on the element (<code class="constant">Scope.LOCAL_ELEMENT</code>) or constraints belonging to the element but hosted anywhere in the class hierarchy (<code class="constant">Scope.HIERARCHY</code>).</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>警告</h2><p>Order is not respected by unorderedAndMatchingGroups, but group inheritance and inheritance via sequence are.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="section-constraint-descriptor"/>6.4. <code class="classname">ConstraintDescriptor</code></h2></div></div></div><p>Last but not least, the <a class="ulink" href="http://docs.jboss.org/hibernate/stable/beanvalidation/api/javax/validation/metadata/ConstraintDescriptor.html"><code class="classname">ConstraintDescriptor</code></a> interface describes a single constraint together with its composing constraints. Via an instance of this interface you get access to the constraint annotation and its parameters, as well as the groups the constraint is supposed to be applied on. It also also you to access the pass-through constraint payload (see <a class="xref" href="#example-defining-custom-constraint" title="例 3.2. 定义一个CheckCase的约束标注">例 3.2 “定义一个CheckCase的约束标注”</a>).</p></div></div><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-integration"/>第 7 章 与其他框架集成</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#validator-osgi">7.1. OSGi</a></span></dt><dt><span class="section"><a href="#validator-checkconstraints-db">7.2. 与数据库集成校验</a></span></dt><dt><span class="section"><a href="#validator-checkconstraints-orm">7.3. ORM集成</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-checkconstraints-orm-hibernateevent">7.3.1. 基于Hibernate事件模型的校验</a></span></dt><dt><span class="section"><a href="#d0e3095">7.3.2. JPA</a></span></dt></dl></dd><dt><span class="section"><a href="#section-presentation-layer">7.4. 展示层校验</a></span></dt></dl></div><p>Hibernate Validator 的设计初衷是在一个分层的应用程序中, 约束信息只需要被定义一次( 通过在领域模型上标注), 然后在不同的层中进行数据校验.</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-osgi"/>7.1. OSGi</h2></div></div></div><p>The Hibernate Validator jar file is conform to the OSGi specification and can be used within any OSGi container. The following lists represent the packages imported and exported by Hibernate Validator. The classes within the exported packages are considered part of Hibernate Validator public API.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>The Java Service Provider mechanism used by Bean Validation to automatically discover validation providers doesn't work in an OSGi environment. To solve this, you have to provide a custom <code class="classname">ValidationProviderResolver</code>. See <a class="xref" href="#section-validation-provider-resolver" title="5.2. ValidationProviderResolver">第 5.2 节 “ValidationProviderResolver”</a></p></div><div class="itemizedlist"><p class="title"><b>Exported packages</b></p><ul><li><p><span class="package">org.hibernate.validator</span></p></li><li><p><span class="package">org.hibernate.validator.cfg.*</span></p></li><li><p><span class="package">org.hibernate.validator.constraints.*</span></p></li><li><p><span class="package">org.hibernate.validator.group</span></p></li><li><p><span class="package">org.hibernate.validator.messageinterpolation</span></p></li><li><p><span class="package">org.hibernate.validator.resourceloading</span></p></li><li><p><span class="package">org.hibernate.validator.spi.*</span></p></li></ul></div><div class="itemizedlist"><p class="title"><b>Imported packages</b></p><ul><li><p><span class="package">javax.persistence.*</span>, [2.0.0,3.0.0), optional</p></li><li><p><span class="package">javax.validation.*</span>, [1.0.0,2.0.0)</p></li><li><p><span class="package">javax.xml.*</span></p></li><li><p><span class="package">javax.el.*</span>, [2.0.0,4.0.0)</p></li><li><p><span class="package">org.xml.sax.*</span></p></li><li><p><span class="package">org.jboss.logging.*</span>, [3.1.0,4.0.0)</p></li><li><p><span class="package">com.fasterxml.classmate.*</span>, 0.8.0</p></li><li><p><span class="package">org.joda.time.*</span>, [1.6.0,2.0.0), optional</p></li><li><p><span class="package">org.jsoup.*</span>, [1.5.2,2.0.0), optional</p></li></ul></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-checkconstraints-db"/>7.2. 与数据库集成校验</h2></div></div></div><p>Hibernate Annotations (即 Hibernate 3.5.x) 会自动的把你定已在实体模型上的约束信息添加到其映射信息中. 例如, 假设你的一个实体类的属性上有<code class="literal">@NotNull</code>的约束的话, 那么Hibernate在生成创建此实体对应的表的DDL的时候, 会自动的给那个属性对应的字段添加上<code class="literal">not null</code>.</p><p>If, for some reason, the feature needs to be disabled, set <code class="literal">hibernate.validator.apply_to_ddl</code> to <code class="literal">false</code>. See also <a class="xref" href="#table-spec-constraints" title="表 2.2. Bean Validation constraints">表 2.2 “Bean Validation constraints”</a> and <a class="xref" href="#table-custom-constraints" title="表 2.3. Custom constraints">表 2.3 “Custom constraints”</a>.</p><p>你也可以限制这个DDL约束自动生成的特性只应用到一部分实体类. 只需要设置<span class="property">org.hibernate.validator.group.ddl</span>属性, 这个属性的值是你想要应用此特性的实体类的全路径名称, 每个以逗号分隔.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-checkconstraints-orm"/>7.3. ORM集成</h2></div></div></div><p>Hibernate Validator不仅能够和Hibernate集成工作, 还能够和任何JPA的实现很好的一起工作.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>When lazy loaded associations are supposed to be validated it is recommended to place the constraint on the getter of the association. Hibernate replaces lazy loaded associations with proxy instances which get initialized/loaded when requested via the getter. If, in such a case, the constraint is placed on field level the actual proxy instance is used which will lead to validation errors.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-checkconstraints-orm-hibernateevent"/>7.3.1. 基于Hibernate事件模型的校验</h3></div></div></div><p>Hibernate Annotations (即 Hibernate 3.5.x) 中包含了一个的Hibernate 事件监听器(译注: 请阅读Hibernate Core文档了解Hibernate的事件模型) - <a class="ulink" href="http://fisheye.jboss.org/browse/Hibernate/core/trunk/annotations/src/main/java/org/hibernate/cfg/beanvalidation/BeanValidationEventListener.java"><code class="classname">org.hibernate.cfg.beanvalidation.BeanValidationEventListener</code></a> - 来为Hibernate Validator服务. 当一个<code class="literal">PreInsertEvent</code>, <code class="literal">PreUpdateEvent</code> 或 <code class="classname">PreDeleteEvent</code>事件发生的时候, 这个监听器就可以对该事件所涉及到的实体对象进行校验, 如果校验不通过的话, 则抛出异常. 默认情况下, Hibernate在对每个对象进行保存或者修改操作的时候,都会对其进行校验, 而删除操作则不会. 你可以通过<span class="property">javax.persistence.validation.group.pre-persist</span>, <span class="property">javax.persistence.validation.group.pre-update</span> 和 <span class="property">javax.persistence.validation.group.pre-remove</span>属性来定义对应事件发生的时候, 具体要校验哪(些)个校验组, 这个属性的值是要应用的校验组类的全路径, 使用逗号分隔. <a class="xref" href="#example-beanvalidationeventlistener-config" title="例 7.1. 自定义BeanValidationEvenListener">例 7.1 “自定义BeanValidationEvenListener”</a>显示了这几个属性在Hibernate内部定义的默认值, 所以, 你不需要在你的应用中再重复定义了.</p><p>如果发生了违反约束条件的情况, 该监听器会抛出一个运行时的<code class="classname">ConstraintViolationException</code>异常, 此异常包含了一系列的<code class="literal">ConstraintViolation</code>对象用于描述每个违反了约束条件的情况.</p><p>如果类路径上有Hibernate Validator, 则Hibernate Annotations (或 Hibernate EntityManager)会自动调用它, 如果你想避免这种情况, 可以设置<span class="property">javax.persistence.validation.mode</span>属性为<code class="constant">none</code>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>如果实体模型上没有定义约束条件, 则不会有任何性能损耗.</p></div><p>如果你想在Hibernate Core中使用上面提到的事件监听器, 则可以在<code class="literal">hibernate.cfg.xml</code>中定义如下的配置信息:</p><div class="example"><a id="example-beanvalidationeventlistener-config"/><p class="title"><b>例 7.1. 自定义<code class="classname">BeanValidationEvenListener</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">hibernate-configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">session-factory</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.persistence.validation.group.pre-persist&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">javax.validation.groups.Default</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.persistence.validation.group.pre-update&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">javax.validation.groups.Default</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.persistence.validation.group.pre-remove&quot;</span><span class="xml_tag_symbols">&gt;&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">event</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;pre-update&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">listener</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.cfg.beanvalidation.BeanValidationEventListener&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">event</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">event</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;pre-insert&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">listener</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.cfg.beanvalidation.BeanValidationEventListener&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">event</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">event</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;pre-delete&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">listener</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.cfg.beanvalidation.BeanValidationEventListener&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">event</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">session-factory</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">hibernate-configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3095"/>7.3.2. JPA</h3></div></div></div><p>If you are using JPA 2 and Hibernate Validator is in the classpath the JPA2 specification requires that Bean Validation gets enabled. The properties <span class="property">javax.persistence.validation.group.pre-persist</span>, <span class="property">javax.persistence.validation.group.pre-update</span> and <span class="property">javax.persistence.validation.group.pre-remove</span> as described in <a class="xref" href="#validator-checkconstraints-orm-hibernateevent" title="7.3.1. 基于Hibernate事件模型的校验">第 7.3.1 节 “基于Hibernate事件模型的校验”</a> can in this case be configured in <code class="filename">persistence.xml</code>. <code class="filename">persistence.xml</code> also defines a node validation-mode which can be set to <code class="constant">AUTO</code>, <code class="constant">CALLBACK</code>, <code class="constant">NONE</code>. The default is <code class="constant">AUTO</code>.</p><p>对于JPA1来讲, 你需要自己创建和注册Hibernate Validator. 如果你是使用Hibernate EntityManager, 那么你可以把<a class="xref" href="#validator-checkconstraints-orm-hibernateevent" title="7.3.1. 基于Hibernate事件模型的校验">第 7.3.1 节 “基于Hibernate事件模型的校验”</a>中列出来的<code class="classname">BeanValidationEventListener</code>类添加到你的项目中, 然后再手工注册它.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="section-presentation-layer"/>7.4. 展示层校验</h2></div></div></div><p>如果你正在使用JSF2或者<span class="productname">JBoss Seam</span>™,并且Hibernate Validator (Bean Validation) 在类路径上的话, 那么界面上的字段可以被自动校验. <a class="xref" href="#example-jsf2" title="例 7.2. 在JSF2中使用Bean Validation">例 7.2 “在JSF2中使用Bean Validation”</a>显示了一个在JSF页面上使用f:validateBean标签的实例. 更多的信息请参考Seam的文档或者JSF2规范.</p><div class="example"><a id="example-jsf2"/><p class="title"><b>例 7.2. 在JSF2中使用Bean Validation</b></p><div class="example-contents"><pre class="programlisting">&lt;h:form&gt;
  <span class="bold"><strong>&lt;f:validateBean&gt;</strong></span>
    &lt;h:inputText value=”#{model.property}” /&gt;
    &lt;h:selectOneRadio value=”#{model.radioProperty}” &gt; ... &lt;/h:selectOneRadio&gt;
    &lt;!-- other input components here --&gt;
  <span class="bold"><strong>&lt;/f:validateBean&gt;</strong></span>
&lt;/h:form&gt;
</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>The integration between JSF 2 and Bean Validation is described in the "Bean Validation Integration" chapter of <a class="ulink" href="http://jcp.org/en/jsr/detail?id=314">JSR-314</a>. It is interesting to know that JSF 2 implements a custom MessageInterpolator to ensure ensure proper localization. To encourage the use of the Bean Validation message facility, JSF 2 will per default only display the generated Bean Validation message. This can, however, be configured via the application resource bundle by providing the following configuration (<em class="parameter"><code>{0}</code></em> is replaced with the Bean Validation message and <em class="parameter"><code>{1}</code></em> is replaced with the JSF component label):</p><pre class="programlisting">javax.faces.validator.BeanValidator.MESSAGE={1}: {0}</pre><p>The default is:</p><pre class="programlisting">javax.faces.validator.BeanValidator.MESSAGE={0}</pre></div></div></div><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-specifics"/>第 8 章 Hibernate Validator Specifics</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e3184">8.1. Public API</a></span></dt><dt><span class="section"><a href="#d0e3330">8.2. Fail fast mode</a></span></dt><dt><span class="section"><a href="#validator-customoptions-methodvalidation">8.3. Method validation</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3403">8.3.1. Defining method-level constraints</a></span></dt><dt><span class="section"><a href="#d0e3478">8.3.2. Evaluating method-level constraints</a></span></dt><dt><span class="section"><a href="#d0e3568">8.3.3. Retrieving method-level constraint meta data</a></span></dt></dl></dd><dt><span class="section"><a href="#programmaticapi">8.4. Programmatic constraint definition</a></span></dt><dt><span class="section"><a href="#d0e3700">8.5. Boolean composition for constraint composition</a></span></dt></dl></div><p>In the following sections we are having a closer look at some of the Hibernate Validator specific features (features which are not part of the Bean Validation specification). This includes the fail fast mode, the programmatic constraint configuration API and boolean composition of composing constraints.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>The features described in the following sections are not portable between Bean Validation providers/implementations.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3184"/>8.1. Public API</h2></div></div></div><p>Let's start, however, with a look at the public API of Hibernate Validator. <a class="xref" href="#validator-public-api" title="表 8.1. Hibernate Validator public API">表 8.1 “Hibernate Validator public API”</a> lists all packages belonging to this API and describes their purpose.</p><p>Any packages not listed in that table are internal packages of Hibernate Validator and are not intended to be accessed by clients. The contents of these internal packages can change from release to release without notice, thus possibly breaking any client code relying on it.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>In the following table, when a package is public its not necessarily true for its nested packages.</p></div><div class="table"><a id="validator-public-api"/><p class="title"><b>表 8.1. Hibernate Validator public API</b></p><div class="table-contents"><table summary="Hibernate Validator public API" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Packages</th><th>Description</th></tr></thead><tbody valign="top"><tr><td valign="top"><span class="package">org.hibernate.validator</span></td><td valign="top">This package contains the classes used by the Bean Validation bootstrap mechanism (eg. validation provider, configuration class). For more details see <a class="xref" href="#validator-bootstrapping" title="第 5 章 Bootstrapping">第 5 章 <i>Bootstrapping</i></a>.</td></tr><tr><td valign="top"><span class="package">org.hibernate.validator.cfg</span>, <span class="package">org.hibernate.validator.cfg.context</span>, <span class="package">org.hibernate.validator.cfg.defs</span></td><td valign="top">With Hibernate Validator you can define constraints via a fluent API. These packages contain all classes needed to use this feature. In the package <span class="package">org.hibernate.validator.cfg</span> you will find the <code class="classname">ConstraintMapping</code> class and in package <span class="package">org.hibernate.validator.cfg.defs</span> all constraint definitions. For more details see <a class="xref" href="#programmaticapi" title="8.4. Programmatic constraint definition">第 8.4 节 “Programmatic constraint definition”</a>.</td></tr><tr><td valign="top"><span class="package">org.hibernate.validator.constraints</span>, <span class="package">org.hibernate.validator.constraints.br</span></td><td valign="top">In addition to Bean Validation constraints, Hibernate Validator provides some useful custom constraints. These packages contain all custom annotation classes. For more details see <a class="xref" href="#validator-defineconstraints-hv-constraints" title="2.4.2. Additional constraints">第 2.4.2 节 “Additional constraints”</a>.</td></tr><tr><td valign="top"><span class="package">org.hibernate.validator.group</span>, <span class="package">org.hibernate.validator.spi.group</span></td><td valign="top">With Hibernate Validator you can define dynamic default group sequences in function of the validated object state. These packages contain all classes needed to use this feature (<code class="classname">GroupSequenceProvider</code> annotation and <code class="classname">DefaultGroupSequenceProvider</code> contract). For more details see <a class="xref" href="#section-default-group-class" title="2.3.2. 对一个类重定义其默认校验组">第 2.3.2 节 “对一个类重定义其默认校验组”</a>.</td></tr><tr><td valign="top"><span class="package">org.hibernate.validator.messageinterpolation</span>, <span class="package">org.hibernate.validator.resourceloading</span>, <span class="package">org.hibernate.validator.spi.resourceloading</span></td><td valign="top">These packages contain the classes related to constraint message interpolation. The first package contains two implementations of <code class="classname">MessageInterpolator</code>. The first one, <code class="classname">ValueFormatterMessageInterpolator</code> allows to interpolate the validated value into the constraint message, see <a class="xref" href="#section-message-interpolator" title="5.3. MessageInterpolator">第 5.3 节 “MessageInterpolator”</a>. The second implementation named <code class="classname">ResourceBundleMessageInterpolator</code> is the implementation used by default by Hibernate Validator. This implementation relies on a <code class="classname">ResourceBundleLocator</code>, see <a class="xref" href="#section-resource-bundle-locator" title="5.3.1. ResourceBundleLocator">第 5.3.1 节 “ResourceBundleLocator”</a>. Hibernate Validator provides different <code class="classname">ResourceBundleLocator</code> implementations located in the package <span class="package">org.hibernate.validator.resourceloading</span>.</td></tr><tr><td valign="top"><span class="package">org.hibernate.validator.method</span>, <span class="package">org.hibernate.validator.method.metadata</span></td><td valign="top">Hibernate Validator provides support for method-level constraints based on appendix C of the Bean Validation specification. The first package contains the <code class="classname">MethodValidator</code> interface allowing you to validate method return values and parameters. The second package contains meta data for constraints hosted on parameters and methods which can be retrieved via the <code class="classname">MethodValidator</code>.</td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>The public packages of Hibernate Validator fall into two categories: while the actual API parts are intended to be <span class="emphasis"><em>invoked</em></span> or <span class="emphasis"><em>used</em></span> by clients (e.g. the API for programmatic constraint declaration or the custom constraints), the SPI (service provider interface) packages contain interfaces which are intended to be <span class="emphasis"><em>implemented</em></span> by clients (e.g. <code class="classname">ResourceBundleLocator</code>).</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3330"/>8.2. Fail fast mode</h2></div></div></div><p>First off, the fail fast mode. Hibernate Validator allows to return from the current validation as soon as the first constraint violation occurs. This is called the <span class="emphasis"><em>fail fast mode</em></span> and can be useful for validation of large object graphs where one is only interested whether there is a constraint violation or not. <a class="xref" href="#example-fail-fast-property" title="例 8.1. Enabling failFast via a property">例 8.1 “Enabling failFast via a property”</a>, <a class="xref" href="#example-fail-fast-configuration" title="例 8.2. Enabling failFast at the Configuration level">例 8.2 “Enabling failFast at the Configuration level”</a> and <a class="xref" href="#example-fail-fast-factory" title="例 8.3. Enabling failFast at the ValidatorFactory level">例 8.3 “Enabling failFast at the ValidatorFactory level”</a> show multiple ways to enable the fail fast mode.</p><div class="example"><a id="example-fail-fast-property"/><p class="title"><b>例 8.1. Enabling <code class="option">failFast</code> via a property</b></p><div class="example-contents"><pre class="programlisting">HibernateValidatorConfiguration configuration = Validation.byProvider( HibernateValidator.class ).configure();
ValidatorFactory factory = configuration.addProperty( "hibernate.validator.fail_fast", "true" ).buildValidatorFactory();
Validator validator = factory.getValidator();

// do some actual fail fast validation
...</pre></div></div><br class="example-break"/><div class="example"><a id="example-fail-fast-configuration"/><p class="title"><b>例 8.2. Enabling <code class="option">failFast</code> at the <code class="classname">Configuration</code> level</b></p><div class="example-contents"><pre class="programlisting">HibernateValidatorConfiguration configuration = Validation.byProvider( HibernateValidator.class ).configure();
ValidatorFactory factory = configuration.failFast( true ).buildValidatorFactory();
Validator validator = factory.getValidator();

// do some actual fail fast validation
...</pre></div></div><br class="example-break"/><div class="example"><a id="example-fail-fast-factory"/><p class="title"><b>例 8.3. Enabling <code class="option">failFast</code> at the <code class="classname">ValidatorFactory</code> level</b></p><div class="example-contents"><pre class="programlisting">HibernateValidatorConfiguration configuration = Validation.byProvider( HibernateValidator.class ).configure();
ValidatorFactory factory = configuration.buildValidatorFactory();

Validator validator = factory.getValidator();

// do some non fail fast validation
...

validator = factory.unwrap( HibernateValidatorFactory.class )
            .usingContext()
            .failFast( true )
            .getValidator();

// do fail fast validation
...</pre></div></div><br class="example-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-customoptions-methodvalidation"/>8.3. Method validation</h2></div></div></div><p>The Bean Validation API allows to specify constraints for fields, properties and types. Hibernate Validator goes one step further and allows to place contraint annotations also on method parameters and method return values, thus enabling a programming style known as "Programming by Contract".</p><p>More specifically this means that Bean Validation constraints can be used to specify</p><div class="itemizedlist"><ul><li><p>the preconditions that must be met before a method invocation (by annotating method parameters with constraints) and</p></li><li><p>the postconditions that are guaranteed after a method invocation (by annotating methods)</p></li></ul></div><p>This approach has several advantages over traditional ways of parameter and return value checking:</p><div class="itemizedlist"><ul><li><p>The checks don't have to be performed manually (e.g. by throwing <code class="classname">IllegalArgumentExceptions</code> or similar), resulting in less code to write and maintain.</p></li><li><p>A method's pre- and postconditions don't have to be expressed again in the method's JavaDoc, since the constraint annotations will automatically be included in the generated JavaDoc. This avoids redundancy and reduces the chance of inconsistencies between implementation and documentation.</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>Method validation was also considered to be included in the Bean Validation API as defined by JSR 303, but it didn't become part of the 1.0 version. A basic draft is outlined in appendix C of the specification, and the implementation in Hibernate Validator is largely influenced by this draft. The feature is considered again for inclusion in BV 1.1.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3403"/>8.3.1. Defining method-level constraints</h3></div></div></div><p><a class="xref" href="#example-method-constraints" title="例 8.4. Using method-level constraints">例 8.4 “Using method-level constraints”</a> demonstrates the definition of method-level constraints.</p><div class="example"><a id="example-method-constraints"/><p class="title"><b>例 8.4. Using method-level constraints</b></p><div class="example-contents"><pre class="programlisting">public class RentalStation {

    @NotNull 
    public Car rentCar(@NotNull Customer customer, @NotNull @Future Date startDate, @Min(1) int durationInDays) { 
        //...
    }
}</pre></div></div><p><br class="example-break"/></p><p>Here the following pre- and postconditions for the <code class="methodname">rentCar()</code> method are declared:</p><div class="itemizedlist"><ul><li><p>The renting customer may not be null</p></li><li><p>The rental's start date must not be null and must be in the future</p></li><li><p>The rental duration must be at least one day</p></li><li><p>The returned <code class="classname">Car</code> instance may not be null</p></li></ul></div><p>Using the <code class="classname">@Valid</code> annotation it's also possible to define that a cascaded validation of parameter or return value objects shall be performed. An example can be found in <a class="xref" href="#example-cascaded-method-constraints" title="例 8.5. Cascaded validation of method-level constraints">例 8.5 “Cascaded validation of method-level constraints”</a>.</p><div class="example"><a id="example-cascaded-method-constraints"/><p class="title"><b>例 8.5. Cascaded validation of method-level constraints</b></p><div class="example-contents"><pre class="programlisting">public class RentalStation {

    @Valid
    public Set&lt;Rental&gt; getRentalsByCustomer(@Valid Customer customer) { 
        //...
    }
}</pre></div></div><br class="example-break"/><p>Here all the constraints declared at the <code class="classname">Customer</code> type will be evaluated when validating the method parameter and all constraints declared at the returned <code class="classname">Rental</code> objects will be evaluated when validating the method's return value.</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3455"/>8.3.1.1. Using method constraints in type hierarchies</h4></div></div></div><p>Special care must be taken when defining parameter constraints in inheritance hierarchies.</p><p>When a method is overridden in sub-types method parameter constraints can only be declared at the base type. The reason for this restriction is that the preconditions to be fulfilled by a type's client must not be strengthened in sub-types (which may not even be known to the base type's client). Note that also if the base method doesn't declare any parameter constraints at all, no parameter constraints may be added in overriding methods.</p><p>The same restriction applies to interface methods: no parameter constraints may be defined at the implementing method (or the same method declared in sub-interfaces).</p><p>If a violation of this rule is detected by the validation engine, a <code class="classname">javax.validation.ConstraintDeclarationException</code> will be thrown. In <a class="xref" href="#example-illegal-method-constraints" title="例 8.6. Illegal parameter constraint declarations">例 8.6 “Illegal parameter constraint declarations”</a> some examples for illegal parameter constraints declarations are shown.</p><div class="example"><a id="example-illegal-method-constraints"/><p class="title"><b>例 8.6. Illegal parameter constraint declarations</b></p><div class="example-contents"><pre class="programlisting">public class Car {

    public void drive(Person driver) { ... }

}

public class RentalCar extends Car {

    //not allowed, parameter constraint added in overriding method
    public void drive(@NotNull Person driver) { ... }

}

public interface ICar {

    void drive(Person driver);

}

public class CarImpl implements ICar {

    //not allowed, parameter constraint added in implementation of interface method
    public void drive(@NotNull Person driver) { ... }

}</pre></div></div><br class="example-break"/><p>This rule only applies to parameter constraints, return value constraints may be added in sub-types without any restrictions as it is alright to strengthen the postconditions guaranteed to a type's client.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3478"/>8.3.2. Evaluating method-level constraints</h3></div></div></div><p>To validate method-level constraints Hibernate Validator provides the interface <code class="classname">org.hibernate.validator.method.MethodValidator</code>.</p><p>As shown in <a class="xref" href="#example-methodvalidator" title="例 8.7. The MethodValidator interface">例 8.7 “The MethodValidator interface”</a> this interface defines methods for the evaluation of parameter as well as return value constraints and for retrieving an extended type descriptor providing method constraint related meta data.</p><div class="example"><a id="example-methodvalidator"/><p class="title"><b>例 8.7. The <code class="classname">MethodValidator</code> interface</b></p><div class="example-contents"><pre class="programlisting">public interface MethodValidator {

    &lt;T&gt; Set&lt;MethodConstraintViolation&lt;T&gt;&gt; validateParameter(T object, Method method, Object parameterValue, int parameterIndex, Class&lt;?&gt;... groups);
    
    &lt;T&gt; Set&lt;MethodConstraintViolation&lt;T&gt;&gt; validateAllParameters(T object, Method method, Object[] parameterValues, Class&lt;?&gt;... groups);
    
    &lt;T&gt; Set&lt;MethodConstraintViolation&lt;T&gt;&gt; validateReturnValue(T object, Method method, Object returnValue, Class&lt;?&gt;... groups);
 
    TypeDescriptor getConstraintsForType(Class&lt;?&gt; clazz);
}    </pre></div></div><br class="example-break"/><p>To retrieve a method validator get hold of an instance of HV's <code class="classname">javax.validation.Validator</code> implementation and unwrap it to <code class="classname">MethodValidator</code> as shown in <a class="xref" href="#example-retrieving-methodvalidator" title="例 8.8. Retrieving a MethodValidator instance">例 8.8 “Retrieving a MethodValidator instance”</a>.</p><div class="example"><a id="example-retrieving-methodvalidator"/><p class="title"><b>例 8.8. Retrieving a <code class="classname">MethodValidator</code> instance</b></p><div class="example-contents"><pre class="programlisting">MethodValidator methodValidator = Validation.byProvider( HibernateValidator.class )
    .configure()
    .buildValidatorFactory()
    .getValidator()
    .unwrap( MethodValidator.class ); </pre></div></div><br class="example-break"/><p>The validation methods defined on <code class="classname">MethodValidator</code> each return a <code class="classname">Set&lt;MethodConstraintViolation&gt;</code>. The type <code class="classname">MethodConstraintViolation</code> (see <a class="xref" href="#example-methodconstraintviolation" title="例 8.9. The MethodConstraintViolation type">例 8.9 “The MethodConstraintViolation type”</a>) extends <code class="classname">javax.validation.ConstraintViolation</code> and provides additional method level validation specific information such as the method and index of the parameter which caused the constraint violation.</p><div class="example"><a id="example-methodconstraintviolation"/><p class="title"><b>例 8.9. The <code class="classname">MethodConstraintViolation</code> type</b></p><div class="example-contents"><pre class="programlisting">public interface MethodConstraintViolation&lt;T&gt; extends ConstraintViolation&lt;T&gt; {
    
    public static enum Kind { PARAMETER, RETURN_VALUE }

    Method getMethod();

    Integer getParameterIndex();

    String getParameterName();

    Kind getKind();
}</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>The method <code class="methodname">getParameterName()</code> currently returns synthetic parameter identifiers such as "arg0", "arg1" etc. In a future version of Hibernate Validator support for specifying parameter identifiers might be added.</p></div><p>Typically the validation of method-level constraints is not invoked manually but automatically upon method invocation by an integration layer using AOP (aspect-oriented programming) or similar method interception facilities such as the JDK's <code class="classname">java.lang.reflect.Proxy</code> API or CDI ("JSR 299: Contexts and Dependency Injection for the Java<sup>TM</sup> EE platform").</p><p>If a parameter or return value constraint can't be validated sucessfully such an integration layer typically will throw a <code class="classname">MethodConstraintViolationException</code> which similar to <code class="classname">javax.validation.ConstraintViolationException</code> contains a set with the occurred constraint violations.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>If you are using CDI you might be interested in the <a class="ulink" href="http://seamframework.org/Seam3/ValidationModule">Seam Validation</a> project. This Seam module provides an interceptor which integrates the method validation functionality with CDI.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3568"/>8.3.3. Retrieving method-level constraint meta data</h3></div></div></div><p>As outlined in <a class="xref" href="#validator-metadata-api" title="第 6 章 Metadata API">第 6 章 <i>Metadata API</i></a> the Bean Validation API provides rich capabilities for retrieving constraint related meta data. Hibernate Validator extends this API and allows to retrieve constraint meta data also for method-level constraints.</p><p><a class="xref" href="#example-method-level-meta-data" title="例 8.10. Retrieving meta data for method-level constraints">例 8.10 “Retrieving meta data for method-level constraints”</a> shows how to use this extended API to retrieve constraint meta data for the <code class="methodname">rentCar()</code> method from the <code class="classname">RentalStation</code> type.</p><div class="example"><a id="example-method-level-meta-data"/><p class="title"><b>例 8.10. Retrieving meta data for method-level constraints</b></p><div class="example-contents"><pre class="programlisting">TypeDescriptor typeDescriptor = methodValidator.getConstraintsForType(RentalStation.class)

//retrieve a descriptor for the rentCar() method
MethodDescriptor rentCarMethod = typeDescriptor.getConstraintsForMethod("rentCar", Customer.class, Date.class, int.class);
assertEquals(rentCarMethod.getMethodName(), "rentCar");
assertTrue(rentCarMethod.hasConstraints());
assertFalse(rentCarMethod.isCascaded());

//retrieve constraints from the return value
Set&lt;ConstraintDescriptor&lt;?&gt;&gt; returnValueConstraints = rentCarMethod.findConstraints().getConstraintDescriptors();
assertEquals(returnValueConstraints.size(), 1);
assertEquals(returnValueConstraints.iterator().next().getAnnotation().annotationType(), NotNull.class);

List&lt;ParameterDescriptor&gt; allParameters = rentCarMethod.getParameterDescriptors();
assertEquals(allParameters.size(), 3);

//retrieve a descriptor for the startDate parameter
ParameterDescriptor startDateParameter = allParameters.get(1);
assertEquals(startDateParameter.getIndex(), 1);
assertFalse(startDateParameter.isCascaded());
assertEquals(startDateParameter.findConstraints().getConstraintDescriptors().size(), 2);</pre></div></div><br class="example-break"/><p>Refer to the <a class="ulink" href="http://docs.jboss.org/hibernate/validator/4.2/api/index.html?org/hibernate/validator/method/metadata/package-summary.html">JavaDoc</a> of the package <code class="classname">org.hibernate.validator.method.metadata</code> for more details on the extended meta data API.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="programmaticapi"/>8.4. Programmatic constraint definition</h2></div></div></div><p>Another addition to the Bean Validation specification is the ability to configure constraints via a fluent API. This API can be used exclusively or in combination with annotations and xml. If used in combination programmatic constraints are additive to constraints configured via the standard configuration capabilities.</p><p>The API is centered around the <code class="classname">ConstraintMapping</code> class which can be found in the package<span class="package"> org.hibernate.validator.cfg</span>. Starting with the instantiation of a new <code class="classname">ConstraintMapping</code>, constraints can be defined in a fluent manner as shown in <a class="xref" href="#example-constraint-mapping" title="例 8.11. Programmatic constraint definition">例 8.11 “Programmatic constraint definition”</a>.</p><div class="example"><a id="example-constraint-mapping"/><p class="title"><b>例 8.11. Programmatic constraint definition</b></p><div class="example-contents"><pre class="programlisting">ConstraintMapping mapping = new ConstraintMapping();
mapping.type( Car.class )
    .property( "manufacturer", FIELD )
        .constraint( new NotNullDef() )
    .property( "licensePlate", FIELD )
        .constraint( new NotNullDef() )
        .constraint( new SizeDef().min( 2 ).max( 14 ) )
    .property( "seatCount", FIELD )
        .constraint( new MinDef()value ( 2 ) )
.type( RentalCar.class )
    .property( "rentalStation", METHOD )
        .constraint( new NotNullDef() );      </pre></div></div><p><br class="example-break"/></p><p>As you can see constraints can be configured on multiple classes and properties using method chaining. The constraint definition classes <code class="classname">NotNullDef</code>, <code class="classname">SizeDef</code> and <code class="classname">MinDef</code> are helper classes which allow to configure constraint parameters in a type-safe fashion. Definition classes exist for all built-in constraints in the <code class="classname">org.hibernate.validator.cfg.defs</code> package.</p><p>For custom constraints you can either create your own definition classes extending <code class="classname">ConstraintDef</code> or you can use <code class="classname">GenericConstraintDef</code> as seen in <a class="xref" href="#example-generic-constraint-mapping" title="例 8.12. Programmatic constraint definition using createGeneric()">例 8.12 “Programmatic constraint definition using createGeneric()”</a>.</p><div class="example"><a id="example-generic-constraint-mapping"/><p class="title"><b>例 8.12. Programmatic constraint definition using <code class="methodname">createGeneric()</code></b></p><div class="example-contents"><pre class="programlisting">ConstraintMapping mapping = new ConstraintMapping();
mapping.type( Car.class )
    .property( "licensePlate", FIELD )
        .constraint( new GenericConstraintDef&lt;CheckCase.class&gt;( CheckCase.class ).param( "value", CaseMode.UPPER ) );   </pre></div></div><p><br class="example-break"/></p><p>Not only standard class- and property-level constraints but also method constraints can be configured using the API. As shown in <a class="xref" href="#example-method-constraint-mapping" title="例 8.13. Programmatic definition of method constraints">例 8.13 “Programmatic definition of method constraints”</a> methods are identified by their name and their parameters (if there are any). Having selected a method, constraints can be placed on the method's parameters and/or return value.</p><div class="example"><a id="example-method-constraint-mapping"/><p class="title"><b>例 8.13. Programmatic definition of method constraints</b></p><div class="example-contents"><pre class="programlisting">ConstraintMapping mapping = new ConstraintMapping();
mapping.type( Car.class )
    .method( "drive", String.class, Integer.class )
        .parameter( 0 )
            .constraint( new NotNullDef() )
            .constraint( new MinDef().value ( 1 ) )
        .parameter( 1 )
            .constraint( new NotNullDef() )
        .returnValue()
            .constraint( new NotNullDef() )
    .method( "check" )
        .returnValue()
            .constraint( new NotNullDef() );      </pre></div></div><br class="example-break"/><p>Using the API it's also possible to mark properties, method parameters and method return values as cascading (equivalent to annotating them with <code class="classname">@Valid</code>). An example can be found in <a class="xref" href="#example-cascading-constraints" title="例 8.14. Marking constraints for cascaded validation">例 8.14 “Marking constraints for cascaded validation”</a>.</p><div class="example"><a id="example-cascading-constraints"/><p class="title"><b>例 8.14. Marking constraints for cascaded validation</b></p><div class="example-contents"><pre class="programlisting">ConstraintMapping mapping = new ConstraintMapping();
mapping.type( Car.class )
    .property( "manufacturer", FIELD )
        .valid()
    .property( "licensePlate", METHOD )
        .valid()
    .method( "drive", String.class, Integer.class )
        .parameter( 0 )
            .valid()
        .parameter( 1 )
            .valid()
        .returnValue()
            .valid()
.type( RentalCar.class )
    .property( "rentalStation", METHOD )
        .valid();</pre></div></div><p><br class="example-break"/></p><p>Last but not least you can configure the default group sequence or the default group sequence provider of a type as shown in <a class="xref" href="#example-sequences" title="例 8.15. Configuration of default group sequence and default group sequence provider">例 8.15 “Configuration of default group sequence and default group sequence provider”</a>.</p><div class="example"><a id="example-sequences"/><p class="title"><b>例 8.15. Configuration of default group sequence and default group sequence provider</b></p><div class="example-contents"><pre class="programlisting">ConstraintMapping mapping = new ConstraintMapping();
mapping.type( Car.class )
    .defaultGroupSequence( Car.class, CarChecks.class )
.type( RentalCar.class )
    .defaultGroupSequenceProvider( RentalCarGroupSequenceProvider.class ); </pre></div></div><p><br class="example-break"/></p><p>Once a <code class="classname">ConstraintMapping</code> is set up it has to be passed to the configuration. Since the programmatic API is not part of the official Bean Validation specification you need to get hold of a <code class="classname">HibernateValidatorConfiguration</code> instance as shown in <a class="xref" href="#example-hibernate-specific-config" title="例 8.16. Creating a Hibernate Validator specific configuration">例 8.16 “Creating a Hibernate Validator specific configuration”</a>.</p><div class="example"><a id="example-hibernate-specific-config"/><p class="title"><b>例 8.16. Creating a Hibernate Validator specific configuration</b></p><div class="example-contents"><pre class="programlisting">ConstraintMapping mapping = new ConstraintMapping();
// configure mapping instance

HibernateValidatorConfiguration config = Validation.byProvider( HibernateValidator.class ).configure();
config.addMapping( mapping );
ValidatorFactory factory = config.buildValidatorFactory();
Validator validator = factory.getValidator();</pre></div></div><p><br class="example-break"/></p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3700"/>8.5. Boolean composition for constraint composition</h2></div></div></div><p>As per Bean Validation specification the constraints of a composed constraint (see <a class="xref" href="#section-constraint-composition">第 3.2 节 “约束条件组合”</a>) are all combined via a logical <span class="emphasis"><em>AND</em></span>. This means all of the composing constraints need to return <code class="constant">true</code> in order for an overall successful validation. Hibernate Validator offers an extension to this logical <span class="emphasis"><em>AND</em></span> combination which allows you to compose constraints via a logical <span class="emphasis"><em>OR</em></span> or <span class="emphasis"><em>NOT</em></span>. To do so you have to use the <code class="classname">ConstraintComposition</code> annotation and the enum <code class="classname">CompositionType</code> with its values <span class="emphasis"><em>AND</em></span>, <span class="emphasis"><em>OR</em></span> and <span class="emphasis"><em>ALL_FALSE</em></span>. <a class="xref" href="#example-boolean-constraint-composition" title="例 8.17. OR composition of constraints">例 8.17 “OR composition of constraints”</a> shows how to build a composing constraint where only one of the constraints has to be successful in order to pass the validation. Either the validated string is all lowercased or it is between two and three characters long.</p><div class="example"><a id="example-boolean-constraint-composition"/><p class="title"><b>例 8.17. OR composition of constraints</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA">@ConstraintComposition(OR)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Pattern</span><span class="java_separator">(</span><span class="java_plain">regexp&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;[a-z]&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Size</span><span class="java_separator">(</span><span class="java_plain">min&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">,</span><span class="java_plain">&nbsp;max&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">3</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">ReportAsSingleViolation</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">({</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Constraint</span><span class="java_separator">(</span><span class="java_plain">validatedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">PatternOrSize</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">abstract</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;message</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{PatternOrSize.message}&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">abstract</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;groups</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">};</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">abstract</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Payload</span><span class="java_operator">&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;payload</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">};</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>Using <span class="emphasis"><em>ALL_FALSE</em></span> as composition type implicitly enforces that only a single violation will get reported in case validation of the constraint composition fails.</p></div></div></div><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-annotation-processor"/>第 9 章 Annotation Processor</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#validator-annotationprocessor-prerequisites">9.1. 前提条件</a></span></dt><dt><span class="section"><a href="#validator-annotationprocessor-features">9.2. 特性</a></span></dt><dt><span class="section"><a href="#validator-annotationprocessor-options">9.3. 配置项</a></span></dt><dt><span class="section"><a href="#validator-annotationprocessor-usage">9.4. 使用标注处理器</a></span></dt><dd><dl><dt><span class="section"><a href="#validator-annotationprocessor-commandline">9.4.1. 命令行编译</a></span></dt><dt><span class="section"><a href="#validator-annotationprocessor-ide">9.4.2. IDE集成</a></span></dt></dl></dd><dt><span class="section"><a href="#validator-annotationprocessor-known-issues">9.5. 已知问题</a></span></dt></dl></div><p>你碰到过下面这些让人抓狂的情况么:</p><div class="itemizedlist"><ul><li><p>specifying constraint annotations at unsupported data types (e.g. by annotating a String with @Past)</p></li><li><p>对一个JavaBean的setter方法进行标注(而不是getter)</p></li><li><p>对一个静态的变量或者方法进行约束条件标注(这样是不支持滴)</p></li></ul></div><p>这样的话, 你就应该看看Hibernate Validator 的约束处理器了. 它会被插入到编译过程中, 然后如果发现如果哪个约束标注用错了的话, 则汇报编译错误.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>You can find the Hibernate Validator Annotation Processor as part of the distribution bundle on <a class="ulink" href="http://sourceforge.net/projects/hibernate/files/hibernate-validator">Sourceforge</a> or in the JBoss Maven Repository (see <a class="xref" href="#">???</a>) under the GAV org.hibernate:hibernate-validator-annotation-processor.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-annotationprocessor-prerequisites"/>9.1. 前提条件</h2></div></div></div><p>The Hibernate Validator Annotation Processor is based on the "Pluggable Annotation Processing API" as defined by <a class="ulink" href="http://jcp.org/en/jsr/detail?id=269">JSR 269</a> which is part of the Java Platform since Java 6.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-annotationprocessor-features"/>9.2. 特性</h2></div></div></div><p>As of Hibernate Validator 5.0.0.Final the Hibernate Validator Annotation Processor checks that:</p><div class="itemizedlist"><ul><li><p>应用了约束标注的属性的类型是否被该约束所支持</p></li><li><p>only non-static fields or methods are annotated with constraint annotations</p></li><li><p>only non-primitive fields or methods are annotated with @Valid</p></li><li><p>only such methods are annotated with constraint annotations which are valid JavaBeans getter methods (optionally, see below)</p></li><li><p>only such annotation types are annotated with constraint annotations which are constraint annotations themselves</p></li><li><p>definition of dynamic default group sequence with @GroupSequenceProvider is valid</p></li></ul></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-annotationprocessor-options"/>9.3. 配置项</h2></div></div></div><p>Hibernate Validator标注处理器的行为可以通过<a class="xref" href="#table_processor_options" title="表 9.1. Hibernate Validator 标注处理器配置项">表 9.1 “Hibernate Validator 标注处理器配置项”</a>中列出的<a class="ulink" href="http://java.sun.com/javase/6/docs/technotes/tools/windows/javac.html#options">处理器配置项</a>加以控制.</p><div class="table"><a id="table_processor_options"/><p class="title"><b>表 9.1. Hibernate Validator 标注处理器配置项</b></p><div class="table-contents"><table summary="Hibernate Validator 标注处理器配置项" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center">配置项</th><th align="center">功能</th></tr></thead><tbody><tr><td><code class="varname">diagnosticKind</code></td><td>控制编译错误级别. 必须是枚举类型<code class="classname">javax.tools.Diagnostic.Kind</code>中的值(字符串形式), 例如<code class="classname">WARNING</code>. 如果是<code class="classname">ERROR</code>的话, 那么如果API检测到约束信息应用的错误的话, 会让编译过程终止, 默认是<code class="classname">ERROR</code>.</td></tr><tr><td><code class="varname">methodConstraintsSupported</code></td><td>Controls whether constraints are allowed at methods of any kind. Must be set to <code class="varname">true</code> when working with method level constraints as supported by Hibernate Validator. Can be set to <code class="varname">false</code> to allow constraints only at JavaBeans getter methods as defined by the Bean Validation API. Defaults to <code class="varname">true</code>.</td></tr><tr><td><code class="varname">verbose</code></td><td>Controls whether detailed processing information shall be displayed or not, useful for debugging purposes. Must be either <code class="varname">true</code> or <code class="varname">false</code>. Defaults to <code class="varname">false</code>.</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-annotationprocessor-usage"/>9.4. 使用标注处理器</h2></div></div></div><p>本小节详细介绍了如何把Hibernate Validator标注处理器与命令行编译(javac, Ant, Maven)以及IDE (Eclipse, IntelliJ IDEA, NetBeans)集成.</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-annotationprocessor-commandline"/>9.4.1. 命令行编译</h3></div></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="validator-annotationprocessor-javac"/>9.4.1.1. javac</h4></div></div></div><p>When compiling on the command line using <a class="ulink" href="http://java.sun.com/javase/6/docs/technotes/guides/javac/index.html">javac</a>, specify the JAR hibernate-validator-annotation-processor-5.0.0.Final.jar using the "processorpath" option as shown in the following listing. The processor will be detected automatically by the compiler and invoked during compilation.</p><div class="example"><a id="d0e3895"/><p class="title"><b>例 9.1. 在javac中使用标注处理器</b></p><div class="example-contents"><pre class="programlisting">javac src/main/java/org/hibernate/validator/ap/demo/Car.java \
   -cp /path/to/validation-api-1.1.0.CR3.jar \
   -processorpath /path/to/hibernate-validator-annotation-processor-5.0.0.Final.jar</pre></div></div><br class="example-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="validator-annotationprocessor-ant"/>9.4.1.2. Apache Ant</h4></div></div></div><p>和直接使用javac差不多, 可以在<a class="ulink" href="http://ant.apache.org/">Apache Ant</a>的<a class="ulink" href="http://ant.apache.org/manual/CoreTasks/javac.html">javac task</a>中添加上面例子中的参数:</p><div class="example"><a id="d0e3911"/><p class="title"><b>例 9.2. 在Ant中使用标注处理器</b></p><div class="example-contents"><pre class="programlisting">&lt;javac srcdir="src/main"
       destdir="build/classes"
       classpath="/path/to/validation-api-1.1.0.CR3.jar"&gt;
       &lt;compilerarg value="-processorpath" /&gt;
       &lt;compilerarg value="/path/to/hibernate-validator-annotation-processor-5.0.0.Final.jar"/&gt;
&lt;/javac&gt;</pre></div></div><br class="example-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3916"/>9.4.1.3. Maven</h4></div></div></div><p>对于和<a class="ulink" href="http://maven.apache.org/">Apache Maven</a>集成来说我们有很多选择, 通常, 我们可以把Hibenrate Validator标注处理器作为依赖添加到你的项目当中:</p><div class="example"><a id="d0e3924"/><p class="title"><b>例 9.3. 添加HV 标注处理器为依赖</b></p><div class="example-contents"><pre class="programlisting">...
&lt;dependency&gt;
    &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
    &lt;artifactId&gt;hibernate-validator-annotation-processor&lt;/artifactId&gt;
    &lt;version&gt;5.0.0.Final&lt;/version&gt;
    &lt;scope&gt;compile&lt;/scope&gt;
&lt;/dependency&gt;
...        </pre></div></div><br class="example-break"/><p>这样, 这个处理器就能够自动的被编译器所调用. 虽然基本上能工作,但是还是有一些缺点, 在某些情况下, 标注处理器的输出信息可能不能够被显示出来. (请参考<a class="ulink" href="http://jira.codehaus.org/browse/MCOMPILER-66">MCOMPILER-66</a>).</p><p>另外的一个选择是使用<a class="ulink" href="http://code.google.com/p/maven-annotation-plugin/">Maven Annotation Plugin</a>. 不过在此文档撰写的时候, 这个插件还没有被上传到任何一个广泛被使用的仓库中. 所以, 你需要自己把这个插件自己的仓库添加到你的settings.xml 或 pom.xml中:</p><div class="example"><a id="d0e3939"/><p class="title"><b>例 9.4. 添加Maven Annotation Plugin的仓库</b></p><div class="example-contents"><pre class="programlisting">...
&lt;pluginRepositories&gt;
    &lt;pluginRepository&gt;
        &lt;id&gt;maven-annotation-plugin-repo&lt;/id&gt;
        &lt;url&gt;http://maven-annotation-plugin.googlecode.com/svn/trunk/mavenrepo&lt;/url&gt;
    &lt;/pluginRepository&gt;
&lt;/pluginRepositories&gt;
...                      </pre></div></div><br class="example-break"/><p>现在, 禁用compiler插件所调用的标准的标注处理过程, 然后再通过定义一个execution来配置annotation plugin的运行, 还需要把Hibernate Validator标注处理器作为该插件的依赖添加进去(这样, 此标注处理器就不会被当成你的项目的依赖而出现在类路径中了):</p><div class="example"><a id="d0e3946"/><p class="title"><b>例 9.5. 配置Maven Annotation Plugin</b></p><div class="example-contents"><pre class="programlisting">...
&lt;plugin&gt;
    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
        &lt;source&gt;1.6&lt;/source&gt;
        &lt;target&gt;1.6&lt;/target&gt;
        &lt;compilerArgument&gt;-proc:none&lt;/compilerArgument&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
&lt;plugin&gt;
    &lt;groupId&gt;org.bsc.maven&lt;/groupId&gt;
    &lt;artifactId&gt;maven-processor-plugin&lt;/artifactId&gt;
    &lt;version&gt;1.3.4&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;process&lt;/id&gt;
            &lt;goals&gt;
                &lt;goal&gt;process&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;phase&gt;process-sources&lt;/phase&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
            &lt;artifactId&gt;hibernate-validator-annotation-processor&lt;/artifactId&gt;
            &lt;version&gt;5.0.0.Final&lt;/version&gt;
            &lt;scope&gt;compile&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/plugin&gt;
...
                    </pre></div></div><br class="example-break"/></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-annotationprocessor-ide"/>9.4.2. IDE集成</h3></div></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3954"/>9.4.2.1. Eclipse</h4></div></div></div><p>请参考以下步骤来在<a class="ulink" href="http://www.eclipse.org/">Eclipse</a>中使用标注处理器:</p><div class="itemizedlist"><ul><li><p>右键点击你的项目, 然后选择"属性"</p></li><li><p>在"Java Compiler"页面确认"编译级别"设置的是"1.6". 否则的话是无法使用标注处理器的.</p></li><li><p>到"Java Compiler"下面的"Annotation Processing" 页面, 然后选择"启用标注处理"(译注: 我的电脑是英文版的, 所以真的不知道中文版的eclipse上, 这些翻译成了什么:(</p></li><li><p>Go to "Java Compiler - Annotation Processing - Factory Path" and add the JAR hibernate-validator-annotation-processor-5.0.0.Final.jar</p></li><li><p>确认工作空间重新编译</p></li></ul></div><p>现在你应该能够看到所有的标注错误都在编辑窗口中显示出了错误标记,也都显示在了"问题"视图:</p><div class="mediaobject" align="center"><img src="annotation_processor_eclipse.png" align="middle"/></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="validator-annotationprocessor-idea"/>9.4.2.2. IntelliJ IDEA</h4></div></div></div><p>请参考以下步骤来在<a class="ulink" href="http://www.jetbrains.com/idea/">IntelliJ IDEA</a> (9.0及以上):中使用标注处理器:</p><div class="itemizedlist"><ul><li><p>选择 "File", 然后 "Settings",</p></li><li><p>展开"Compiler"节点, 然后点击"Annotation Processors"</p></li><li><p>Choose "Enable annotation processing" and enter the following as "Processor path": /path/to/hibernate-validator-annotation-processor-5.0.0.Final.jar</p></li><li><p>添加处理器的全路径名称<code class="classname">org.hibernate.validator.ap.ConstraintValidationProcessor</code>到"Annotation Processors"列表</p></li><li><p>如果需要的话, 添加你的模块到"Processed Modules"列表</p></li></ul></div><p>重新编译你的项目, 然后应该能看到关于约束标注的错误信息了:</p><div class="mediaobject" align="center"><img src="annotation_processor_intellij.png" align="middle"/></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="validator-annotationprocessor-netbeans"/>9.4.2.3. NetBeans</h4></div></div></div><p>从6.9这个版本开始, <a class="ulink" href="http://www.netbeans.org/">NetBeans</a>也支持标注处理了. 可以通过下面的步骤来启用它:</p><div class="itemizedlist"><ul><li><p>右键点击你的项目, 然后选择"属性"</p></li><li><p>Go to "Libraries", tab "Processor", and add the JAR hibernate-validator-annotation-processor-5.0.0.Final.jar</p></li><li><p>到"Build - Compiling"页面选中"Enable Annotation Processing" 和 "Enable Annotation Processing in Editor", 并且指定标注处理器的全路径名称<code class="classname">org.hibernate.validator.ap.ConstraintValidationProcessor</code>.</p></li></ul></div><p>所有的约束标注问题应该都会在编辑器里面直接被标记出来了:</p><div class="mediaobject" align="center"><img src="annotation_processor_netbeans.png" align="middle"/></div></div></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-annotationprocessor-known-issues"/>9.5. 已知问题</h2></div></div></div><p>以下是截止到2010年五月我们发现(但尚未解决)的问题:</p><div class="itemizedlist"><ul><li><p><a class="ulink" href="http://opensource.atlassian.com/projects/hibernate/browse/HV-308">HV-308</a>: Additional validators registered for a constraint <a class="ulink" href="http://docs.jboss.org/hibernate/stable/validator/reference/en/html_single/#d0e1957">using XML</a> are not evaluated by the annotation processor.</p></li><li><p>有时候, 在eclipse里面自定义的约束条件不能够被<a class="ulink" href="http://opensource.atlassian.com/projects/hibernate/browse/HV-293">正确的检查</a>. 清理这个项目可能会有帮助. 这可能是因为Eclipse中对 JSR 269 API的实现有问题, 但是还需要进一步的研究.</p></li><li><p>When using the processor within Eclipse, the check of dynamic default group sequence definitions doesn't work. After further investigation, it seems to be an issue with the Eclipse JSR 269 API implementation.</p></li></ul></div></div></div><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-further-reading"/>第 10 章 进一步阅读</h2></div></div></div><p>Last but not least, a few pointers to further information.</p><p>A great source for examples is the Bean Validation TCK which is available for anonymous access on <a class="ulink" href="https://github.com/beanvalidation/beanvalidation-tck">GitHub</a>. In particular the TCK's <a class="ulink" href="https://github.com/beanvalidation/beanvalidation-tck/tree/master/src/main/java/org/hibernate/beanvalidation/tck/tests">tests</a> might be of interest. <a class="ulink" href="http://jcp.org/en/jsr/detail?id=303">The JSR 303</a> specification itself is also a great way to deepen your understanding of Bean Validation resp. Hibernate Validator.</p><p>如果你还有什么关于Hibernate Validator的问题或者想和我们分享你的使用经验,请使用<a class="ulink" href="http://community.jboss.org/en/hibernate/validator">Hibernate Validator Wiki</a>或者去<a class="ulink" href="https://forum.hibernate.org/viewforum.php?f=9">Hibernate Validator Forum</a>发帖子(译注:但是不要灌水:-D).</p><p>如果你发现了Hibernate Validator的bug,请在<a class="ulink" href="http://opensource.atlassian.com/projects/hibernate/browse/HV">Hibernate's Jira</a>中报告, 我们非常欢迎您的反馈!</p></div></div><HR xmlns=""/><a xmlns="" href=""><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">版权 © 2009 - 2013 Red Hat, Inc. &amp; Gunnar Morling</p></a></body></html>