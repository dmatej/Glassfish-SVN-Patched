<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">第 7 章 与其他框架集成</title><link rel="stylesheet" href="css/hibernate.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="Hibernate Validator"/><link rel="up" href="index.html" title="Hibernate Validator"/><link rel="prev" href="validator-metadata-api.html" title="第 6 章 Metadata API"/><link rel="next" href="validator-specifics.html" title="第 8 章 Hibernate Validator Specifics"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="validator-metadata-api.html"><strong>上一页</strong></a></li><li class="next"><a accesskey="n" href="validator-specifics.html"><strong>下一页</strong></a></li></ul><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-integration"/>第 7 章 与其他框架集成</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="validator-integration.html#validator-osgi">7.1. OSGi</a></span></dt><dt><span class="section"><a href="validator-integration.html#validator-checkconstraints-db">7.2. 与数据库集成校验</a></span></dt><dt><span class="section"><a href="validator-integration.html#validator-checkconstraints-orm">7.3. ORM集成</a></span></dt><dd><dl><dt><span class="section"><a href="validator-integration.html#validator-checkconstraints-orm-hibernateevent">7.3.1. 基于Hibernate事件模型的校验</a></span></dt><dt><span class="section"><a href="validator-integration.html#d0e3095">7.3.2. JPA</a></span></dt></dl></dd><dt><span class="section"><a href="validator-integration.html#section-presentation-layer">7.4. 展示层校验</a></span></dt></dl></div><p>Hibernate Validator 的设计初衷是在一个分层的应用程序中, 约束信息只需要被定义一次( 通过在领域模型上标注), 然后在不同的层中进行数据校验.</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-osgi"/>7.1. OSGi</h2></div></div></div><p>The Hibernate Validator jar file is conform to the OSGi specification and can be used within any OSGi container. The following lists represent the packages imported and exported by Hibernate Validator. The classes within the exported packages are considered part of Hibernate Validator public API.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>The Java Service Provider mechanism used by Bean Validation to automatically discover validation providers doesn't work in an OSGi environment. To solve this, you have to provide a custom <code class="classname">ValidationProviderResolver</code>. See <a class="xref" href="validator-bootstrapping.html#section-validation-provider-resolver" title="5.2. ValidationProviderResolver">第 5.2 节 “ValidationProviderResolver”</a></p></div><div class="itemizedlist"><p class="title"><b>Exported packages</b></p><ul><li><p><span class="package">org.hibernate.validator</span></p></li><li><p><span class="package">org.hibernate.validator.cfg.*</span></p></li><li><p><span class="package">org.hibernate.validator.constraints.*</span></p></li><li><p><span class="package">org.hibernate.validator.group</span></p></li><li><p><span class="package">org.hibernate.validator.messageinterpolation</span></p></li><li><p><span class="package">org.hibernate.validator.resourceloading</span></p></li><li><p><span class="package">org.hibernate.validator.spi.*</span></p></li></ul></div><div class="itemizedlist"><p class="title"><b>Imported packages</b></p><ul><li><p><span class="package">javax.persistence.*</span>, [2.0.0,3.0.0), optional</p></li><li><p><span class="package">javax.validation.*</span>, [1.0.0,2.0.0)</p></li><li><p><span class="package">javax.xml.*</span></p></li><li><p><span class="package">javax.el.*</span>, [2.0.0,4.0.0)</p></li><li><p><span class="package">org.xml.sax.*</span></p></li><li><p><span class="package">org.jboss.logging.*</span>, [3.1.0,4.0.0)</p></li><li><p><span class="package">com.fasterxml.classmate.*</span>, 0.8.0</p></li><li><p><span class="package">org.joda.time.*</span>, [1.6.0,2.0.0), optional</p></li><li><p><span class="package">org.jsoup.*</span>, [1.5.2,2.0.0), optional</p></li></ul></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-checkconstraints-db"/>7.2. 与数据库集成校验</h2></div></div></div><p>Hibernate Annotations (即 Hibernate 3.5.x) 会自动的把你定已在实体模型上的约束信息添加到其映射信息中. 例如, 假设你的一个实体类的属性上有<code class="literal">@NotNull</code>的约束的话, 那么Hibernate在生成创建此实体对应的表的DDL的时候, 会自动的给那个属性对应的字段添加上<code class="literal">not null</code>.</p><p>If, for some reason, the feature needs to be disabled, set <code class="literal">hibernate.validator.apply_to_ddl</code> to <code class="literal">false</code>. See also <a class="xref" href="validator-usingvalidator.html#table-spec-constraints" title="表 2.2. Bean Validation constraints">表 2.2 “Bean Validation constraints”</a> and <a class="xref" href="validator-usingvalidator.html#table-custom-constraints" title="表 2.3. Custom constraints">表 2.3 “Custom constraints”</a>.</p><p>你也可以限制这个DDL约束自动生成的特性只应用到一部分实体类. 只需要设置<span class="property">org.hibernate.validator.group.ddl</span>属性, 这个属性的值是你想要应用此特性的实体类的全路径名称, 每个以逗号分隔.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-checkconstraints-orm"/>7.3. ORM集成</h2></div></div></div><p>Hibernate Validator不仅能够和Hibernate集成工作, 还能够和任何JPA的实现很好的一起工作.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>When lazy loaded associations are supposed to be validated it is recommended to place the constraint on the getter of the association. Hibernate replaces lazy loaded associations with proxy instances which get initialized/loaded when requested via the getter. If, in such a case, the constraint is placed on field level the actual proxy instance is used which will lead to validation errors.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-checkconstraints-orm-hibernateevent"/>7.3.1. 基于Hibernate事件模型的校验</h3></div></div></div><p>Hibernate Annotations (即 Hibernate 3.5.x) 中包含了一个的Hibernate 事件监听器(译注: 请阅读Hibernate Core文档了解Hibernate的事件模型) - <a class="ulink" href="http://fisheye.jboss.org/browse/Hibernate/core/trunk/annotations/src/main/java/org/hibernate/cfg/beanvalidation/BeanValidationEventListener.java"><code class="classname">org.hibernate.cfg.beanvalidation.BeanValidationEventListener</code></a> - 来为Hibernate Validator服务. 当一个<code class="literal">PreInsertEvent</code>, <code class="literal">PreUpdateEvent</code> 或 <code class="classname">PreDeleteEvent</code>事件发生的时候, 这个监听器就可以对该事件所涉及到的实体对象进行校验, 如果校验不通过的话, 则抛出异常. 默认情况下, Hibernate在对每个对象进行保存或者修改操作的时候,都会对其进行校验, 而删除操作则不会. 你可以通过<span class="property">javax.persistence.validation.group.pre-persist</span>, <span class="property">javax.persistence.validation.group.pre-update</span> 和 <span class="property">javax.persistence.validation.group.pre-remove</span>属性来定义对应事件发生的时候, 具体要校验哪(些)个校验组, 这个属性的值是要应用的校验组类的全路径, 使用逗号分隔. <a class="xref" href="validator-integration.html#example-beanvalidationeventlistener-config" title="例 7.1. 自定义BeanValidationEvenListener">例 7.1 “自定义BeanValidationEvenListener”</a>显示了这几个属性在Hibernate内部定义的默认值, 所以, 你不需要在你的应用中再重复定义了.</p><p>如果发生了违反约束条件的情况, 该监听器会抛出一个运行时的<code class="classname">ConstraintViolationException</code>异常, 此异常包含了一系列的<code class="literal">ConstraintViolation</code>对象用于描述每个违反了约束条件的情况.</p><p>如果类路径上有Hibernate Validator, 则Hibernate Annotations (或 Hibernate EntityManager)会自动调用它, 如果你想避免这种情况, 可以设置<span class="property">javax.persistence.validation.mode</span>属性为<code class="constant">none</code>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>注意</h2><p>如果实体模型上没有定义约束条件, 则不会有任何性能损耗.</p></div><p>如果你想在Hibernate Core中使用上面提到的事件监听器, 则可以在<code class="literal">hibernate.cfg.xml</code>中定义如下的配置信息:</p><div class="example"><a id="example-beanvalidationeventlistener-config"/><p class="title"><b>例 7.1. 自定义<code class="classname">BeanValidationEvenListener</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">hibernate-configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">session-factory</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.persistence.validation.group.pre-persist&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">javax.validation.groups.Default</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.persistence.validation.group.pre-update&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">javax.validation.groups.Default</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.persistence.validation.group.pre-remove&quot;</span><span class="xml_tag_symbols">&gt;&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">event</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;pre-update&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">listener</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.cfg.beanvalidation.BeanValidationEventListener&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">event</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">event</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;pre-insert&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">listener</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.cfg.beanvalidation.BeanValidationEventListener&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">event</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">event</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;pre-delete&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">listener</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.cfg.beanvalidation.BeanValidationEventListener&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">event</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">session-factory</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">hibernate-configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3095"/>7.3.2. JPA</h3></div></div></div><p>If you are using JPA 2 and Hibernate Validator is in the classpath the JPA2 specification requires that Bean Validation gets enabled. The properties <span class="property">javax.persistence.validation.group.pre-persist</span>, <span class="property">javax.persistence.validation.group.pre-update</span> and <span class="property">javax.persistence.validation.group.pre-remove</span> as described in <a class="xref" href="validator-integration.html#validator-checkconstraints-orm-hibernateevent" title="7.3.1. 基于Hibernate事件模型的校验">第 7.3.1 节 “基于Hibernate事件模型的校验”</a> can in this case be configured in <code class="filename">persistence.xml</code>. <code class="filename">persistence.xml</code> also defines a node validation-mode which can be set to <code class="constant">AUTO</code>, <code class="constant">CALLBACK</code>, <code class="constant">NONE</code>. The default is <code class="constant">AUTO</code>.</p><p>对于JPA1来讲, 你需要自己创建和注册Hibernate Validator. 如果你是使用Hibernate EntityManager, 那么你可以把<a class="xref" href="validator-integration.html#validator-checkconstraints-orm-hibernateevent" title="7.3.1. 基于Hibernate事件模型的校验">第 7.3.1 节 “基于Hibernate事件模型的校验”</a>中列出来的<code class="classname">BeanValidationEventListener</code>类添加到你的项目中, 然后再手工注册它.</p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="section-presentation-layer"/>7.4. 展示层校验</h2></div></div></div><p>如果你正在使用JSF2或者<span class="productname">JBoss Seam</span>™,并且Hibernate Validator (Bean Validation) 在类路径上的话, 那么界面上的字段可以被自动校验. <a class="xref" href="validator-integration.html#example-jsf2" title="例 7.2. 在JSF2中使用Bean Validation">例 7.2 “在JSF2中使用Bean Validation”</a>显示了一个在JSF页面上使用f:validateBean标签的实例. 更多的信息请参考Seam的文档或者JSF2规范.</p><div class="example"><a id="example-jsf2"/><p class="title"><b>例 7.2. 在JSF2中使用Bean Validation</b></p><div class="example-contents"><pre class="programlisting">&lt;h:form&gt;
  <span class="bold"><strong>&lt;f:validateBean&gt;</strong></span>
    &lt;h:inputText value=”#{model.property}” /&gt;
    &lt;h:selectOneRadio value=”#{model.radioProperty}” &gt; ... &lt;/h:selectOneRadio&gt;
    &lt;!-- other input components here --&gt;
  <span class="bold"><strong>&lt;/f:validateBean&gt;</strong></span>
&lt;/h:form&gt;
</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>The integration between JSF 2 and Bean Validation is described in the "Bean Validation Integration" chapter of <a class="ulink" href="http://jcp.org/en/jsr/detail?id=314">JSR-314</a>. It is interesting to know that JSF 2 implements a custom MessageInterpolator to ensure ensure proper localization. To encourage the use of the Bean Validation message facility, JSF 2 will per default only display the generated Bean Validation message. This can, however, be configured via the application resource bundle by providing the following configuration (<em class="parameter"><code>{0}</code></em> is replaced with the Bean Validation message and <em class="parameter"><code>{1}</code></em> is replaced with the JSF component label):</p><pre class="programlisting">javax.faces.validator.BeanValidator.MESSAGE={1}: {0}</pre><p>The default is:</p><pre class="programlisting">javax.faces.validator.BeanValidator.MESSAGE={0}</pre></div></div></div><HR xmlns=""/><a xmlns="" href=""><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">版权 © 2009 - 2013 Red Hat, Inc. &amp; Gunnar Morling</p></a><ul class="docnav"><li class="previous"><a accesskey="p" href="validator-metadata-api.html"><strong>上一页</strong>第 6 章 Metadata API</a></li><li class="up"><a accesskey="u" href="#"><strong>上一级</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>起始页</strong></a></li><li class="next"><a accesskey="n" href="validator-specifics.html"><strong>下一页</strong>第 8 章 Hibernate Validator Specifics</a></li></ul></body></html>